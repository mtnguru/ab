window.Physijs=function(){"use strict";var t,e,i,s,o,n,r,h=!1,a=p,p={},c=new THREE.Vector3,d=new THREE.Vector3,y=new THREE.Matrix4,u=new THREE.Quaternion,l={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3};return p.scripts={},e=function(){this._eventListeners={}},e.prototype.addEventListener=function(t,e){this._eventListeners.hasOwnProperty(t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)},e.prototype.removeEventListener=function(t,e){var i;return!!this._eventListeners.hasOwnProperty(t)&&((i=this._eventListeners[t].indexOf(e))>=0&&(this._eventListeners[t].splice(i,1),!0))},e.prototype.dispatchEvent=function(t){var e,i=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(t))for(e=0;e<this._eventListeners[t].length;e++)this._eventListeners[t][e].apply(this,i)},e.make=function(t){t.prototype.addEventListener=e.prototype.addEventListener,t.prototype.removeEventListener=e.prototype.removeEventListener,t.prototype.dispatchEvent=e.prototype.dispatchEvent},i=function(){var t=1;return function(){return t++}}(),function(t,e,i,s){return new THREE.Vector3(Math.atan2(2*(t*s-e*i),s*s-t*t-e*e+i*i),Math.asin(2*(t*i+e*s)),Math.atan2(2*(i*s-t*e),s*s+t*t-e*e-i*i))},function(t,e,i){var s,o,n,r,h,a,p,c;return s=Math.cos(e),o=Math.sin(e),n=Math.cos(-i),r=Math.sin(-i),h=Math.cos(t),a=Math.sin(t),p=s*n,c=o*r,{w:p*h-c*a,x:p*a+c*h,y:o*n*h+s*r*a,z:s*r*h-o*n*a}},s=function(t,e){return y.identity(),y.identity().makeRotationFromQuaternion(e.quaternion),y.getInverse(y),c.copy(t),d.copy(e.position),c.sub(d).applyMatrix4(y)},p.noConflict=function(){return window.Physijs=a,p},p.createMaterial=function(t,e,i){var s=function(){};return s.prototype=t,s=new s,s._physijs={id:t.id,friction:void 0===e?.8:e,restitution:void 0===i?.2:i},s},p.PointConstraint=function(t,e,o){void 0===o&&(o=e,e=void 0),this.type="point",this.appliedImpulse=0,this.id=i(),this.objecta=t._physijs.id,this.positiona=s(o,t).clone(),e&&(this.objectb=e._physijs.id,this.positionb=s(o,e).clone())},p.PointConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}},p.HingeConstraint=function(t,e,o,n){void 0===n&&(n=o,o=e,e=void 0),this.type="hinge",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=s(o,t).clone(),this.position=o.clone(),this.axis=n,e&&(this.objectb=e._physijs.id,this.positionb=s(o,e).clone())},p.HingeConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},p.HingeConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("hinge_setLimits",{constraint:this.id,low:t,high:e,bias_factor:i,relaxation_factor:s})},p.HingeConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},p.HingeConstraint.prototype.disableMotor=function(t,e){this.scene.execute("hinge_disableMotor",{constraint:this.id})},p.SliderConstraint=function(t,e,o,n){void 0===n&&(n=o,o=e,e=void 0),this.type="slider",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=s(o,t).clone(),this.axis=n,e&&(this.objectb=e._physijs.id,this.positionb=s(o,e).clone())},p.SliderConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},p.SliderConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("slider_setLimits",{constraint:this.id,lin_lower:t,lin_upper:e,ang_lower:i,ang_upper:s})},p.SliderConstraint.prototype.setRestitution=function(t,e){this.scene.execute("slider_setRestitution",{constraint:this.id,linear:t,angular:e})},p.SliderConstraint.prototype.enableLinearMotor=function(t,e){this.scene.execute("slider_enableLinearMotor",{constraint:this.id,velocity:t,acceleration:e})},p.SliderConstraint.prototype.disableLinearMotor=function(){this.scene.execute("slider_disableLinearMotor",{constraint:this.id})},p.SliderConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},p.SliderConstraint.prototype.disableAngularMotor=function(){this.scene.execute("slider_disableAngularMotor",{constraint:this.id})},p.ConeTwistConstraint=function(t,e,o){if(void 0===o)throw"Both objects must be defined in a ConeTwistConstraint.";this.type="conetwist",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=s(o,t).clone(),this.objectb=e._physijs.id,this.positionb=s(o,e).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z}},p.ConeTwistConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},p.ConeTwistConstraint.prototype.setLimit=function(t,e,i){this.scene.execute("conetwist_setLimit",{constraint:this.id,x:t,y:e,z:i})},p.ConeTwistConstraint.prototype.enableMotor=function(){this.scene.execute("conetwist_enableMotor",{constraint:this.id})},p.ConeTwistConstraint.prototype.setMaxMotorImpulse=function(t){this.scene.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:t})},p.ConeTwistConstraint.prototype.setMotorTarget=function(t){t instanceof THREE.Vector3?t=(new THREE.Quaternion).setFromEuler(new THREE.Euler(t.x,t.y,t.z)):t instanceof THREE.Euler?t=(new THREE.Quaternion).setFromEuler(t):t instanceof THREE.Matrix4&&(t=(new THREE.Quaternion).setFromRotationMatrix(t)),this.scene.execute("conetwist_setMotorTarget",{constraint:this.id,x:t.x,y:t.y,z:t.z,w:t.w})},p.ConeTwistConstraint.prototype.disableMotor=function(){this.scene.execute("conetwist_disableMotor",{constraint:this.id})},p.DOFConstraint=function(t,e,o){void 0===o&&(o=e,e=void 0),this.type="dof",this.appliedImpulse=0,this.id=i(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=s(o,t).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},e&&(this.objectb=e._physijs.id,this.positionb=s(o,e).clone(),this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z})},p.DOFConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},p.DOFConstraint.prototype.setLinearLowerLimit=function(t){this.scene.execute("dof_setLinearLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},p.DOFConstraint.prototype.setLinearUpperLimit=function(t){this.scene.execute("dof_setLinearUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},p.DOFConstraint.prototype.setAngularLowerLimit=function(t){this.scene.execute("dof_setAngularLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},p.DOFConstraint.prototype.setAngularUpperLimit=function(t){this.scene.execute("dof_setAngularUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},p.DOFConstraint.prototype.enableAngularMotor=function(t){this.scene.execute("dof_enableAngularMotor",{constraint:this.id,which:t})},p.DOFConstraint.prototype.configureAngularMotor=function(t,e,i,s,o){this.scene.execute("dof_configureAngularMotor",{constraint:this.id,which:t,low_angle:e,high_angle:i,velocity:s,max_force:o})},p.DOFConstraint.prototype.disableAngularMotor=function(t){this.scene.execute("dof_disableAngularMotor",{constraint:this.id,which:t})},p.Scene=function(i){var s=this;e.call(this),THREE.Scene.call(this),this._worker=new Worker(p.scripts.worker||"physijs_worker.js"),this._worker.transferableMessage=this._worker.webkitPostMessage||this._worker.postMessage,this._materials_ref_counts={},this._objects={},this._vehicles={},this._constraints={};var o=new ArrayBuffer(1);this._worker.transferableMessage(o,[o]),t=0===o.byteLength,this._worker.onmessage=function(t){var e,i=t.data;if(i instanceof ArrayBuffer&&1!==i.byteLength&&(i=new Float32Array(i)),i instanceof Float32Array)switch(i[0]){case l.WORLDREPORT:s._updateScene(i);break;case l.COLLISIONREPORT:s._updateCollisions(i);break;case l.VEHICLEREPORT:s._updateVehicles(i);break;case l.CONSTRAINTREPORT:s._updateConstraints(i)}else if(i.cmd)switch(i.cmd){case"objectReady":e=i.params,s._objects[e]&&s._objects[e].dispatchEvent("ready");break;case"worldReady":s.dispatchEvent("ready");break;case"vehicle":window.test=i;break;default:console.debug("Received: "+i.cmd),console.dir(i.params)}else switch(i[0]){case l.WORLDREPORT:s._updateScene(i);break;case l.COLLISIONREPORT:s._updateCollisions(i);break;case l.VEHICLEREPORT:s._updateVehicles(i);break;case l.CONSTRAINTREPORT:s._updateConstraints(i)}},(i=i||{}).ammo=p.scripts.ammo||"ammo.js",i.fixedTimeStep=i.fixedTimeStep||1/60,i.rateLimit=i.rateLimit||!0,this.execute("init",i)},p.Scene.prototype=new THREE.Scene,p.Scene.prototype.constructor=p.Scene,e.make(p.Scene),p.Scene.prototype._updateScene=function(e){var i,s,o,n=e[1];for(s=0;s<n;s++)o=2+14*s,void 0!==(i=this._objects[e[o]])&&(!1===i.__dirtyPosition&&i.position.set(e[o+1],e[o+2],e[o+3]),!1===i.__dirtyRotation&&i.quaternion.set(e[o+4],e[o+5],e[o+6],e[o+7]),i._physijs.linearVelocity.set(e[o+8],e[o+9],e[o+10]),i._physijs.angularVelocity.set(e[o+11],e[o+12],e[o+13]));t&&this._worker.transferableMessage(e.buffer,[e.buffer]),h=!1,this.dispatchEvent("update")},p.Scene.prototype._updateVehicles=function(e){var i,s,o,n;for(o=0;o<(e.length-1)/9;o++)n=1+9*o,void 0!==(i=this._vehicles[e[n]])&&((s=i.wheels[e[n+1]]).position.set(e[n+2],e[n+3],e[n+4]),s.quaternion.set(e[n+5],e[n+6],e[n+7],e[n+8]));t&&this._worker.transferableMessage(e.buffer,[e.buffer])},p.Scene.prototype._updateConstraints=function(e){var i,s,o,n;for(o=0;o<(e.length-1)/6;o++)n=1+6*o,i=this._constraints[e[n]],s=this._objects[e[n+1]],void 0!==i&&void 0!==s&&(c.set(e[n+2],e[n+3],e[n+4]),y.extractRotation(s.matrix),c.applyMatrix4(y),i.positiona.addVectors(s.position,c),i.appliedImpulse=e[n+5]);t&&this._worker.transferableMessage(e.buffer,[e.buffer])},p.Scene.prototype._updateCollisions=function(e){var i,s,o,h,a,p,d,y={},u={};for(i=0;i<e[1];i++)u[(h=e[o=2+5*i])+"-"+(a=e[o+1])]=o+2,u[a+"-"+h]=-1*(o+2),y[h]||(y[h]=[]),y[h].push(a),y[a]||(y[a]=[]),y[a].push(h);for(p in this._objects)if(this._objects.hasOwnProperty(p))if(h=this._objects[p],y[p]){for(s=0;s<h._physijs.touches.length;s++)-1===y[p].indexOf(h._physijs.touches[s])&&h._physijs.touches.splice(s--,1);for(s=0;s<y[p].length;s++)if(d=y[p][s],(a=this._objects[d])&&-1===h._physijs.touches.indexOf(d)){h._physijs.touches.push(d),c.subVectors(h.getLinearVelocity(),a.getLinearVelocity()),n=c.clone(),c.subVectors(h.getAngularVelocity(),a.getAngularVelocity()),r=c.clone();var l=u[h._physijs.id+"-"+a._physijs.id];l>0?c.set(-e[l],-e[l+1],-e[l+2]):(l*=-1,c.set(e[l],e[l+1],e[l+2])),h.dispatchEvent("collision",a,n,r,c)}}else h._physijs.touches.length=0;this.collisions=y,t&&this._worker.transferableMessage(e.buffer,[e.buffer])},p.Scene.prototype.addConstraint=function(t,e){if(this._constraints[t.id]=t,this.execute("addConstraint",t.getDefinition()),e){var i;switch(t.type){case"point":case"hinge":(i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial)).position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"slider":(i=new THREE.Mesh(new THREE.BoxGeometry(10,1,1),new THREE.MeshNormalMaterial)).position.copy(t.positiona),i.rotation.set(t.axis.y,t.axis.x,t.axis.z),this._objects[t.objecta].add(i);break;case"conetwist":case"dof":(i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial)).position.copy(t.positiona),this._objects[t.objecta].add(i)}}return t},p.Scene.prototype.onSimulationResume=function(){this.execute("onSimulationResume",{})},p.Scene.prototype.removeConstraint=function(t){void 0!==this._constraints[t.id]&&(this.execute("removeConstraint",{id:t.id}),delete this._constraints[t.id])},p.Scene.prototype.execute=function(t,e){this._worker.postMessage({cmd:t,params:e})},o=function(t,e){var i;for(i=0;i<e.children.length;i++)e.children[i]._physijs&&(e.children[i].updateMatrix(),e.children[i].updateMatrixWorld(),c.setFromMatrixPosition(e.children[i].matrixWorld),u.setFromRotationMatrix(e.children[i].matrixWorld),e.children[i]._physijs.position_offset={x:c.x,y:c.y,z:c.z},e.children[i]._physijs.rotation={x:u.x,y:u.y,z:u.z,w:u.w},t._physijs.children.push(e.children[i]._physijs)),o(t,e.children[i])},p.Scene.prototype.add=function(t){if(THREE.Mesh.prototype.add.call(this,t),t._physijs)if(t.world=this,t instanceof p.Vehicle)this.add(t.mesh),this._vehicles[t._physijs.id]=t,this.execute("addVehicle",t._physijs);else{t.__dirtyPosition=!1,t.__dirtyRotation=!1,this._objects[t._physijs.id]=t,t.children.length&&(t._physijs.children=[],o(t,t)),t.material._physijs&&(this._materials_ref_counts.hasOwnProperty(t.material._physijs.id)?this._materials_ref_counts[t.material._physijs.id]++:(this.execute("registerMaterial",t.material._physijs),t._physijs.materialId=t.material._physijs.id,this._materials_ref_counts[t.material._physijs.id]=1)),t._physijs.position={x:t.position.x,y:t.position.y,z:t.position.z},t._physijs.rotation={x:t.quaternion.x,y:t.quaternion.y,z:t.quaternion.z,w:t.quaternion.w};new THREE.Vector3(1,1,1);t._physijs.width&&(t._physijs.width*=t.scale.x),t._physijs.height&&(t._physijs.height*=t.scale.y),t._physijs.depth&&(t._physijs.depth*=t.scale.z),this.execute("addObject",t._physijs)}},p.Scene.prototype.remove=function(t){if(t instanceof p.Vehicle){for(this.execute("removeVehicle",{id:t._physijs.id});t.wheels.length;)this.remove(t.wheels.pop());this.remove(t.mesh),delete this._vehicles[t._physijs.id]}else THREE.Mesh.prototype.remove.call(this,t),t._physijs&&(delete this._objects[t._physijs.id],this.execute("removeObject",{id:t._physijs.id}));t.material&&t.material._physijs&&this._materials_ref_counts.hasOwnProperty(t.material._physijs.id)&&0==--this._materials_ref_counts[t.material._physijs.id]&&(this.execute("unRegisterMaterial",t.material._physijs),delete this._materials_ref_counts[t.material._physijs.id])},p.Scene.prototype.setFixedTimeStep=function(t){t&&this.execute("setFixedTimeStep",t)},p.Scene.prototype.setGravity=function(t){t&&this.execute("setGravity",t)},p.Scene.prototype.simulate=function(t,e){var i,s,o;if(h)return!1;h=!0;for(i in this._objects)this._objects.hasOwnProperty(i)&&((s=this._objects[i]).__dirtyPosition||s.__dirtyRotation)&&(o={id:s._physijs.id},s.__dirtyPosition&&(o.pos={x:s.position.x,y:s.position.y,z:s.position.z},s.__dirtyPosition=!1),s.__dirtyRotation&&(o.quat={x:s.quaternion.x,y:s.quaternion.y,z:s.quaternion.z,w:s.quaternion.w},s.__dirtyRotation=!1),this.execute("updateTransform",o));return this.execute("simulate",{timeStep:t,maxSubSteps:e}),!0},p.Mesh=function(t,s,o){t&&(e.call(this),THREE.Mesh.call(this,t,s),t.boundingBox||t.computeBoundingBox(),this._physijs={type:null,id:i(),mass:o||0,touches:[],linearVelocity:new THREE.Vector3,angularVelocity:new THREE.Vector3})},p.Mesh.prototype=new THREE.Mesh,p.Mesh.prototype.constructor=p.Mesh,e.make(p.Mesh),p.Mesh.prototype.__defineGetter__("mass",function(){return this._physijs.mass}),p.Mesh.prototype.__defineSetter__("mass",function(t){this._physijs.mass=t,this.world&&this.world.execute("updateMass",{id:this._physijs.id,mass:t})}),p.Mesh.prototype.applyCentralImpulse=function(t){this.world&&this.world.execute("applyCentralImpulse",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},p.Mesh.prototype.applyImpulse=function(t,e){this.world&&this.world.execute("applyImpulse",{id:this._physijs.id,impulse_x:t.x,impulse_y:t.y,impulse_z:t.z,x:e.x,y:e.y,z:e.z})},p.Mesh.prototype.applyTorque=function(t){this.world&&this.world.execute("applyTorque",{id:this._physijs.id,torque_x:t.x,torque_y:t.y,torque_z:t.z})},p.Mesh.prototype.applyCentralForce=function(t){this.world&&this.world.execute("applyCentralForce",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},p.Mesh.prototype.applyForce=function(t,e){this.world&&this.world.execute("applyForce",{id:this._physijs.id,force_x:t.x,force_y:t.y,force_z:t.z,x:e.x,y:e.y,z:e.z})},p.Mesh.prototype.getAngularVelocity=function(){return this._physijs.angularVelocity},p.Mesh.prototype.setAngularVelocity=function(t){this.world&&this.world.execute("setAngularVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},p.Mesh.prototype.getLinearVelocity=function(){return this._physijs.linearVelocity},p.Mesh.prototype.setLinearVelocity=function(t){this.world&&this.world.execute("setLinearVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},p.Mesh.prototype.setAngularFactor=function(t){this.world&&this.world.execute("setAngularFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},p.Mesh.prototype.setLinearFactor=function(t){this.world&&this.world.execute("setLinearFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},p.Mesh.prototype.setDamping=function(t,e){this.world&&this.world.execute("setDamping",{id:this._physijs.id,linear:t,angular:e})},p.Mesh.prototype.setCcdMotionThreshold=function(t){this.world&&this.world.execute("setCcdMotionThreshold",{id:this._physijs.id,threshold:t})},p.Mesh.prototype.setCcdSweptSphereRadius=function(t){this.world&&this.world.execute("setCcdSweptSphereRadius",{id:this._physijs.id,radius:t})},p.PlaneMesh=function(t,e,i){var s,o;p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="plane",this._physijs.normal=t.faces[0].normal.clone(),this._physijs.mass=void 0===i?s*o:i},p.PlaneMesh.prototype=new p.Mesh,p.PlaneMesh.prototype.constructor=p.PlaneMesh,p.HeightfieldMesh=function(t,e,i,s,o){p.Mesh.call(this,t,e,i),this._physijs.type="heightfield",this._physijs.xsize=t.boundingBox.max.x-t.boundingBox.min.x,this._physijs.ysize=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.xpts=void 0===s?Math.sqrt(t.vertices.length):s+1,this._physijs.ypts=void 0===o?Math.sqrt(t.vertices.length):o+1,this._physijs.absMaxHeight=Math.max(t.boundingBox.max.z,Math.abs(t.boundingBox.min.z));for(var n,r,h=[],a=0;a<t.vertices.length;a++)n=a%this._physijs.xpts,r=Math.round(a/this._physijs.xpts-a%this._physijs.xpts/this._physijs.xpts),h[a]=t.vertices[n+(this._physijs.ypts-r-1)*this._physijs.ypts].z;this._physijs.points=h},p.HeightfieldMesh.prototype=new p.Mesh,p.HeightfieldMesh.prototype.constructor=p.HeightfieldMesh,p.BoxMesh=function(t,e,i){var s,o,n;p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="box",this._physijs.width=s,this._physijs.height=o,this._physijs.depth=n,this._physijs.mass=void 0===i?s*o*n:i},p.BoxMesh.prototype=new p.Mesh,p.BoxMesh.prototype.constructor=p.BoxMesh,p.SphereMesh=function(t,e,i){p.Mesh.call(this,t,e,i),t.boundingSphere||t.computeBoundingSphere(),this._physijs.type="sphere",this._physijs.radius=t.boundingSphere.radius,this._physijs.mass=void 0===i?4/3*Math.PI*Math.pow(this._physijs.radius,3):i},p.SphereMesh.prototype=new p.Mesh,p.SphereMesh.prototype.constructor=p.SphereMesh,p.CylinderMesh=function(t,e,i){var s,o,n;p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="cylinder",this._physijs.width=s,this._physijs.height=o,this._physijs.depth=n,this._physijs.mass=void 0===i?s*o*n:i},p.CylinderMesh.prototype=new p.Mesh,p.CylinderMesh.prototype.constructor=p.CylinderMesh,p.CapsuleMesh=function(t,e,i){var s,o,n;p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="capsule",this._physijs.radius=Math.max(s/2,n/2),this._physijs.height=o,this._physijs.mass=void 0===i?s*o*n:i},p.CapsuleMesh.prototype=new p.Mesh,p.CapsuleMesh.prototype.constructor=p.CapsuleMesh,p.ConeMesh=function(t,e,i){var s,o;p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="cone",this._physijs.radius=s/2,this._physijs.height=o,this._physijs.mass=void 0===i?s*o:i},p.ConeMesh.prototype=new p.Mesh,p.ConeMesh.prototype.constructor=p.ConeMesh,p.ConcaveMesh=function(t,e,i){var s,o,n,r,h,a,c=[];for(p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),h=t.vertices,s=0;s<t.faces.length;s++)(a=t.faces[s])instanceof THREE.Face3?c.push([{x:h[a.a].x,y:h[a.a].y,z:h[a.a].z},{x:h[a.b].x,y:h[a.b].y,z:h[a.b].z},{x:h[a.c].x,y:h[a.c].y,z:h[a.c].z}]):a instanceof THREE.Face4&&(c.push([{x:h[a.a].x,y:h[a.a].y,z:h[a.a].z},{x:h[a.b].x,y:h[a.b].y,z:h[a.b].z},{x:h[a.d].x,y:h[a.d].y,z:h[a.d].z}]),c.push([{x:h[a.b].x,y:h[a.b].y,z:h[a.b].z},{x:h[a.c].x,y:h[a.c].y,z:h[a.c].z},{x:h[a.d].x,y:h[a.d].y,z:h[a.d].z}]));o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="concave",this._physijs.triangles=c,this._physijs.mass=void 0===i?o*n*r:i},p.ConcaveMesh.prototype=new p.Mesh,p.ConcaveMesh.prototype.constructor=p.ConcaveMesh,p.ConvexMesh=function(t,e,i){var s,o,n,r,h=[];for(p.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=0;s<t.vertices.length;s++)h.push({x:t.vertices[s].x,y:t.vertices[s].y,z:t.vertices[s].z});o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="convex",this._physijs.points=h,this._physijs.mass=void 0===i?o*n*r:i},p.ConvexMesh.prototype=new p.Mesh,p.ConvexMesh.prototype.constructor=p.ConvexMesh,p.Vehicle=function(t,e){e=e||new p.VehicleTuning,this.mesh=t,this.wheels=[],this._physijs={id:i(),rigidBody:t._physijs.id,suspension_stiffness:e.suspension_stiffness,suspension_compression:e.suspension_compression,suspension_damping:e.suspension_damping,max_suspension_travel:e.max_suspension_travel,friction_slip:e.friction_slip,max_suspension_force:e.max_suspension_force}},p.Vehicle.prototype.addWheel=function(t,e,i,s,o,n,r,h,a){var p=new THREE.Mesh(t,e);p.castShadow=p.receiveShadow=!0,p.position.copy(s).multiplyScalar(n/100).add(i),this.world.add(p),this.wheels.push(p),this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:i.x,y:i.y,z:i.z},wheel_direction:{x:s.x,y:s.y,z:s.z},wheel_axle:{x:o.x,y:o.y,z:o.z},suspension_rest_length:n,wheel_radius:r,is_front_wheel:h,tuning:a})},p.Vehicle.prototype.setSteering=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setSteering",{id:this._physijs.id,wheel:e,steering:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setSteering",{id:this._physijs.id,wheel:i,steering:t})},p.Vehicle.prototype.setBrake=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setBrake",{id:this._physijs.id,wheel:e,brake:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setBrake",{id:this._physijs.id,wheel:i,brake:t})},p.Vehicle.prototype.applyEngineForce=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:e,force:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:i,force:t})},p.VehicleTuning=function(t,e,i,s,o,n){this.suspension_stiffness=void 0!==t?t:5.88,this.suspension_compression=void 0!==e?e:.83,this.suspension_damping=void 0!==i?i:.88,this.max_suspension_travel=void 0!==s?s:500,this.friction_slip=void 0!==o?o:10.5,this.max_suspension_force=void 0!==n?n:6e3},p}();
//# sourceMappingURL=../maps/physijs/physi.js.map
