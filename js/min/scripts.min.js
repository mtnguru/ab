!function(a){"use strict";Drupal.behaviors.atomizer={attach:function(a,r){if(!Drupal.atomizer.base){Drupal.atomizer.base=Drupal.atomizer.baseC();for(var e in drupalSettings.atomizer)Drupal.atomizer.viewerC(drupalSettings.atomizer[e])}}}}(jQuery);
!function(a){"use strict";Drupal.atomizer.animationC=function(t){function e(){var a=b.theme.get("animation--speed")/1e3,t=b.camera.position.x,e=b.camera.position.y,i=b.camera.position.z;b.camera.position.x=t*Math.cos(a)+i*Math.sin(a),b.camera.position.y=e*Math.cos(a)-t*Math.sin(a),b.camera.position.z=i*Math.cos(a)-t*Math.sin(a),b.camera.lookAt(b.scene.position)}function i(){var a=y.val();p!=a?(p=a,Drupal.atomizer.base.doAjax("/ajax-ab/loadYml",{directory:b.atomizer.animateDirectory,filepath:b.atomizer.animateDirectory+"/"+p,filename:p,component:"animation"},j)):"paused"==z?(z="running",l(),f&&m()):c()}function n(){for(var a in u.timers)clearTimeout(C[a]);C={},h&&(clearTimeout(h),h=null)}function o(){for(var a in u.timers){var t=u.timers[a];C[a]=setTimeout(function(){s(a,t)},t.time)}f&&m()}function s(a,t){switch(a){case"loadatoms":M=M>=t.atoms.length-1?0:M+1,n(),z="paused",b.atom.loadObject(t.atoms[M].nid,function(){t.atoms[M].time&&(t.time=t.atoms[M].time)});break;case"loop":if(d=t,v=[],g=0,k=0,(f=d[g]).parms)for(var e in f.parms){var i=f.parms[e];i[2]=(i[0]-i[1])/f.steps,i[3]=i[0],b.theme.applyControl(e,i[3])}m()}}function m(){h=setTimeout(function(){r(name,d)},f.time/f.steps)}function r(a,t){if(k==f.steps){g=g+1==t.length?0:g+1,f=t[g],k=0;for(var e in f.parms)(i=f.parms[e])[2]=(i[0]-i[1])/f.steps,i[3]=i[0]}if(f.parms)for(var e in f.parms){var i=f.parms[e];i[3]-=i[2],b.theme.applyControl(e,i[3])}k++,m()}function c(){z="running";u.timers&&(u.timers.loadatoms&&(u.timers.loadatoms.time=u.timers.loadatoms.atoms[0].time),o()),u.animations&&(z="running",l())}function l(){if("running"==z){switch(u.type){case"atoms":requestAnimationFrame(l),u.animations.rotation&&"orbitals"===u.animations.rotation.name&&e();break;case"birkeland":b.theme.get("animation--speed");requestAnimationFrame(l),u.animations.particles&&b.birkeland.animate(u)}b.render()}}var p,u,d,f,h,v,b=t,z="stopped",y=a(".animation--selectyml select"),C={},g=0,k=0,M=-1,A=a(".blocks--animation--wrapper").find(".az-button"),j=function(a){p=a[0].data.filename,u=a[0].ymlContents,localStorage.setItem("atomizer_animation_file",p),y.val(p),c()},w=function(){z="stopped",n(),A.removeClass("az-selected"),a(button).addClass("az-selected")};return{buttonClicked:function(t){switch(t.id){case"animation--play":i(),A.removeClass("az-selected"),a(t).addClass("az-selected");break;case"animation--pause":z="paused",n(),A.removeClass("az-selected"),a(t).addClass("az-selected");break;case"animation--stop":w()}},loadYml:j,play:i,stopAnimation:w}}}(jQuery);
!function(t){Drupal.atomizer.atomC=function(a){function e(t){t.az.selected=!1,m.nuclet.setElectronColor(t,!1,!0),t.parent.remove(t),delete t.az.nuclet.nelectrons[t.az.id]}function n(t,a,n,o){for(var r="0"==t?["P12","P13","P14","P15"]:["P16","P17","P18","P19"],i=0;i<r.length;i++)a.az.protons[r[i]].material.visible=o,a.az.protons[r[i]].az.visible=o,a.az.protons[r[i]].az.active=n;for(i in a.az.neutrons)a.az.neutrons.hasOwnProperty(i)&&i.charAt(1)==t&&(a.az.neutrons[i].material.visible=!1,a.az.neutrons[i].az.visible=!1,a.az.neutrons[i].az.active=n);if(!n&&a.az.nelectrons)for(i in a.az.nelectrons)a.az.nelectrons.hasOwnProperty(i)&&e(a.az.nelectrons[i])}function o(t,a,e){var r=m.nuclet.createNuclet(t,a),i=r.children[0],c=r.children[0].children[0];if(c.az.attachAngle=a.attachAngle,e.add(r),"N0"!=c.az.id){var l=c.az.id.substr(c.az.id.length-1),u=c.az.id.slice(0,-1),z=s.az.nuclets[u];n(l,z,!1,!1);var d,v;0==l?(d="P0",v="P10",i.initial_rotation_y=-18):(d="P2",v="P10",i.initial_rotation_y=-198);var p=z.az.protons[d].position.clone(),h=new THREE.Vector3(0,28,0),f=new THREE.Vector3(0,6,0);p.y=p.y+11;var g=c.az.protonGeometry.vertices[v.replace("P","")].clone().normalize(),y=new THREE.Vector3(0,1,0),b=h.clone().sub(p),A=b.length();b.normalize(),Drupal.atomizer.base.alignObjectToAxis(c,g,y,!1),Drupal.atomizer.base.alignObjectToAxis(r,y,b,!1);var x=f.clone().add(b.multiplyScalar(2.37*-A));r.position.set(x.x,x.y,x.z),i.rotation.y=(i.initial_rotation_y+72.2*((a.attachAngle||1)-1))/180*Math.PI,c.az.attachPt=x;var E=m.theme.get("attachLines--opacity"),P=new THREE.Geometry,w=(m.nuclet.getConstants(),new THREE.LineBasicMaterial({color:m.theme.get("attachLines--color"),opacity:E,transparent:E<m.nuclet.getConstants().transparentThresh,visible:E>m.nuclet.getConstants().visibleThresh,linewidth:m.theme.get("attachLines--linewidth")}));P.vertices[0]=x.multiplyScalar(m.theme.get("attachLines--scale")),P.vertices[1]=new THREE.Vector3(0,0,0);var C=new THREE.LineSegments(P,w);C.name="attachLines",z.add(C)}if(s.az.nuclets[c.az.id]=c,a.nuclets)for(var t in a.nuclets)o(t,a.nuclets[t],c),n(t.charAt(t.length-1),c,!1,!1);return r}function r(){var t=m.theme.get("valence-active--color"),a=m.theme.get("valence-inactive--color");for(var e in s.az.nuclets){var n=s.az.nuclets[e];if("initial"===n.az.state||"final"===n.az.state)for(var o in n.az.rings)if(n.az.rings.hasOwnProperty(o)){var r=n.az.rings[o],i=(n.az.id,r.az.grow,t);s.az.nuclets[n.az.id+r.az.grow]||n.az.protons[r.az.lock[0]].az.visible&&n.az.protons[r.az.lock[1]].az.visible?i=a:0,r.material.color.setHex(parseInt(i.replace(/#/,"0x")),16)}}}function i(){var a=0,e=0;for(var n in s.az.nuclets){0;var o=s.az.nuclets[n];for(var r in o.az.protons){var i=o.az.protons[r];i.az?i.az.visible&&a++:0}for(var r in o.az.neutrons)o.az.neutrons.hasOwnProperty(r)&&o.az.neutrons[r].az.visible&&a++;for(var r in o.az.nelectrons)e++}t(".atom--num-protons .text-value",m.context).html(a),t(".atom--num-electrons .text-value",m.context).html(e)}function c(){function t(a,e){var n=s.az.nuclets[a],o=e+a+":\n";if(e+="  ",o+=e+"state: "+n.az.state+"\n","N0"!==a&&(o+=e+"attachAngle: "+n.az.conf.attachAngle+"\n"),n.az.protons){var r=0;for(var i in n.az.protons)if(n.az.protons.hasOwnProperty(i)){var c=n.az.protons[i];c.az.active&&c.az.visible&&(0==r++&&(o+=e+"protons:\n"),o+=e+"  "+i+":",c.az.tmpColor&&(args=c.az.tmpColor.name.split("-"),o+=" {color: "+args[1]+"}"),o+="\n")}}r=0;for(var l in n.az.neutrons)n.az.neutrons.hasOwnProperty(l)&&n.az.neutrons[l].az.visible&&(o+=0==r++?e+"neutrons: [":", ",o+=n.az.neutrons[l].az.id);if(r&&(o+="]\n"),n.az.nelectrons){r=0;for(var l in n.az.nelectrons)if(n.az.nelectrons.hasOwnProperty(l)){var u=n.az.nelectrons[l];0==r++&&(o+=e+"electrons:\n"),o+=e+"  E"+(r<10?"0"+r:r)+": {protons: [";for(var m=0,z=0;z<u.az.vertices.length;z++)0!=m++&&(o+=", "),o+=u.az.vertices[z];m&&(o+="]}\n")}}var d=s.az.nuclets[a+"0"],v=s.az.nuclets[a+"1"];return(d||v)&&(o+=e+"nuclets:\n",d&&(o+=t(a+"0",e+"  ")),v&&(o+=t(a+"1",e+"  "))),o}return t("N0","")}function l(){g.click(function(a){y(t(a.target).data("nid"),null),"mobile"!=m.getDisplayMode()&&"tablet"!=m.getDisplayMode()||p.addClass("az-hidden"),a.preventDefault()}),h.click(function(){p.hasClass("az-hidden")?p.removeClass("az-hidden"):p.addClass("az-hidden")}),f.click(function(){p.addClass("az-hidden")})}var s,u,m=a,z=t(".scene--name, .az-scene-name",m.context),d=t(".atom--information",m.context)[0],v=t(".atom--properties",m.context)[0],p=t("#az-page-select-atom",m.content),h=t("#atom-select-enable",m.context),f=p.find(".az-close"),g=t(".atom-name, .atomic-number",m.context),y=function(t,a){u=a,Drupal.atomizer.base.doAjax("/ajax-ab/loadAtom",{nid:t},b)},b=function(a){for(var e=0;e<a.length;e++){var n=a[e];if("loadAtomCommand"==n.command){z&&z.html(n.data.atomTitle),d&&(d.innerHTML=n.data.information),v&&(v.innerHTML=n.data.properties),g.length>0&&(g.removeClass("atom-active"),t(".atom-select-"+n.data.nid,m.context).addClass("atom-active"));var o=t(".atom--save a",m.context);o.length&&(o.replaceWith(n.data.link),Drupal.attachBehaviors&&Drupal.attachBehaviors(".atom--save a")),s?(x(s),s=null,null,m.atom.atom=null):{nuclets:{}},A(n.data.atomConf.N0),s.az.nid=n.data.nid,s.az.name=n.data.atomName,s.az.title=n.data.atomTitle,m.dataAttr["atom--position--x"]&&(s.position||(s.position=new THREE.Vector3),s.position.x=m.dataAttr["atom--position--x"]),m.dataAttr["atom--position--y"]&&(s.position||(s.position=new THREE.Vector3),s.position.y=m.dataAttr["atom--position--y"]),m.dataAttr["atom--position--z"]&&(s.position||(s.position=new THREE.Vector3),s.position.z=m.dataAttr["atom--position--z"]),m.dataAttr["atom--rotation--x"]&&(s.rotation||(s.rotation=new THREE.Vector3),s.rotation.x=m.dataAttr["atom--rotation--x"]*Math.PI/180),m.dataAttr["atom--rotation--y"]&&(s.rotation||(s.rotation=new THREE.Vector3),s.rotation.y=m.dataAttr["atom--rotation--y"]*Math.PI/180),m.dataAttr["atom--rotation--z"]&&(s.rotation||(s.rotation=new THREE.Vector3),s.rotation.z=m.dataAttr["atom--rotation--z"]*Math.PI/180),m.producer.objectLoaded(s),m.render(),u&&u()}}},A=function(t){return s=new THREE.Group,s.name="atom",s.az={nuclets:{}},m.atom.atom=s,o("N0",t,s),r(),i(),m.scene.add(s),m.render(),s},x=function(t){for(var a in t.az.nuclets)m.nuclet.deleteNuclet(t.az.nuclets[a]);m.scene.remove(t)},E=function(a){t(".theme--selectyml",m.context)[0].querySelector("select")};return t(".atom--select-close").click(function(){t(m.context).removeClass("select-atom-enabled")}),Drupal.behaviors.atomizer_atom={attach:function(a,e){r="";t(a).find("#az-page-select-atom").once("selectAtomAttached").each(function(){l()});var n=t(".node-atom-form, .node-atom-edit-form")[0];if(n){var o=n.getElementsByClassName("field--name-field-atomic-structure")[0].getElementsByTagName("textarea")[0],r=c();o.value=r}}},l(),{addNuclet:function(t){conf={state:"lithium",attachAngle:3,protons:[10,1,4,5,3,11,9]};var a=s.az.nuclets[t.slice(0,-1)];n(t.charAt(t.length-1),a,!1,!1);var e=o(t,conf,a);return r(),i(),e.children[0].children[0]},addProton:function(t,a){},deleteNElectron:e,az:function(){return s.az},buttonClicked:function(a){"atom--select"==a.id&&t(m.context).toggleClass("select-atom-enabled")},changeNucletState:function(t,a){var e=t.az.id,n=t.az.attachAngle,c=t.parent.parent.parent;return m.nuclet.deleteNuclet(t),t=o(e,{state:a,attachAngle:n},c).children[0].children[0],r(),i(),t},changeNucletAngle:function(t,a){var e=s.az.nuclets[t];e.parent.rotation.y=(e.parent.initial_rotation_y+72.2*(a-1))/180*Math.PI,e.az.conf.attachAngle=a},createObject:A,deleteObject:x,deleteNuclet:function(t){var a=s.az.nuclets[t],e=s.az.nuclets[t.slice(0,-1)];m.nuclet.deleteNuclet(a),n(t.charAt(t.length-1),e,!0,!1),r(),i()},explodeAtom:function(t){for(var a in s.az.nuclets){var e=s.az.nuclets[a];"N0"!==e.az.id&&e.parent.parent.position.set(e.az.attachPt.x*t,e.az.attachPt.y*t,e.az.attachPt.z*t)}m.render()},getNuclet:function(t){return s.az.nuclets[t]?s.az.nuclets[t]:null},getYmlDirectory:function(){return"config/atom"},loadObject:y,overwriteYml:function(t){Drupal.atomizer.base.doAjax("/ajax-ab/saveYml",{name:currentSet.name,component:"theme",filename:currentSet.filename,ymlContents:currentSet},null)},saveYml:function(t){currentSet.name=t.name,currentSet.filename=t.filename,Drupal.atomizer.base.doAjax("/ajax-ab/saveYml",{name:t.name,component:"theme",filename:t.filename,ymlContents:currentSet},E)},updateValenceRings:r,updateParticleCount:i}}}(jQuery);
!function(e){Array.prototype.contains=function(e){for(var t in this)if(this[t]==e)return!0;return!1},Drupal.atomizer={},Drupal.atomizer.baseC=function(){Drupal.AjaxCommands.prototype.loadYmlCommand=function(e,t,a){Drupal.atomizer[t.component].loadYml(t)},Drupal.AjaxCommands.prototype.saveYmlCommand=function(e,t,a){Drupal.atomizer[t.component].saveYml(t)},Drupal.AjaxCommands.prototype.renderNodeCommand=function(e,t,a){Drupal.atomizer[t.component].renderNode(t)};return{doAjax:function(t,a,r,n){e.ajax({url:t,type:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",processData:!1,success:function(e){return Array.isArray(e)&&e.length>0?(e[0].data&&e[0].data.message&&alert(e[0].data.message),r&&r(e)):n?n(e):r(e),!1},error:function(e){alert("atomizer_base doAjax: "+e.responseText),n?n(e):r(e)}})},alignObjectToAxis:function(e,t,a,r){var n=new THREE.Vector3;n.crossVectors(t,a).normalize();var o=Math.acos(t.dot(a));e.quaternion.setFromAxisAngle(n,r?-o:o)},initDraggable:function(e,t,a,r){},makeObject:function(e,t,a,r,n){if(!n)switch(e){case"plane":n=new THREE.PlaneGeometry(a.width||1e3,a.depth||1e3);break;case"proton":case"sphere":n=new THREE.SphereGeometry(a.radius||viewer.theme.get("proton--radius"),a.widthSegments||36,a.heightSegments||36);break;case"electron":n=new THREE.SphereGeometry(a.radius||viewer.theme.get("electron--radius"),a.widthSegments||20,a.heightSegments||20);break;case"octahedron":n=new THREE.OctahedronGeometry(a.length||3);break;case"tetrahedron":n=new THREE.TetrahedronGeometry(a.length||3);break;case"icosahedron":n=new THREE.IcosahedronGeometry(a.length||3);break;case"dodecahedron":n=new THREE.DodecahedronGeometry(a.length||3);break;case"cube":var o=a.length||4;n=new THREE.BoxGeometry(o,o,o);break;case"pentagonalBipyramid":n=createBiPyramid(5,a.length,a.height,35)}var i=[];t.wireframe&&i.push(new THREE.MeshBasicMaterial(t.wireframe)),t.lambert&&i.push(new THREE.MeshLambertMaterial(t.lambert)),t.phong&&i.push(new THREE.MeshPhongMaterial(t.phong)),t.doubleSided&&(i[0].side=THREE.DoubleSide);var s;return s=1==i.length?new THREE.Mesh(n,i[0]):new THREE.SceneUtils.createMultiMaterialObject(n,i),a.scale&&s.scale.set(a.scale,a.scale,a.scale),r&&(r.rotation&&(r.rotation.x&&(s.rotation.x=r.rotation.x),r.rotation.y&&(s.rotation.y=r.rotation.y),r.rotation.z&&(s.rotation.z=r.rotation.z)),s.position.x=r.x||0,s.position.y=r.y||0,s.position.z=r.z||0),s.name=e,s},constants:{visibleThresh:.03,transparentThresh:.97}}}}(jQuery);
!function(t){Drupal.atomizer.birkelandC=function(e){function r(t){return t*(Math.PI/180)}function n(t,e,r,n){var a=new THREE.CylinderGeometry(t,t,e,50,10,!0),o=new THREE.MeshLambertMaterial({color:r,transparent:!0,visible:!0,opacity:n});return o.side=THREE.DoubleSide,cylinder=new THREE.Mesh(a,o),cylinder}function a(t,e,r){return e.y+=r,r>=0?e.y>t.conf.length/2&&(e.y-=t.conf.length):e.y<-t.conf.length/2&&(e.y+=t.conf.length),e}var o,i,c,s=e,d=t(".scene--name",s.context),l=t(".scene--information",s.context)[0],m=t(".scene--properties",s.context)[0],u=function(t){for(var e=0;e<t.length;e++){var r=t[e];"loadNodeCommand"==r.command&&(d&&d.html(r.data.nodeTitle),l&&(l.innerHTML=r.data.information),m&&(m.innerHTML=r.data.properties),o&&(f(o),o=null),(o=h(r.data.nodeConf)).az={nid:r.data.nid,name:r.data.nodeName,title:r.data.nodeTitle},s.dataAttr["object--position--x"]&&(object.position||(object.position=new THREE.Vector3),o.position.x=s.dataAttr["bc--position--x"]),s.dataAttr["bc--position--y"]&&(o.position||(o.position=new THREE.Vector3),o.position.y=s.dataAttr["bc--position--y"]),s.dataAttr["bc--position--z"]&&(o.position||(o.position=new THREE.Vector3),o.position.z=s.dataAttr["bc--position--z"]),s.dataAttr["bc--rotation--x"]&&(o.rotation||(o.rotation=new THREE.Vector3),o.rotation.x=s.dataAttr["bc--rotation--x"]*Math.PI/180),s.dataAttr["bc--rotation--y"]&&(o.rotation||(o.rotation=new THREE.Vector3),o.rotation.y=s.dataAttr["bc--rotation--y"]*Math.PI/180),s.dataAttr["bc--rotation--z"]&&(o.rotation||(o.rotation=new THREE.Vector3),o.rotation.z=s.dataAttr["bc--rotation--z"]*Math.PI/180),s.producer.objectLoaded(o),s.render(),c&&c())}},h=function(t){var e,o,c,d,l,m=new THREE.Group;m.cylinders={},t.object.rotation&&(m.rotation=new THREE.Vector3,m.rotation.set(t.object.rotation.x?t.object.rotation.x*Math.PI/180:0,t.object.rotation.y?t.object.rotation.y*Math.PI/180:0,t.object.rotation.z?t.object.rotation.z*Math.PI/180:0)),s.scene.add(m);for(var u in t.cylinders)if("defaults"!=u){e=[];for(var h in t.cylinders.defaults)e[h]=t.cylinders.defaults[h];for(var h in t.cylinders[u])e[h]=t.cylinders[u][h];switch(o=new THREE.Geometry,c=new THREE.PointsMaterial({size:e.markerSize,sizeAttenuation:!1,color:e.color}),d=n(e.radius,e.length,e.color,s.theme.get("cylinders-"+u+"--opacity")),d.name="cylinders-"+u.replace(" ","_"),d.conf=e,m.add(d),m.cylinders[u]=d,l={},e.markerType){case"arrows":l.circumference=2*Math.PI*e.radius,l.arc=l.circumference*e.markerLength/360,l.step=arc/e.markerLength}for(var f=360/e.numArrowPaths,p=0;p<e.numArrowPaths;p++){switch(l.radians=r(p*f+e.rotateInitial),l.spacing=e.length/(e.numArrows+1),e.markerType){case"arrows":break;case"particles":l.x=e.radius*Math.sin(l.radians),l.y=-e.length/2+l.spacing*Math.random(),l.z=e.radius*Math.cos(l.radians)}for(var y=0;y<e.numArrows;y++)!function(t){switch(e.markerType){case"arrows":switch(l.y+=e.length/e.numArrows,e.animationRotate){case 0:for(var r=e.radius*Math.sin(radians),n=-e.length/2+spacing*Math.random(),i=e.radius*Math.cos(radians),c=0;c<e.numArrows;c++)n+=e.length/e.numArrows;for(s=0;s<e.markerLength;s+=e.markerSize)m=new THREE.Vector3(r,n+s,i),m=a(d,m,0),o.vertices.push(m);break;case 2:case-2:for(c=0;c<e.numArrows;c++)n+=e.length/e.numArrows;for(s=0;s<e.markerLength;s+=e.markerSize)m=new THREE.Vector3(r,n+s,i),m=a(d,m,0),o.vertices.push(m);break;case 4:case-4:for(c=0;c<e.numArrows;c++)n+=e.length/e.numArrows;for(var s=0;s<e.markerLength;s+=e.markerSize)m=new THREE.Vector3(r,n+s,i),m=a(d,m,0),o.vertices.push(m)}break;case"particles":l.y+=e.length/e.numArrows;var m=new THREE.Vector3(l.x,l.y,l.z);m=a(d,m,0),o.vertices.push(m)}}()}(i=new THREE.Points(o,c)).name="particles-"+u.replace(" ","_"),d.add(i)}return s.render(),m},f=function(t){s.scene.remove(t)};return t(".atom--select-close").click(function(){t(s.context).removeClass("select-atom-enabled")}),{az:function(){return atom.az},buttonClicked:function(e){"atom--select"==e.id&&t(s.context).toggleClass("select-atom-enabled")},createObject:h,deleteObject:f,loadObject:function(t,e){c=e,Drupal.atomizer.base.doAjax("/ajax-ab/load-node",{nid:t},u)},animate:function(t){var e=s.theme.get("animation--speed")/100;for(var n in o.cylinders){var i=o.cylinders[n].conf,c=o.cylinders[n];if(c){var d=c.children[0].geometry.vertices;c.children[0].geometry.verticesNeedUpdate=!0;for(var l=0;l<d.length;l++)d[l]=a(c,d[l],i.animationDistance*e);c.rotation.y+=r(i.animationRotate*e)}}s.render()}}}}(jQuery);
!function(e){Drupal.atomizer.controlsC=function(t,a){function n(e){switch(D){case"atom_builder":E.dispose(),delete E,L.canvasContainer.removeEventListener("mousemove",x);break;case"camera":E.dispose(),delete E;break;case"atom":y.dispose(),delete y;break;case"attach":L.canvasContainer.removeEventListener("mousemove",x)}switch(D=e){case"atom_builder":E=g(),L.canvasContainer.addEventListener("mousemove",x,!1),L.canvasContainer.addEventListener("mousedown",z,!1),L.canvasContainer.addEventListener("mouseup",w,!1);break;case"camera":E=g();break;case"atom":y=b(Drupal.atomizer.octolet);break;case"attach":L.canvasContainer.addEventListener("mousemove",x,!1)}}function o(t){var a=this.id;this.className.indexOf("az-slider")>-1?(a=a.replace("--az-slider",""),e("#"+a+"--az-value",L.context)[0].value=t.target.value):this.className.indexOf("az-control-range")>-1&&(e("#"+a+"--az-value",L.context)[0].value=t.target.value),L.theme.applyControl(a,t.target.value)}function r(e){var t=this.id.split("--");Drupal.atomizer.base.doAjax("/ajax-ab/loadYml",{component:t[0],filepath:L[t[0]].getYmlDirectory()+"/"+e.target.value,filename:e.target.value},L[t[0]].loadYml)}function c(t){t.preventDefault();var a=this.id.split("--");switch(a[1]){case"selectyml":L[a[0]].overwriteYml();break;case"saveyml":var n=e("3"+a[0]+"--saveyml",L.context)[0],o=n.querySelector("input[name=name]").value,r=n.querySelector("input[name=filename]").value;o.length&&(0==r.length&&(r=o),-1==r.indexOf(".yml")&&(r+=".yml"),L[a[0]].saveYml({name:o,filepath:L[a[0]].getYmlDirectory()+"/"+r.replace(/[|&;$%@"<>()+,]/g,"").replace(/[ -]/g,"_")}));break;case"snapshot":break;default:"viewer"===a[0]?L.buttonClicked(t.target):L[a[0]]&&L[a[0]].buttonClicked&&(t.preventDefault(),L[a[0]].buttonClicked(t.target))}return!1}function s(t){var a=e(this).siblings("input")[0],n=a.id.split("--");e(a).prop("checked",!0),L[n[0]]&&L[n[0]].radioClicked&&L[n[0]].radioClicked(e(this).siblings("input")[0])}function i(e){var t=this.id.split("--");L[t[0]]&&L[t[0]].radioClicked&&L[t[0]].radioClicked(e.target)}function l(t){for(var a=0;a<t.length;a++)if("renderNodeCommand"==t[a].command){var n=e("#"+t[a].data.popupId+" .container",L.context);null!=n&&n.html(t[a].htmlContents)}}function d(t){t.preventDefault();var a=e(t.target,L.context).data("nid"),n=e(t.target,L.context).data("viewmode"),o=e(t.target,L.context).data("blockid");Drupal.atomizer.base.doAjax("/ajax-ab/renderNode",{nid:a,viewMode:n,popupId:o},l)}function u(){if(L.atomizer.theme)for(var t in L.atomizer.theme.settings){var a=L.atomizer.theme.settings[t],n=t.replace(/_/g,"-");if(e("."+n,L.context)[0]||"rotation"==a.type||"position"==a.type)switch(a.type){case"color":case"range":case"opacity":case"scale":case"rotation":case"position":L.theme.setInit(a.defaultValue,n,a.type)}}}function v(){j&&(j.value||(j[0].selected=!0),m())}function m(){e(".blocks--theme .control-block",L.context).addClass("az-hidden");var t=e(".blocks--"+j.value,L.context);t.insertAfter(e(j)),t.removeClass("az-hidden")}function h(){if(u(),f(),e(".az-controls-form",L.context)[0]){v(),j&&j.addEventListener("change",function(t){m(e(".blocks--"+t.value,L.context))});for(var t in L.atomizer.theme.settings){var a=L.atomizer.theme.settings[t],n=t.replace(/_/g,"-"),l=e("."+n,L.context)[0];if(l||"rotation"==a.type||"position"==a.type)switch(a.type){case"color":l.addEventListener("input",o);break;case"range":case"rotation":case"position":e("."+(n+"--az-slider"),L.context)[0].addEventListener("input",o),L.theme.setInit(a.defaultValue,n,a.type);break;case"saveyml":e("."+n+"--button",L.context)[0];e("."+n+"--button",L.context)[0].addEventListener("click",c);break;case"selectyml":l.addEventListener("change",r);break;case"link":case"button":case"toggle":l.addEventListener("click",c);break;case"radios":var h=e(l).find("input");h.click(i),h.siblings("label").click(s);break;case"popup-node":l.addEventListener("click",d)}}return e(".toggle-block",L.context).each(function(){var t=e(this).data("blockid").split("--")[1],a=e("#blocks--"+t,L.context);a.find(".az-block-header").click(function(n){a.addClass("az-hidden"),e("#blocks--buttons #toggle--"+t,L.context).removeClass("az-selected")})}),e(".toggle-block",L.context).click(function(t){var a=e("."+e(this).data("blockid"),L.context);if(a.hasClass("az-hidden")){L.context.hasClass("az-overlay-controls")&&L.context.hasClass("display-mode-desktop")&&(e(".toggle-block",L.context).removeClass("az-selected"),e(".control-block",L.context).each(function(){"blocks--buttons"!=this.id&&"blocks--animation--wrapper"!=this.id&&e(this).addClass("az-hidden")}));var n=e(this).data("blockid");a.removeClass("az-hidden"),e(this).addClass("az-selected"),a.insertAfter(e(".blocks--buttons",L.context)),"blocks--theme"===n&&v()}else a.addClass("az-hidden"),e(this).removeClass("az-selected")}),e("#controls--snapshot",L.context).click(function(){var t=e(this).find("audio")[0];t.volume=.1,t.play();var a=L.canvas.width,n=L.canvas.height;L.canvas.width=2560,L.canvas.height=2560,L.renderer.setSize(L.canvas.width,L.canvas.height),L.renderer.setViewport(0,0,L.canvas.width,L.canvas.height),L.camera.aspect=L.canvas.width/L.canvas.height,L.camera.updateProjectionMatrix(),L.render(),R=L.canvas.toDataURL("image/jpeg"),L.canvas.width=a,L.canvas.height=n,L.renderer.setSize(L.canvas.width,L.canvas.height),L.renderer.setViewport(0,0,L.canvas.width,L.canvas.height),L.camera.aspect=L.canvas.width/L.canvas.height,L.camera.updateProjectionMatrix(),L.render();var o=L.scene.az.name.replace(/ /g,"-");Drupal.atomizer.base.doAjax("/ajax-ab/save-image",{atomNid:L.scene.az.atomNid,action:"save-image",filename:o,directory:"atoms",overwrite:!1,sceneName:L.scene.az.atomName,imgBase64:R},function(e){})}),!1}}function p(e){var t=e.changedTouches[0],a="";switch(e.type){case"touchstart":a="mousedown";break;case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var n=0;t.clientX,L.canvas.width;.9*L.canvas.width<t.clientX&&(n=1);var o=document.createEvent("MouseEvent");o.initMouseEvent(a,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,n,null),t.target.dispatchEvent(o)}function f(){document.addEventListener("touchstart",p,!0),document.addEventListener("touchmove",p,!0),document.addEventListener("touchend",p,!0),document.addEventListener("touchcancel",p,!0)}function g(){var e=new THREE.OrbitControls(L.camera,L.renderer.domElement);return e.rotateSpeed=.45,e.zoomSpeed=.8,e.panSpeed=.5,e.enableZoom=!0,e.enablePan=!0,e.enableDamping=!0,e.dampingFactor=.3,e.keys=[65,83,68],e}function b(e){var t=new THREE.TrackballControls(e,L.renderer.domElement);return t.rotateSpeed=2,t.zoomSpeed=1,t.panSpeed=3,t.noZoom=!1,t.noPan=!1,t.staticMoving=!0,t.keys=[65,83,68],t.addEventListener("change",L.render),t}function k(e){if(e){var t=new THREE.Vector3(T.x,T.y,.5);t.unproject(L.camera);var a=new THREE.Raycaster(L.camera.position,t.sub(L.camera.position).normalize());return L.render(),a.intersectObjects(e)}return[]}function x(e){T.x=e.offsetX/L.canvas.width*2-1,T.y=-e.offsetY/L.canvas.height*2+1,L.producer.hoverObjects&&L.producer.hovered(k(L.producer.hoverObjects())),L.render()}function z(e){if(Y.x=e.offsetX/L.canvas.width*2-1,Y.y=-e.offsetY/L.canvas.height*2+1,console.log("onMouseDown "+T.x+" "+T.y),L.producer.mouseDown)return L.producer.mouseDown(e)}function w(e){T.x=e.offsetX/L.canvas.width*2-1,T.y=-e.offsetY/L.canvas.height*2+1;var t=T.distanceTo(Y);if(console.log("onMouseUp "+T.x+" "+T.y+"  "+t),L.producer.mouseUp)return L.producer.mouseUp(e,t)}var E,y,C,L=t,D="none",j=e(".theme--selectBlock",L.context)[0],R=document.createElement("IMG"),T=new THREE.Vector2(-1e3,-1e3),Y=new THREE.Vector2(-1e3,-1e3);return{init:function(){h(),n("atom_builder"),L.producer.setDefaults&&L.producer.setDefaults(),(C=new THREE.Raycaster).ray.direction.set(0,-1,0),L.controls.projector=new THREE.Projector},getDefault:function(t,a){var n=e("."+t,L.context);return n.length?n.hasClass("az-control-range")||n.hasClass("az-control-rotation")||n.hasClass("az-control-position")?a?e("#"+t+"--"+a+"--az-slider",L.context)[0].value:e("#"+t+"--az-slider",L.context)[0].value:n.hasClass("az-control-radios")?e("input[name="+n.attr("id")+"]:checked",L.context).val():n.val():(console.log("atomizer_controls.js - control not found - "+t),null)},findIntersects:k}}}(jQuery);
jQuery,Drupal.atomizer.nucletC=function(e){function t(e,t,r){for(var a=new THREE.Geometry,o=w.theme.get(e+"Axis--opacity"),n=new THREE.LineBasicMaterial({color:w.theme.get(e+"Axis--color"),opacity:o,transparent:o<T.transparentThresh,visible:o>T.visibleThresh,linewidth:2}),i=0;i<t.vertices.length;i++){var s;s=r.vertices[t.vertices[i][0]],a.vertices.push(new THREE.Vector3(s.x,s.y,s.z)),s=r.vertices[t.vertices[i][1]],a.vertices.push(new THREE.Vector3(s.x,s.y,s.z))}var c=new THREE.LineSegments(a,n);return c.name=e+"Axis",t.scale&&c.scale.set(t.scale,t.scale,t.scale),c}function r(e,t,r,a){var o=w.theme.get(e+"--opacity"),n=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:w.theme.get(e+"--color"),opacity:o,transparent:o<T.transparentThresh,visible:o>T.visibleThresh,wireframe:!0,wireframeLinewidth:w.theme.get(e+"--linewidth")}));if(n.scale.set(t,t,t),n.name=e,a)for(var i in R){var s=R[i];if(a[s]){var c=a[s]/360*2*Math.PI;n.rotation["init_"+s]=c,n.rotation[s]=c}}return z(e,n),n}function a(e,t,r,a){if(!r.indices&&!r.azfaces)return null;var o,n=w.theme.get(e+"--opacity"),i=new THREE.LineBasicMaterial({color:w.theme.get(e+"--color"),opacity:n,transparent:n<T.transparentThresh,visible:n>T.visibleThresh,linewidth:w.theme.get(e+"--linewidth")}),s=new THREE.Group;if(s.name=e,r.azfaces)for(u=0;u<r.azfaces.length;u++){for(var c=r.azfaces[u],l=new THREE.Geometry,p=0;p<c.indices.length;p++)o=r.vertices[c.indices[p]],l.vertices.push(new THREE.Vector3(o.x,o.y,o.z));o=r.vertices[c.indices[0]],l.vertices.push(new THREE.Vector3(o.x,o.y,o.z)),s.add(new THREE.Line(l,i))}else for(var h=["a","b","c","d","e"],u=0;u<r.faces.length;u++){for(var l=new THREE.Geometry,c=r.faces[u],p=0;p<h.length;p++)h[p]in c&&(o=r.vertices[c[h[p]]],l.vertices.push(new THREE.Vector3(o.x,o.y,o.z)));o=r.vertices[c.a],l.vertices.push(new THREE.Vector3(o.x,o.y,o.z)),s.add(new THREE.Line(l,i))}if(s.scale.set(t,t,t),a)for(var m in R){var v=R[m];if(a[v]){var d=a[v]/360*2*Math.PI;s.rotation["init_"+v]=d,s.rotation[v]=d}}return z(e,s),s}function o(e,t,r,a,o){var n;if(o){r.dynamic=!0;var i=new THREE.MeshLambertMaterial({color:w.theme.get(e+"--color"),opacity:w.theme.get(e+"--opacity"),transparent:!0,vertexColors:THREE.FaceColors}),s=new THREE.MeshLambertMaterial({color:w.theme.get(e+"--color"),opacity:0,transparent:!0,vertexColors:THREE.FaceColors});n=new THREE.Mesh(r,new THREE.MultiMaterial([s,i]));for(p=0;p<o.length;p++)r.faces[o[p]].materialIndex=1}else{var c=w.theme.get(e+"--opacity"),l=new THREE.MeshStandardMaterial({color:w.theme.get(e+"--color"),opacity:c,transparent:c<T.transparentThresh,visible:c>T.visibleThresh,roughness:.5,metalness:0,vertexColors:THREE.FaceColors});n=new THREE.Mesh(r,l)}if(n.scale.set(t,t,t),n.name=e,a)for(var p in R){var h=R[p];if(a[h]){var u=a[h]/360*2*Math.PI;n.rotation["init_"+h]=u,n.rotation[h]=u}}return z(e,n),n}function n(e,t){t=t||!1,e.az.highlight=t;for(var r in e.az.protons)e.az.protons.hasOwnProperty(r)&&b(e.az.protons[r],null)}function i(e,t,r,a,o){switch(e){case"beryllium":case"boron":case"boron10":case"boron11":case"carbon":case"lithium":return w.shapes.getGeometry("nuclet",e,r,null,o);case"initial":case"final":return w.shapes.getGeometry("backbone",e,r,null,o);case"neutral":case"icosahedron":return w.shapes.getGeometry("icosahedron",e,r,null,o);case"decahedron":return w.shapes.getGeometry("decahedron","final",r,a,o);case"line":var n=new THREE.Geometry,i=2*H;return n.vertices.push(new THREE.Vector3(i,0,0)),n.vertices.push(new THREE.Vector3(0,0,0)),n.vertices.push(new THREE.Vector3(-i,0,0)),n;case"tetrahedron":return new THREE.TetrahedronGeometry(r,o);case"dodecahedron":case"hexahedron":case"backbone":return w.shapes.getGeometry(e,t,r,null,o);case"octahedron":return new THREE.OctahedronGeometry(r,o)}}function s(e){var t=w.theme.get("proton--color-style");switch(t||(t="nuclet"),name="proton-default",e.type){case"grey":name="proton-default";break;case"ghost":name="proton-ghost";break;case"neutral":name="neutral";break;case"neutron":name="proton-neutron";break;case"proton":switch(t){case"default":break;case"pairs":name="proton-"+e.pairs;break;case"rings":name="proton-"+e.rings;break;case"alpha3":name="proton-"+e.alpha3;break;case"nuclet":if(e.nuclet){var r=e.nuclet.state;"hydrogen"===r||"helium"===r?name="proton-default":"neutral"===e.pairs?name="proton-neutral":"neutron"===e.pairs?name="proton-neutron":"initial"===e.nuclet.state?name=e.id.replace("P","")<12?"proton-initial":"proton-neutral":name="proton-"+r}else name="proton-default";break;default:name="proton-default"}}return name}function c(e,t,r,a,o,n){var i,c={id:e,type:t.type||"proton",pairs:t.pairs||"default",alpha3:t.alpha3||"default",rings:t.rings||"default",visible:!("visible"in t)||t.visible,optional:t.optional||!1,active:t.active||!0,nuclet:n,atomConf:r},a=w.theme.get("proton--opacity");i=!1!==c.active&&(!1!==c.visible&&a>T.visibleThresh);var l=s(c),p=Drupal.atomizer.base.makeObject("proton",{phong:{color:w.theme.getColor(l+"--color"),opacity:a,transparent:a<T.transparentThresh,visible:i}},{scale:w.theme.get("proton--scale"),radius:H},{x:o.x,y:o.y,z:o.z},P);return P||(P=p.geometry),p.name=l,p.material.visible=i,p.az=c,p}function l(e){}function p(e,t,r){var a=w.theme.get(e+"--opacity"),o=new THREE.AxisHelper(t);return o.name=e,o.material.linewidth=r,o.material.opacity=a,o.material.visible=a>.02,o.material.transparent=a<.97,o}function h(e,t,r){var a;switch(r.state){case"neutral":e.vertices[9].set(0,.1616236535868876*H,.0998889113026354*H)}if(r.protons=[],r.protonGeometry=e,r.conf.protons){var o=w.theme.get("proton--opacity");for(a in t.protons)if(t.protons.hasOwnProperty(a)&&(!t.protons[a].hasOwnProperty("optional")||"placeholder"!=t.protons[a].optional)){t.protons[a].visible=a in r.conf.protons;var n=a.replace("P","");if(e.vertices[n]){var i=c(a,t.protons[a],r.conf.protons[a],o,e.vertices[n],r);r.conf.protons[a]&&r.conf.protons[a].color&&b(i,r.conf.protons[a].color),r.protons[a]=i}}}return r.protons}function u(e,t,r,a){var o;if(r.neutrons=[],t.neutrons){var n=w.theme.get("proton--opacity"),i=t.neutrons;for(var s in i)if(i.hasOwnProperty(s)){o=new THREE.Vector3;for(var l=0;l<i[s].length;l++)o.add(function(e,t,r,a){var o=new THREE.Vector3,n=new THREE.Vector3;o.subVectors(r,e),n.subVectors(t,e),o.cross(n),o.normalize(),o.multiplyScalar(100*Math.sqrt(2/3));var i=new THREE.Vector3;return i=i.add(e).add(t).add(r).divideScalar(3),null==a||a>=0?i.add(o):i.sub(o),i}(e.vertices[i[s][l][0].replace("P","")],e.vertices[i[s][l][1].replace("P","")],e.vertices[i[s][l][2].replace("P","")],i[s][l][3]||0));if(o.divideScalar(i[s].length),console.log(o.x/H+", "+o.y/H+", "+o.z/H+",     "),"0"==s.charAt(2)&&("initial"==t.shape||"final"==t.shape)){Number(s.charAt(1));o=e.vertices[20+Number(s.charAt(1))]}var p=!(!r.conf.neutrons||!r.conf.neutrons.contains(s));i[s].visible=p,i[s].optional=!0,i[s].type="neutron";var h=c(s,i[s],null,n,o,r);h.az.protons=i[s],h.az.position=o,r.neutrons[s]=h,h.az.tetrahedrons=[];for(var u=0;u<h.az.protons.length;u++){var m=[h.az.position];for(var v in h.az.protons[u])if(3!=v&&h.az.protons[u].hasOwnProperty(v)){var d=h.az.nuclet.protonGeometry.vertices[h.az.protons[u][v].replace("P","")],f=new THREE.Vector3;f.add(d),m.push(f)}var g=w.nuclet.createTetrahedronLines("tetraLinesWireframe",m,p);g.name="tetraLinesWireframe",h.az.tetrahedrons.push(g),h.az.nucletGroup=a,a.add(g)}}}return r.neutrons}function m(e,t,r){r.tetrahedrons=[];for(var a=0;a<e.tetrahedrons.length;a++){var o=C("tetra");o.azid="t"+a,r.tetrahedrons[a]=o,o.children[1].geometry.protons=[];for(var n=0;n<4;n++){var i=e.tetrahedrons[a].vertices[n],s=i.replace("P","").replace("U","");o.children[0].geometry.vertices[n].x=t.vertices[s].x,o.children[0].geometry.vertices[n].y=t.vertices[s].y,o.children[0].geometry.vertices[n].z=t.vertices[s].z,o.children[1].geometry.vertices[n].x=t.vertices[s].x,o.children[1].geometry.vertices[n].y=t.vertices[s].y,o.children[1].geometry.vertices[n].z=t.vertices[s].z,o.protons[n]=r.protons[i]}}return r.tetrahedrons}function v(e,t){var r=new THREE.Group;r.name=e,r.az={type:e};var a=w.theme.get(e+"-core--opacity")||1,o=Drupal.atomizer.base.makeObject("electron",{phong:{color:w.theme.get(e+"-core--color"),opacity:a,transparent:a<T.transparentThresh,visible:a>T.visibleThresh}},{scale:w.theme.get(e+"-core--scale"),radius:x},t,G);G||(G=o.geometry),o.name=e+"-core",r.add(o);var n=w.theme.get(e+"-field--opacity")||1,i=Drupal.atomizer.base.makeObject("proton",{phong:{color:w.theme.get(e+"-field--color"),opacity:n,transparent:n<T.transparentThresh,visible:n>T.visibleThresh}},{scale:w.theme.get(e+"-field--scale"),radius:H},t,P);P||(P=r.geometry),i.name=e+"-field",r.add(i);var s=w.theme.get(e+"-orbital--opacity")||1,c=Drupal.atomizer.base.makeObject("proton",{phong:{color:w.theme.get(e+"-orbital--color"),opacity:s,transparent:s<T.transparentThresh,visible:s>T.visibleThresh}},{scale:w.theme.get(e+"-orbital--scale"),radius:H},t,P);return P||(P=r.geometry),c.name=e+"-orbital",r.add(c),r}function d(e,t){var r=[];for(var a in t.conf.electrons)if(t.conf.electrons.hasOwnProperty(a)){for(var o=new THREE.Vector3,n=t.conf.electrons[a].protons,i=0;i<n.length;i++){var s=n[i];if("string"==typeof s&&s.includes("U")){t.neutrons[s.charAt(1)];o.add(t.neutrons[s].position)}else o.add(e.vertices[s.replace("P","")])}o.divideScalar(n.length);var c=v("electron1",o);c.az.vertices=n,c.az.id=a,r[a]=c}return r}function f(e,t,o){return"dodecahedron"==o.shape||"carbon"==o.shape||"lithium"==o.shape||"hexahedron"==o.shape||"beryllium"==o.shape||"initial"==o.shape||"final"==o.shape||"boron"==o.shape||"boron10"==o.shape||"boron11"==o.shape?a(e,o.scale,t,o.rotation||null):r(e,o.scale+.02,t,o.rotation||null)}function g(e,r,a,n,s){var c=i(a.shape,s.state||"",a.scale*H,(a.scaleHeight||1)*H);c.shapeConf=a,c.scaleInit=a.scale;var l;if(r.rotate&&(r.rotation.x&&(l=r.rotation.x/360*2*Math.PI,c.applyMatrix((new THREE.Matrix4).makeRotationX(l))),r.rotation.y&&(l=r.rotation.y/360*2*Math.PI,c.applyMatrix((new THREE.Matrix4).makeRotationY(l))),r.rotation.z&&(l=r.rotation.z/360*2*Math.PI,c.applyMatrix((new THREE.Matrix4).makeRotationZ(l)))),a.protons){var p=h(c,a,s);for(var v in p)p.hasOwnProperty(v)&&(p[v].az.nucletGroup=n,n.add(p[v]))}if(a.neutrons){var g=u(c,a,s,n);for(var v in g)g.hasOwnProperty(v)&&g[v]&&(g[v].az.nucletGroup=n,n.add(g[v]))}if(a.nelectrons&&s.conf.electrons){var y=d(c,s);for(var E in y)y.hasOwnProperty(E)&&(n.add(y[E]),y[E].az.nuclet=s,s.nelectrons[y[E].az.id]=y[E])}if(a.axes&&n.add(t(e,a.axes,c)),a.tetrahedrons)for(var z=m(a,c,s),b=0;b<z.length;b++)n.add(z[b]);if(a.wireframe){var T=f(e+"Wireframe",c,a);T&&n.add(T)}if(a.faces){if(a.assignFaceOpacity&&s.conf.reactiveState){var R=s.conf.reactiveState[e]?s.conf.reactiveState[e].slice():[];c.reactiveState=s.reactiveState=R,c.shapeConf=a}var x=o(e+"Faces",a.scale,c,a.rotation||null,s.reactiveState);n.add(x)}return a.particleids&&n.add(w.sprites.createVerticeIds(a.particleids,c)),c}function y(e,t,r){var a=new THREE.Group;a.name=e;var o=parseFloat(w.theme.get(e+"--scale"));if(a.scale.set(o,o,o),t.alignyaxis){var n=r.protonGeometry.vertices[t.alignyaxis.vertices[0]],i=r.protonGeometry.vertices[t.alignyaxis.vertices[1]],s=n.clone().sub(i);Drupal.atomizer.base.alignObjectToAxis(a,new THREE.Vector3(0,1,0),s.clone().normalize(),!1);var c=new THREE.Vector3(0,0,0).add(s).multiplyScalar(t.alignyaxis.attachPt);a.position.set(c.x,c.y,c.z);var l=t.alignyaxis.rotatey/360*2*Math.PI;a.rotation.y=l}for(var p in t.components)t.components.hasOwnProperty(p)&&g(e,t,t.components[p],a,r);return a}function E(e){w.atom.az().nuclets[e.az.id+"0"]&&E(w.atom.az().nuclets[e.az.id+"0"]),w.atom.az().nuclets[e.az.id+"1"]&&E(w.atom.az().nuclets[e.az.id+"1"]);for(var t=0;t<e.az.protons.length;t++)e.az.protons[t]&&l([e.az.protons[t]]);delete w.atom.az().nuclets[e.az.id],e.parent.parent.parent.remove(e.parent.parent)}function z(e,t){w.objects||(w.objects={}),w.objects[e]?w.objects[e].push(t):w.objects[e]=[t]}function b(e,t){if(n=!!e.az.nuclet.highlight&&e.az.nuclet.highlight,t){if("original"==t)return e.material.color=w.theme.getColor(e.name+"--color",n),e.az.tmpColor&&delete e.az.tmpColor,void(e.az.selected&&delete e.az.selected);e.az.tmpColor=w.theme.getColor("proton-"+t+"--color",n)}e.az.selected?e.material.color=w.theme.getColor("proton-ghost--color",n):e.az.tmpColor?e.material.color=w.theme.getColor(e.az.tmpColor.base,n):e.material.color=w.theme.getColor(e.name+"--color",n)}var w=e,T=Drupal.atomizer.base.constants,R=["x","y","z"],H=w.theme.get("proton--radius"),x=w.theme.get("electron--radius"),P=null,G=null,C=function(e){var t=new THREE.Group;t.name="tetrahedron",t.protons=[],t.protonRadius=H;var r=new THREE.TetrahedronGeometry(1.222*w.nuclet.protonRadius);return r.dynamic=!0,t.add(w.nuclet.createGeometryWireframe(e+"Wireframe",1,r,null,null)),t.add(w.nuclet.createGeometryFaces(e+"Faces",1,r,null,null)),t};return{makeProton:c,createNElectron:v,getProtonName:s,showProtons:function(e,t,r){for(var a=0;a<r.length;a++){var o=e.az.protons[r[a]];t?(o.material.visible=!0,o.material.opacity=1,o.material.transparent=!1):(o.material.visible=!1,o.material.opacity=0,o.material.transparent=!0)}},createNuclet:function(e,t){var r=new THREE.Group;r.name="nuclet-"+e,t.state=t.state.replace("backbone-",""),r.az={protonRadius:H,conf:t,id:e,state:t.state,protons:[],electrons:{},nelectrons:{}},r.geo=drupalSettings.atomizer_config.objects[t.state];var a;switch(r.az.state){case"dodecahedron":a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19];break;case"neutral":a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21];break;case"lithium":a=[0,1,3,4,5,9,11];break;case"beryllium":a=[1,3,4,5,6,7,9,10,11];break;case"boron":case"boron10":a=[1,2,3,4,5,6,7,9,10,11];break;case"boron11":a=[0,1,2,3,4,5,6,7,9,10,11];break;case"carbon":a=[0,1,2,3,4,5,6,7,8,9,10,11];break;case"initial":case"final":a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]}r.az.conf.protons||(r.az.conf.protons=a),"N0"!=e&&(i in r.az.conf.protons&&(r.az.conf.protons[i]=void 0),"boron10"===r.az.conf.state&&"boron"===r.az.conf.state&&i in r.az.conf.protons&&(r.az.conf.protons[i]=void 0));for(var o in r.geo.geoGroups)if(r.geo.geoGroups.hasOwnProperty(o)){var n=y(o,r.geo.geoGroups[o],r.az);r.add(n)}if(r.add(p("nucletAxis",6*H,1)),r.az.conf.rotation)for(var i in R){var s=R[i];if(r.az.conf.rotation[s]){var c=r.az.conf.rotation[s]/360*2*Math.PI;r.rotation["init_"+s]=c,r.rotation[s]=c}}var l=new THREE.Object3D;l.name="nucletInner-"+e,l.add(r),l.add(p("nucletInnerAxis",5*H,3));var h=new THREE.Object3D;return h.name="nucletOuter-"+e,h.add(l),h.add(p("nucletOuterAxis",4*H,5)),r.az.conf.position&&(h.position.x=r.az.conf.position.x||0,h.position.y=r.az.conf.position.y||0,h.position.z=r.az.conf.position.z||0),h},deleteNuclet:E,createGeometry:i,createGeometryWireframe:r,createGeometryFaces:o,createTetrahedronLines:function(e,t,r){var a=w.theme.get(e+"--opacity"),o=new THREE.LineBasicMaterial({color:w.theme.get(e+"--color"),opacity:a,transparent:a<T.transparentThresh,visible:r,linewidth:w.theme.get(e+"--linewidth")}),n=new THREE.Geometry;return n.vertices.push(t[3]),n.vertices.push(t[2]),n.vertices.push(t[1]),n.vertices.push(t[3]),n.vertices.push(t[0]),n.vertices.push(t[1]),n.vertices.push(t[2]),n.vertices.push(t[0]),new THREE.Line(n,o)},highlight:n,protonRadius:H,setProtonColor:b,setElectronColor:function(e,t,r){var a,o=e.az.nuclet;if(e.az.selected||t){if(e.children[0].material.color=w.theme.getColor(e.name+"-core--color-highlight"),e.children[1].material.color=w.theme.getColor(e.name+"-field--color-highlight"),e.children[2].material.color=w.theme.getColor(e.name+"-orbital--color-highlight"),r)for(var n in e.az.vertices)e.az.vertices.hasOwnProperty(n)&&((a="string"==typeof(i=e.az.vertices[n])&&i.includes("U")?o.neutrons[i]:o.protons[i]).az.selected=!0,w.nuclet.setProtonColor(a,null))}else if(e.children[0].material.color=w.theme.getColor(e.name+"-core--color"),e.children[1].material.color=w.theme.getColor(e.name+"-field--color"),e.children[2].material.color=w.theme.getColor(e.name+"-orbital--color"),r)for(var n in e.az.vertices)if(e.az.vertices.hasOwnProperty(n)){var i=e.az.vertices[n];(a="string"==typeof i&&i.includes("U")?o.neutrons[i]:o.protons[i]).az.selected=!1,w.nuclet.setProtonColor(a,null)}},getConstants:function(){return T}}};
Drupal.atomizer.shapesC=function(e){function t(e,t,s){var c=(1+Math.sqrt(5))/2,r=[0,1,c,0,-1,c,0,1,-c,0,-1,-c,c,0,1,c,0,-1,-c,0,-1,-c,0,1,1,c,0,-1,c,0,1,-c,0,-1,-c,0],i=[9,0,8,9,8,2,10,1,11,10,11,3,8,0,4,1,4,0,10,4,1,4,5,8,10,5,4,2,8,5,5,3,2,10,3,5,9,2,6,6,2,3,3,11,6,9,6,7,7,6,11,9,7,0,0,7,1,11,1,7];THREE.PolyhedronGeometry.call(this,r,i,t,s),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:s}}function s(e,t,s){var c=(1+Math.sqrt(5))/2,r=[c,1,0,c,-1,0,-c,1,0,-c,-1,0,1,0,-c,-1,0,-c,-1,0,c,1,0,c,0,c,-1,0,c,1,0,-c,-1,0,-c,1];switch(this.indices=[],e){case"lithium":this.indices=[1,4,10,4,5,10,3,5,10,3,10,11,1,10,11,1,4,9,4,5,9,3,5,9,3,9,11,1,9,11],r.push.apply(r,[0,1.679,-1.198,-1.809,.988,-.08,-1.118,-.129,1.729,1.118,-.129,1.729,1.809,.988,-.08]),r[27]=0,r[28]=.1616,r[29]=.09989;break;case"beryllium":this.indices=[1,4,10,4,5,10,3,5,10,3,10,11,1,10,11,1,4,9,4,5,9,3,5,9,1,7,9,6,7,9,3,6,9,3,6,11,1,7,11,6,7,11],r[3]=.8*r[3],r[4]=.8*r[4],r[9]=.8*r[9],r[10]=.8*r[10],r[14]=1*r[14],r[17]=1*r[17],r[20]=1*r[20],r[23]=1*r[23],r[27]=0,r[28]=.6,r[29]=0;break;case"boron":case"boron10":case"boron11":this.indices=[1,4,10,4,5,10,3,5,10,3,10,11,1,10,11,0,4,9,4,5,9,2,5,9,0,7,9,6,7,9,2,6,9,3,6,11,1,7,11,6,7,11,1,0,7,0,4,1,2,3,5,2,3,6],r[0]=1.23*r[0],r[1]=.95*r[1],r[6]=1.23*r[6],r[7]=.95*r[7],r[14]=.85*r[14],r[17]=.85*r[17],r[20]=.85*r[20],r[23]=.85*r[23],r[27]=0,r[28]=.95,r[29]=0;break;case"carbon":this.indices=[9,0,8,9,8,2,10,1,11,10,11,3,8,0,4,1,4,0,10,4,1,4,5,8,10,5,4,2,8,5,5,3,2,10,3,5,9,2,6,6,2,3,3,11,6,9,6,7,7,6,11,9,7,0,0,7,1,11,1,7],r.push.apply(r,[1.8155,1.8155,-1.8155,2.9375,0,-1.122,2.9375,0,1.122,1.8155,1.8155,1.8155,-1.8155,1.8155,-1.8155,-2.9375,0,-1.122,-2.9375,0,1.122,-1.8155,1.8155,1.8155])}var i=r.length/3;this.vertices=[];for(var a=0;a<i;a++){var n=3*a,o=r[n]*t,h=r[n+1]*t,d=r[n+2]*t,p=new THREE.Vector3(o,h,d);p.index=a,this.vertices.push(p)}var E=this.vertices;this.faces=[];for(var f=0,u=0,y=this.indices.length;f<y;f+=3,u++){var l=E[this.indices[f]],v=E[this.indices[f+1]],m=E[this.indices[f+2]];this.faces[u]=new THREE.Face3(l.index,v.index,m.index,[l.clone(),v.clone(),m.clone()])}this.type="IcoGeometry",this.parameters={radius:t,detail:s}}function c(e,t,s){var c=[1.358,1.036,0,1.542,-.95,0,-1.358,1.036,0,-1.542,-.95,0,.99,0,-1.651,-.99,0,-1.651,-.99,0,1.651,.99,0,1.651,0,1.674,-1.291,0,1.674,1.291,0,-1.605,-1,0,-1.605,1,1.919,1.743,1.765,2.855,.172,.997,2.855,.172,-.997,1.919,1.743,-1.765,-1.919,1.743,-1.765,-2.855,.172,-.997,-2.855,.172,.997,-1.919,1.743,1.765,2.85,1.9,0,-2.85,1.9,0];this.indices=[9,0,8,9,8,2,10,1,11,10,11,3,8,0,4,1,4,0,10,4,1,4,5,8,10,5,4,2,8,5,5,3,2,10,3,5,9,2,6,6,2,3,3,11,6,9,6,7,7,6,11,9,7,0,0,7,1,11,1,7];var r=c.length/3;this.vertices=[];for(var i=0;i<r;i++){var a=3*i,n=c[a]*t,o=c[a+1]*t,h=c[a+2]*t;"initial"==e&&(percent=0,0!=i&&2!=i||(n*=1-percent),8!=i&&9!=i||(h*=1+percent)),"final"==e&&(percent=.1,0!=i&&2!=i||(n*=1-percent),8!=i&&9!=i||(h*=1+percent));var d=new THREE.Vector3(n,o,h);d.index=i,this.vertices.push(d)}var p=this.vertices;this.faces=[];for(var E=0,f=0,u=this.indices.length;E<u;E+=3,f++){var y=p[this.indices[E]],l=p[this.indices[E+1]],v=p[this.indices[E+2]];this.faces[f]=new THREE.Face3(y.index,l.index,v.index,[y.clone(),l.clone(),v.clone()])}this.type="BackboneGeometry",this.parameters={radius:t,detail:s}}function r(e,t){var s=(1+Math.sqrt(5))/2,c=1/s,r=[1,1,1,c,s,0,-c,s,0,-1,1,1,0,c,s,1,1,-1,s,0,c,0,-c,s,-s,0,c,-1,1,-1,1,-1,-1,c,-s,0,-c,-s,0,-1,-1,-1,0,-c,-s,s,0,-c,1,-1,1,-1,-1,1,-s,0,-c,0,c,-s],i=[15,10,14,15,14,19,15,19,5,5,19,9,5,9,2,5,2,1,14,13,18,14,18,9,14,9,19,10,11,12,10,12,13,10,13,14,6,16,11,6,11,10,6,10,15,0,6,15,0,15,5,0,5,1,9,18,8,9,8,3,9,3,2,13,12,17,13,17,8,13,8,18,17,12,11,17,11,16,17,16,7,4,7,16,4,16,6,4,6,0,3,4,0,3,0,1,3,1,2,8,17,7,8,7,4,8,4,3];THREE.PolyhedronGeometry.call(this,r,i,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.azfaces=[{indices:[3,4,7,6,5],faces:[0,1,2]},{indices:[0,1,3,4,2],faces:[0,1,2]},{indices:[1,3,5,9,8],faces:[0,1,2]},{indices:[6,7,14,19,16],faces:[0,1,2]},{indices:[5,6,16,15,9],faces:[0,1,2]},{indices:[8,9,15,17,11],faces:[0,1,2]},{indices:[15,16,19,18,17],faces:[0,1,2]},{indices:[10,11,17,18,12],faces:[0,1,2]},{indices:[0,1,8,11,10],faces:[0,1,2]},{indices:[2,13,14,7,4],faces:[0,1,2]},{indices:[12,18,19,14,13],faces:[0,1,2]},{indices:[0,10,12,13,2],faces:[0,1,2]}]}function i(e,t){var s=[1,1,1,1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1],c=[0,1,3,1,2,3,4,5,7,5,6,7,4,7,3,7,0,3,6,5,1,5,2,1,7,6,0,6,1,0,3,2,4,2,5,4];THREE.PolyhedronGeometry.call(this,s,c,e,t),this.type="CubeGeometry",this.parameters={radius:e,detail:t},this.azfaces=[{indices:[0,2,1,3],faces:[0,1]},{indices:[2,0,7,5],faces:[2,3]},{indices:[1,3,4,6],faces:[4,5]},{indices:[1,2,5,6],faces:[6,7]},{indices:[4,6,5,7],faces:[8,9]},{indices:[0,3,4,7],faces:[10,11]}]}function a(e,t,s){var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(0,s,0)),c.vertices.push(new THREE.Vector3(0,-s,0));for(var r=2*Math.PI/e,i=0,a=Math.PI;i<e;i++,a+=r){var n=Math.cos(a),o=Math.sin(a);c.vertices.push(new THREE.Vector3(t*n,0,t*o))}for(i=2;i<e+1;i++)c.faces.push(new THREE.Face3(i+1,i,0)),c.faces.push(new THREE.Face3(1,i,i+1));return c.faces.push(new THREE.Face3(2,e+1,0)),c.faces.push(new THREE.Face3(1,e+1,2)),c.computeFaceNormals(),c}var n=[];(t.prototype=Object.create(THREE.PolyhedronGeometry.prototype)).constructor=t,(s.prototype=Object.create(THREE.PolyhedronGeometry.prototype)).constructor=s,(c.prototype=Object.create(THREE.PolyhedronGeometry.prototype)).constructor=c,(r.prototype=Object.create(THREE.PolyhedronGeometry.prototype)).constructor=r,(i.prototype=Object.create(THREE.PolyhedronGeometry.prototype)).constructor=i;return{createPyramid:function(e,t,s){var c=s/2,r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(0,c,0));for(var i=2*Math.PI/e,a=0,n=Math.PI;a<e;a++,n+=i){var o=Math.cos(n),h=Math.sin(n);r.vertices.push(new THREE.Vector3(t*o,-c,t*h))}for(a=1;a<e;a++)r.faces.push(new THREE.Face3(a+1,a,0));r.faces.push(new THREE.Face3(1,e,0));for(a=2;a<e;a++)r.faces.push(new THREE.Face3(a,a+1,1));return r.computeFaceNormals(),r},createBiPyramid:a,getGeometry:function(e,o,h,d,p){if(n[e]&&n[e][o])return n[e][o];var E;switch(e){case"nuclet":E=new s(o,h,p);break;case"backbone":E=new c(o,h,p);break;case"icosahedron":E=new t(o,h,p);break;case"dodecahedron":E=new r(h,p);break;case"decahedron":E=a(5,h,d);break;case"hexahedron":E=new i(h,p);break;case"backbone":E=new c(o,h,p)}return n[e]||(n[e]={}),n[e][o]=E,E}}};
Drupal.atomizer.spritesC=function(e,r){function t(e,r){var t,o,a;for(t=0,o=e.length;t<o;t++)(a=e[t]).centroid=new THREE.Vector3,a.centroid.set(0,0,0),a.centroid.add(r[a.a]),a.centroid.add(r[a.b]),a.centroid.add(r[a.c]),a.centroid.divideScalar(3)}function o(e,r,t,o,a,i){e.beginPath(),e.moveTo(r+i,t),e.lineTo(r+o-i,t),e.quadraticCurveTo(r+o,t,r+o,t+i),e.lineTo(r+o,t+a-i),e.quadraticCurveTo(r+o,t+a,r+o-i,t+a),e.lineTo(r+i,t+a),e.quadraticCurveTo(r,t+a,r,t+a-i),e.lineTo(r,t+i),e.quadraticCurveTo(r,t,r+i,t),e.closePath(),e.fill(),e.stroke()}function a(e,r){void 0===r&&(r={});var t=r.hasOwnProperty("fontface")?r.fontface:"Arial",a=r.hasOwnProperty("fontsize")?r.fontsize:16,i=r.hasOwnProperty("borderThickness")?r.borderThickness:0,n=r.hasOwnProperty("borderColor")?r.borderColor:"#990099",c=r.hasOwnProperty("backgroundColor")?r.backgroundColor:"#009999",s=r.hasOwnProperty("color")?r.color:"#ffffff",d=document.createElement("canvas"),l=d.getContext("2d");l.font="Bold "+a+"px "+t;var f=l.measureText(e).width;l.fillStyle=c,l.strokeStyle=n,l.lineWidth=i,o(l,0,0,f,1.35*a+i,8),l.fillStyle=s,l.fillText(e,i,a);var p=l.getImageData(0,0,f,88);d.width=f,d.height=88,l.putImageData(p,0,0);var v=new THREE.Texture(d);v.needsUpdate=!0;var u=new THREE.SpriteMaterial({map:v});u.opacity=r.opacity||0,u.transparent=r.transparent||!1,u.visible=r.visible||!0;var h=new THREE.Sprite(u);return h.scale.set(20,20,1),h}var i=e;return{createVerticeIds:function(e,r){var t=new THREE.Group;t.name=e+"Vertexids";var o=i.theme.get(e+"Vertexid--opacity"),n="proton"==e?"Vertexid--color":"Wireframe--color";n=e+n;for(var c={fontsize:60,color:"#000000",backgroundColor:i.theme.get(n),opacity:o,transparent:o<.97,visible:o>.03},s=i.theme.get("proton--radius"),d=0;d<r.vertices.length;d++){var l=a(" "+d+" ",c);l.name=e+"Vertexid",l.position.copy(r.vertices[d]),l.position.setLength(l.position.length()+1.5*s),t.add(l)}return t.scale.set(1,1,1),t},createFaceIds:function(e,r){var o=new THREE.Group;t(r.faces,r.vertices),o.name=e+"Faceids";for(var n=i.theme.get(e+"Faceid--opacity"),c={fontsize:60,color:i.theme.get(e+"Wireframe--color"),backgroundColor:"#000000",opacity:n,transparent:n<.97,visible:n>.03},s=0;s<r.faces.length;s++){var d=a(" "+s+" ",c);d.name=e+"Faceid",l=2,d.position.x=l*r.faces[s].centroid.x,d.position.y=l*r.faces[s].centroid.y,d.position.z=l*r.faces[s].centroid.z,o.add(d)}var l=1;return o.scale.set(l,l,l),o}}};
!function(e){"use strict";Drupal.atomizer.themeC=function(a,t){var r=a,i={},n={},l=r.atomizer.themeDirectory,s={},m=e("#theme--message",r.context)[0],o=function(a){e("#theme--select--"+a[0].data.themeId,r.context).prop("checked",!0),a[0].ymlContents&&(a[0].ymlContents.filepath=a[0].data.filepath,n=a[0].ymlContents,i.name?(d(!1,!1),i.name=n.name,i.description=n.description,i.filepath=n.filepath):(i=JSON.parse(JSON.stringify(n)),d(!0,!0)),t&&(t(),t=null))},c=function(e){var a;a=e[0].data.success?"Theme saved successfully":"ERROR: Could not save theme",m.innerHTML=a,setTimeout(function(){m.innerHTML=""},3e3)},f=function(e){var a=e.settings,t=Object.keys(a).sort();delete e.settings,e.settings={};for(var r in t){t[r];e.settings[t[r]]=a[t[r]]}Drupal.atomizer.base.doAjax("/ajax-ab/saveYml",{name:e.name,component:"theme",filepath:e.filepath,ymlContents:e},c)},d=function(a,t){var l;for(var s in i.settings)if(i.settings.hasOwnProperty(s)&&i.settings[s])if("[object Array]"===Object.prototype.toString.call(i.settings[s].defaultValue)){var m=s.split("--"),o="xyz".indexOf(m[2]);if(l=n.settings[s].defaultValue[o],t||i.settings[s].defaultValue[o]!=l){a||u(s,l);var c;(c=e("#"+s)[0])&&(c.value=l),(c=e("#"+s+"--az-value")[0])&&(c.value=l)}}else r.dataAttr&&r.dataAttr[s]?l=r.dataAttr[s]:n.settings[s]?l=n.settings[s].defaultValue:console.log("Error: No defaultValue found for "+s+" in "+n.filepath),(t||i.settings[s].defaultValue!=l)&&(!a&&n.settings[s]&&u(s,n.settings[s].defaultValue),(c=e("#"+s)[0])&&(c.className.indexOf("az-control-range")>-1?(e("#"+s+"--az-slider").val(l),e("#"+s+"--az-value").val(l)):c.value=l))},u=function(e,a){var t=e.split("--"),n=t[0].split("-");switch(4===t.length?i.settings[t[0]+"--"+t[1]+"--"+t[2]+"--"+t[3]].defaultValue=a:3===t.length?i.settings[t[0]+"--"+t[1]+"--"+t[2]].defaultValue=a:i.settings[t[0]+"--"+t[1]].defaultValue=a,n[0]){case"renderer":r.renderer.setClearColor(new THREE.Color(parseInt(a.replace(/^#/,""),16)),1);break;case"camera":"perspective"==t[1]&&(r.camera.fov=a,r.camera.updateProjectionMatrix());break;default:r.scene.traverse(function(e){var l=e.name.split("-"),s=!1;if("atom"==t[0]?"atom"==l[0]&&(s=!0):"decahedron"==t[0]?"lithium"==l[0]&&(s=!0):t[0].indexOf("wireframe")>-1&&"scale"==t[1]&&l[0].indexOf("face")>-1&&l[0].charAt(0)==t[0].charAt(0)?s=!0:"proton"==n[0]&&"proton"==l[0]?"color"==t[1]?e.az&&e.az.tmpColor?t[0]==e.az.tmpColor.name.split("--")[0]&&(s=!0):t[0]==e.name&&(s=!0):s=!0:2==n.length?t[0]==e.name&&(s=!0):l[0]==n[0]&&(s=!0),s)switch(t[1]){case"rotation":var m=a/360*2*Math.PI;e.rotation[t[2]]=m+(e.rotation["init_"+t[2]]||0);break;case"position":e.position[t[2]]=a;break;case"scale":if("protonVertexid"==t[0])e.initScale||(e.initScale=e.scale.clone()),e.scale.x=a*e.initScale.x,e.scale.y=a*e.initScale.y,e.scale.z=a*e.initScale.z;else if("attachLines"==t[0])r.atom.explodeAtom(a);else{var o=a;e.scale.set(o,o,o)}break;case"width":case"depth":"plane"==n[0]&&(e.geometry=THREE.PlaneBufferGeometry(i.settings["plane--width"],i.settings["plane--depth"]));break;case"opacity":var c=a,f=a>.02,d=a<.97;if("proton"==n[0])e.az.active&&(e.material.opacity=c,e.az.visible&&(e.material.visible=f,e.material.transparent=d));else if(n[0].indexOf("Wireframe")>-1)if("dodecaWireframe"==e.name||"dodecaOutWireframe"==e.name||"icosaWireframe"==e.name||"icosaOutWireframe"==e.name||"lithiumWireframe"==e.name||"berylliumWireframe"==e.name||"boron11Wireframe"==e.name||"boron10Wireframe"==e.name||"carbonWireframe"==e.name||"hexaWireframe"==e.name)for(u=0;u<e.children.length;u++)e.children[u].material.opacity=c,e.children[u].material.visible=f,e.children[u].material.transparent=d;else e.material.opacity=c,e.material.visible=f,e.material.transparent=d;else e.material.materials?(e.material.materials[1].opacity=c,e.material.materials[1].visible=f,e.material.materials[1].transparent=d):e.material[0]?(e.material[0].opacity=c,e.material[0].visible=f,e.material[0].transparent=d):(e.material.opacity=c,e.material.visible=f,e.material.transparent=d);break;case"linewidth":if(n[0].indexOf("Wireframe")>-1)if("dodecaWireframe"==e.name||"dodecaOutWireframe"==e.name||"icosaWireframe"==e.name||"icosaOutWireframe"==e.name||"lithiumWireframe"==e.name||"berylliumWireframe"==e.name||"boron11Wireframe"==e.name||"boron10Wireframe"==e.name||"carbonWireframe"==e.name||"hexaWireframe"==e.name)for(u=0;u<e.children.length;u++)e.children[u].material.linewidth=a,e.children[u].material.visible=a>.05;else e.material.visible=a>.05,e.material.linewidth=a,e.material.wireframeLinewidth=a;else e.material.visible=a>.05,e.material.linewidth=a,e.material.wireframeLinewidth=a;break;case"color":switch(n[0]){case"ambient":case"spotlight":e.color.setHex(parseInt(a.replace(/#/,"0x")),16);break;default:if(n[0].indexOf("Wireframe")>-1)if("dodecaWireframe"==e.name||"dodecaOutWireframe"==e.name||"icosaWireframe"==e.name||"icosaOutWireframe"==e.name||"lithiumWireframe"==e.name||"berylliumWireframe"==e.name||"boron11Wireframe"==e.name||"boron10Wireframe"==e.name||"carbonWireframe"==e.name||"hexaWireframe"==e.name)for(u=0;u<e.children.length;u++)e.children[u].material.color.setHex(parseInt(a.replace(/#/,"0x")),16);else e.material.color.setHex(parseInt(a.replace(/#/,"0x")),16);else if(e.material.materials)for(var u=0;u<e.material.materials.length;u++)e.material.materials[u].color.setHex(parseInt(a.replace(/#/,"0x")),16);else e.material.color.setHex(parseInt(a.replace(/#/,"0x")),16)}}})}r.render()},h=r.view.defaultTheme;return r.view.themePath=r.atomizer.themeDirectory+"/"+h+".yml",Drupal.atomizer.base.doAjax("/ajax-ab/loadYml",{filepath:r.view.themePath,themeId:r.view.defaultTheme,directory:l,component:"theme"},o),{radioClicked:function(a){switch(a.name){case"theme--select":var t=a.value,r=e(a).parents("fieldset").data("directory");Drupal.atomizer.base.doAjax("/ajax-ab/loadYml",{component:"theme--select",filepath:"config/themes/"+r+"/"+t+".yml",themeId:event.target.value},o)}},buttonClicked:function(a){switch(a.id){case"theme--saveButton":f(i);break;case"theme--saveNewButton":var t=e("#theme--saveNewName").val();if(t.length){var n=t.replace(/[|&;$%@"<>()+,]/g,"").replace(/[ -]/g,"_");-1==n.indexOf(".yml")&&(n+=".yml"),i.name=t,i.filepath=l+"/"+n,m.classList.remove("az-error"),m.innerHTML=".... Saving theme",f(i),setTimeout(function(){m.innerHTML=""},3e3)}else m.innerHTML="Please enter a Name....",m.classList.add("az-error");break;case"theme--reset":d();break;case"theme--cameraReset":var s=r.dataAttr.zoom?r.dataAttr.zoom:1;r.camera.position.set(s*r.theme.get("camera--position","x"),s*r.theme.get("camera--position","y"),s*r.theme.get("camera--position","z")),r.camera.lookAt(r.scene.position),r.render()}},applyControl:u,loadYml:o,addDataAttr:function(){for(var e in r.dataAttr)i.settings[e]&&(i.settings[e].defaultValue=r.dataAttr[e])},setInit:function(e,a,t){i.settings[a]||(i.settings[a]={defaultValue:e,type:t})},set:function(e,a){i.settings[a].defaultValue=e},get:function(e,a){e.split("--");var t=e;return a&&(t+="--"+a),i.settings[t]?i.settings[t].defaultValue:r.controls.getDefault(t,a)},getColor:function(e,a){var t=a?e+"-"+a:e;if(!s[t]){var i,n,l,m,o,c,f=r.theme.get(e);switch(a){case"darken":i=-15,o=((n=parseInt(f.slice(1),16))>>8&255)+(l=Math.round(2.55*i)),c=(255&n)+l,f="#"+(16777216+65536*((m=(n>>16)+l)<255?m<1?0:m:255)+256*(o<255?o<1?0:o:255)+(c<255?c<1?0:c:255)).toString(16).slice(1);break;case"lighten":i=15,o=((n=parseInt(f.slice(1),16))>>8&255)+(l=Math.round(2.55*i)),c=(255&n)+l,f="#"+(16777216+65536*((m=(n>>16)+l)<255?m<1?0:m:255)+256*(o<255?o<1?0:o:255)+(c<255?c<1?0:c:255)).toString(16).slice(1)}f||alert("color is null "+e),s[t]=(new THREE.Color).setHex(parseInt(f.replace(/#/,"0x")),16),s[t].hex=f,s[t].name=t,s[t].base=e}return s[t]},getYmlDirectory:function(){return l}}}}(jQuery);
!function(e){Drupal.atomizer.producers={},Drupal.atomizer.viewerC=function(t){function a(e,t){var a=new THREE.SpotLight(t.c);return a.position.set(t.x||-40,t.y||60,t.z||-10),a.castShadow=!0,a.name=e,a}function n(){r.context.removeClass("display-mode-mobile"),r.context.removeClass("display-mode-table"),r.context.removeClass("display-mode-desktop");var t=e("#az-page-select-atom",r.content);if(s)r.canvas.height=window.innerHeight,r.canvas.width=window.innerWidth;else if(window.innerWidth<960){"mobile"!=c&&t.addClass("az-hidden"),c="mobile",r.context.addClass("display-mode-"+c),r.canvas.width=r.canvasContainer.clientWidth;var a=r.canvas.width,n=window.innerHeight-150;r.canvas.height=a<n?a:n}else"desktop"!=c&&t.removeClass("az-hidden"),c="desktop",r.context.addClass("display-mode-"+c),r.canvas.width=r.canvasContainer.clientWidth,r.atomizer.canvasRatio&&"window"!==r.atomizer.canvasRatio?r.canvas.height=r.canvas.width*r.atomizer.canvasRatio:r.canvas.height=window.innerHeight-170,r.canvas.width=r.canvasContainer.clientWidth;r.renderer&&(r.renderer.setSize(r.canvas.width,r.canvas.height),r.renderer.setViewport(0,0,r.canvas.width,r.canvas.height),r.camera.aspect=r.canvas.width/r.canvas.height,r.camera.updateProjectionMatrix(),r.render())}var o,i=[],r={objects:{},context:e("#azid-"+t.atomizerId.toLowerCase())},s=!1,c="",d=function(){r.renderer.render(r.scene,r.camera)},l=function(){r.theme.addDataAttr(),r.canvas=r.canvasContainer.getElementsByTagName("canvas")[0],n(),r.producer=Drupal.atomizer.producers[r.view.producer+"C"](r),r.scene=new THREE.Scene,r.scene.position.set(0,0,0),r.controls=Drupal.atomizer.controlsC(r),r.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:r.canvas,preserveDrawingBuffer:!0,shadowEnabled:!0}),r.renderer.setClearColor(r.theme.get("renderer--color"),1),r.renderer.setSize(r.canvas.width,r.canvas.height),r.canvasContainer.appendChild(r.renderer.domElement),window.addEventListener("resize",n),r.camera=new THREE.PerspectiveCamera(r.theme.get("camera--perspective"),r.canvas.width/r.canvas.height,.1,1e4),zoom=r.dataAttr.zoom?r.dataAttr.zoom:1,r.camera.position.set(zoom*r.theme.get("camera--position","x"),zoom*r.theme.get("camera--position","y"),zoom*r.theme.get("camera--position","z")),r.camera.lookAt(r.scene.position),r.controls.init(),(o=new THREE.AmbientLight(r.theme.get("ambient--color"))).name="ambient",r.scene.add(o);for(var e=1;e<4;e++)i[e]=a("spotlight-"+e,{c:r.theme.get("spotlight-"+e+"--color"),x:r.theme.get("spotlight-"+e+"--position","x"),y:r.theme.get("spotlight-"+e+"--position","y"),z:r.theme.get("spotlight-"+e+"--position","z")}),r.scene.add(i[e]);r.theme.get("plane--color");r.scene.add(Drupal.atomizer.base.makeObject("plane",{lambert:{color:r.theme.get("plane--color"),opacity:r.theme.get("plane--opacity"),transparent:!0}},{width:r.theme.get("plane--width"),depth:r.theme.get("plane--depth")},{x:r.theme.get("plane--position","x"),y:r.theme.get("plane--position","y"),z:r.theme.get("plane--position","z"),rotation:{x:-.5*Math.PI}})),r.producer.createView(),d()};r.context.hover(function(){var e=window.scrollX,t=window.scrollY;this.focus(),window.scrollTo(e,t)},function(){this.blur()}).keyup(function(e){switch(e.keyCode){case 70:s=!s,screenfull.toggle(r.context[0]),s?r.context.addClass("az-fullscreen"):r.context.removeClass("az-fullscreen"),e.preventDefault()}}),r.context.dblclick(function(){s&&(s=!1,r.context.removeClass("az-fullscreen"),screenfull.exit())}),Drupal.behaviors.atomizer_viewer={attach:function(t,a){e(".az-dialog",r.context).each(function(t){e(this).hasClass("az-dialog-processed")||e(this).addClass("az-dialog-processed")})}},r.buttonClicked=function(e){"viewer--fullScreen"===e.id&&((s=!s)?(screenfull.request(r.context[0]),r.context.addClass("az-fullscreen")):(screenfull.exit(),r.context.removeClass("az-fullscreen")))},r.render=d,r.makeScene=l,r.getDisplayMode=function(){return c},r.atomizer=t,r.view=t.views[t.defaultView];r.atomizer.atomizerId.replace(/[ _]/g,"-").toLowerCase();return r.canvasContainer=e(".az-canvas-wrapper",r.context)[0],r.dataAttr=function(e){for(var t={},a=r.canvasContainer;(a=a.parentElement)&&!a.classList.contains("az-embed"););if(a&&a.attributes["data-az"]){var n=a.attributes["data-az"].value.split(" ");for(var o in n)if(n.hasOwnProperty(o)){var i=n[o].split("=");t[i[0]]=i[1]}}return t}(r.canvasContainer),r.dataAttr.theme&&(r.atomizer.views[r.atomizer.defaultView].defaultTheme=r.dataAttr.theme),r.theme=Drupal.atomizer.themeC(r,l),r}}(jQuery);
!function(e){Drupal.atomizer.producers.atom_builderC=function(t){function a(e){var t=e.target.id.split("-",2)[1],a=f.atom.addNuclet(t);f.atom.updateValenceRings(),n(),r(a),f.render()}function n(){E=[],I=[],S=[];var e=f.atom.az().nuclets;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t].az.protons;if(a)for(var n in a)if(a.hasOwnProperty(n)&&a[n]){if(!a[n].az.active)continue;a[n].az.optional&&E.push(a[n]),a[n].az.visible&&I.push(a[n])}var o=e[t].az.neutrons;if(o)for(var n in o)if(o.hasOwnProperty(n)&&o[n]){if(!o[n].az.active)continue;o[n].az.optional&&E.push(o[n]),o[n].az.visible&&I.push(o[n])}var r=e[t].az.nelectrons;if(r)for(var c in r)r.hasOwnProperty(c)&&S.push(r[c].children[1])}D=I.concat();for(var c in S)S.hasOwnProperty(c)&&D.push(S[c])}function o(e,t){var n=t.getElementsByTagName("LABEL")[0],o=t.getElementsByTagName("DIV")[0];if(n.innerHTML=e,f.atom.az().nuclets[e])o.innerHTML=f.atom.az().nuclets[e].az.state;else{o.innerHTML="";var r=document.createElement("input");r.setAttribute("type","button"),r.setAttribute("name","nuclet-add-"+e+"-button"),r.setAttribute("value","Add"),r.classList.add("nuclet-list-button"),r.id="nuclet-"+e,r.addEventListener("click",a),t.getElementsByTagName("DIV")[0].appendChild(r)}}function r(t){var a=t.az.id;c(f.atom.atom),s&&f.nuclet.highlight(s,!1),f.nuclet.highlight(t,"darken"),f.render(),m.insertAfter(h.find(".nuclet-"+a)),"hydrogen"!=t.az.conf.state&&"helium"!=t.az.conf.state&&(e("#nuclet--state--"+t.az.conf.state,f.context)[0].checked=!0,p.value=t.az.conf.attachAngle||1,g.value=t.az.conf.attachAngle||1),"N0"==a?(b.classList.add("az-hidden"),v.classList.add("az-hidden")):(b.classList.remove("az-hidden"),v.classList.remove("az-hidden")),"initial"!=t.az.conf.state&&"final"!=t.az.conf.state?(e(".nuclet--grow-label",f.context).addClass("az-hidden"),e("#edit-nuclet-grow-0",f.context).addClass("az-hidden"),e("#edit-nuclet-grow-1",f.context).addClass("az-hidden")):(e(".nuclet--grow-label",f.context).removeClass("hidden"),e("#edit-nuclet-grow-0",f.context).removeClass("az-hidden"),e("#edit-nuclet-grow-1",f.context).removeClass("az-hidden")),o(a+"0",C),o(a+"1",y),s=t}function c(t){function a(e,n){var o=t.az.nuclets[e],r=0,c=0;for(var l in o.az.protons){var i=o.az.protons[l];i.az&&i.az.visible&&("neutral"==i.az.type?c++:r++)}var s='<div class="nuclet shell-'+n+" "+o.name+'">'+e+" "+o.az.state+" - "+r;c&&(s+=" - "+c),s+="</div>\n";var d=t.az.nuclets[e+"0"],u=t.az.nuclets[e+"1"];return(d||u)&&(d&&(s+=a(e+"0",n+1)),u&&(s+=a(e+"1",n+1))),s}m.length?(m.insertAfter(e(".blocks--nuclet-list"),f.context),h.html(a("N0",0)),(d=h.find(".nuclet")).click(function(e){var t=e.target.innerHTML.split(" ")[0],a=f.atom.getNuclet(t);m.hasClass("az-hidden")||a!==s?(r(a),m.removeClass("az-hidden")):(s&&(f.nuclet.highlight(s,!1),f.render()),m.addClass("az-hidden"))})):h.html(a("N0",0))}function l(e,t){var a=f.atom.changeNucletState(e,t);n(),r(a),f.render()}var i,s,d,u,f=t,h=(e(".blocks--nuclet-list",f.context),e(".nuclet--list",f.context)),m=e(".blocks--nuclet-form",f.context),z=e("#edit-proton-colors--wrapper",f.context);if(m.length)var v=e(".nuclet--attachAngle",f.context)[0],p=e(".nuclet--attachAngle--az-slider",f.context)[0],g=e(".nuclet--attachAngle--az-value",f.context)[0],b=e(".nuclet--delete",f.context)[0],C=e("#edit-nuclet-grow-0",f.context)[0],y=e("#edit-nuclet-grow-1",f.context)[0];var j,x,w,k,A,N=[],P=[],E=[],I=[],L=[],O=null,S=[],D=[],_=0;if(m.length){p.addEventListener("input",function(e){f.atom.changeNucletAngle(s.az.id,e.target.value),f.render()}),b.addEventListener("click",function(e){f.atom.deleteNuclet(s.az.id),delete f.atom.az().nuclets[s.az.id],c(f.atom.atom),n(),f.render(),m.addClass("az-hidden")});var H=e("#edit-nuclet-state .az-control-radios",f.context);H.once("az-processed").each(function(){e(this).attr("id","nuclet--state--"+e(this).val())}),H.click(function(e){"INPUT"==e.target.tagName&&l(s,e.target.value)}),H.siblings("label").click(function(t){var a=e(this).siblings("input")[0];e(a).prop("checked",!0),l(s,a.value)})}var T=e("#blocks--mouse-mode",f.context);if(z.addClass("az-hidden"),T.length){i=T.find("input[name=mouse]:checked").val(),T.find("#edit-mouse--wrapper input").click(function(e){console.log("mode: "+e.target.value),"protonsColor"==(i=e.target.value)?z.removeClass("az-hidden"):z.addClass("az-hidden")}),T.find("#proton-original-color").addClass("selected"),u="original";var U=T.find(".proton-color");U.each(function(){var t=e(this).attr("id").split("-")[1];if("original"!=t){var a=f.theme.getColor("proton-"+t+"--color","lighten");e(this).css("background-color",a.hex)}}),U.click(function(t){U.removeClass("selected"),e(this).addClass("selected");var a=e(this).parent().parent().find("input");a.prop("checked",!0),u=a.val()})}return{createView:function(){f.nuclet=Drupal.atomizer.nucletC(f),f.atom=Drupal.atomizer.atomC(f),f.shapes=Drupal.atomizer.shapesC(f),f.sprites=Drupal.atomizer.spritesC(f),f.animation=Drupal.atomizer.animationC(f);var e=localStorage.getItem("atomizer_builder_atom_nid");f.atom.loadObject(e&&"undefined"!=e?e:249),f.view.ghostProton=f.nuclet.makeProton(0,{type:"ghost"},null,1,{x:300,y:50,z:0})},setDefaults:function(){var t=localStorage.getItem("atomizer_builder_atom_nid");if(t&&"undefined"!=t){var a=e(".atom--selectyml",f.context)[0];a&&(select=a.querySelector("select"),select.value=t)}},mouseUp:function(e,t){function a(){for(var e in L)L.hasOwnProperty(e)&&(L[e].az.selected=!1,f.nuclet.setProtonColor(L[e]));L=[]}function o(){O.az.selected=!1,f.nuclet.setElectronColor(O,!1,!0),O=null}e.preventDefault();var c;switch(e.which){case 1:switch(i){case"electronsAdd":if((x=f.controls.findIntersects(D)).length)if(x[0].object.az){if(!x[0].object.az.active)return;if(O&&o(),!x[0].object.az.active)return;d=(c=x[0].object).az.nuclet.id+"-"+c.az.id,c.az.selected?(c.az.selected=!1,delete L[d]):(c.az.selected=!0,L[d]=c),f.nuclet.setProtonColor(c)}else{a();var l=x[0].object.parent,d=l.az.nuclet.id+"-"+l.az.id;O==l?o():(O&&o(),l.az.selected=!0,O=l,f.nuclet.setElectronColor(l,!0,!0))}else a(),O&&o();f.render();break;case"protonsAdd":if((j=f.controls.findIntersects(E)).length){switch(c=j[0].object,e.which){case 1:if(c.az.optional){if(c.az.visible=!c.az.visible,c.material.visible=c.az.visible,"U"==c.az.id.charAt(0))for(var z=0;z<c.az.tetrahedrons.length;z++)c.az.tetrahedrons[z].material.visible=c.az.visible;f.atom.updateValenceRings(),n(),f.atom.updateParticleCount()}}f.render()}break;case"protonsColor":0!=(j=f.controls.findIntersects(I)).length&&(f.nuclet.setProtonColor(j[0].object,u),f.render());break;case"inner-faces":if((x=f.controls.findIntersects(N)).length){for(var v=x[0].object,p=x[0].face,g=0;g<v.geometry.faces.length;g++)if(v.geometry.faces[g]===p){var b=v.geometry.reactiveState.indexOf(g);b>-1?v.geometry.reactiveState.splice(b,1):v.geometry.reactiveState.push(g);break}f.objects.icosaFaces=null;var C=f.nuclet.createGeometryFaces(v.name,1,v.geometry,v.geometry.shapeConf.rotation||null,v.geometry.reactiveState),y=v.parent;f.objects[v.name]=[],f.objects[v.name].push(C),C.geometry.reactiveState=v.geometry.reactiveState,C.geometry.shapeConf=v.geometry.shapeConf,y.remove(v),y.add(C),f.render()}}break;case 2:var j=f.controls.findIntersects(I);return 0==j.length?(s&&f.nuclet.highlight(s,!1),m.addClass("az-hidden"),s=void 0,f.render(),!1):(r(j[0].object.parent.parent),m.removeClass("az-hidden"),m.insertAfter(h.find("."+s.name)),f.render(),!1);case 3:switch(i){case"electronsAdd":var x=f.controls.findIntersects(D);if(x.length){if(x[0].object.az){var w=(c=x[0].object).az.nuclet,d=c.az.nuclet.id+"-"+c.az.id,k=(Object.keys(L),Object.keys(L).length);if(k>=2&&k<=6){var A=new THREE.Vector3,P=[];for(var S in L)L.hasOwnProperty(S)&&(A.add(L[S].position),P.push(L[S].az.id),L[S].az.id);A.divideScalar(k);var H=f.nuclet.createNElectron("electron1",A);H.az.vertices=P;var T="N"+_++;H.az.id=T,H.az.nuclet=w,w.nelectrons[T]=H,w.protons.P1.az.nucletGroup.add(H),f.nuclet.setElectronColor(H,!1,!0),L=[]}}else(l=x[0].object.parent)==O&&(f.atom.deleteNElectron(O),O=null,n());n(),f.atom.updateParticleCount(),f.render()}}}},hoverObjects:function(){switch(i){case"none":return null;case"electronsAdd":return D;case"protonsAdd":return E;case"protonsColor":return I;case"inner-faces":return f.objects.icosaFaces;case"outer-faces":return P}},hovered:function(e){switch(i){case"none":return;case"electronsAdd":case"protonsColor":case"protonsAdd":if(j){if(e.length&&j==e[0].object)return;f.nuclet.setProtonColor(j,null),j.az.selected?j.material.color=f.theme.getColor("proton-ghost--color"):f.nuclet.setProtonColor(j,null),j.material.visible=j.az.visible,j=null}if(x){if(e.length&&x==e[0].object.parent)return;f.nuclet.setElectronColor(x,!1,!1),x=null}if(e.length)if(e[0].object.az){if(!e[0].object.az.active)return;if("protonsAdd"==i&&!e[0].object.az.optional)return;(j=e[0].object).material.visible=!0,j.material.color=f.theme.getColor("proton-ghost--color")}else x=e[0].object.parent,f.nuclet.setElectronColor(x,!0,!1);f.render();break;case"inner-faces":if(w){if(e.length&&w==e[0])return;w.color.setHex(parseInt("0x00ff00")),k.geometry.colorsNeedUpdate=!0,w=null}e.length&&(w=e[0].face,k=e[0].object,w.color.setHex(parseInt("0x00ffff")),k.geometry.colorsNeedUpdate=!0,k.geometry.elementsNeedUpdate=!0,k.geometry.dynamic=!0,k.geometry.verticesNeedUpdate=!0);break;case"outer-faces":if(A){if(e.length&&A==e[0])return;A.color.setHex(parseInt("0xff00ff")),A=null}e.length&&(A=e[0].face).color.setHex(parseInt("0xffff00")),e[0].object.geometry.colorsNeedUpdate=!0}},objectLoaded:function(e){localStorage.setItem("atomizer_builder_atom_nid",e.az.nid),n(),f.objects.icosaFaces&&(N=f.objects.icosaFaces),f.objects.icosaOutFaces&&(P=f.objects.icosaOutFaces),c(e),f.scene.az={title:e.az.title,name:e.az.name,atomNid:e.az.nid}}}}}(jQuery);
Drupal.atomizer.producers.atom_viewerC=function(e){var t=e;t.controls=Drupal.atomizer.controlsC(t),t.nuclet=Drupal.atomizer.nucletC(t),t.sprites=Drupal.atomizer.spritesC(t),t.shapes=Drupal.atomizer.shapesC(t),t.atom=Drupal.atomizer.atomC(t);return{createView:function(){t.nuclet=Drupal.atomizer.nucletC(t),t.atom=Drupal.atomizer.atomC(t),t.atom.loadObject(t.atomizer.nid,null),t.view.ghostProton=t.nuclet.makeProton(0,{type:"ghost"},null,1,{x:300,y:50,z:0})},setDefaults:function(){var e=localStorage.getItem("atomizer_viewer_atom");if(e&&"undefined"!=e){var o=$("#atom--selectyml",t.context)[0];o&&(select=o.querySelector("select"),select.value=e)}},mouseUp:function(e){switch(e.which){case 1:case 3:e.preventDefault()}},hoverObjects:function(){return[]},hovered:function(e){},objectLoaded:function(e){localStorage.setItem("atomizer_viewer_atom_nid",e.az.nid)}}};
!function(e){Drupal.atomizer.producers.atom_viewerC=function(t){function a(e){var t=e.target.id.split("-",2)[1],a=f.atom.addNuclet(t);f.atom.updateValenceRings(),n(),r(a),f.render()}function n(){N=[],k=[];var e=f.atom.az().nuclets;for(var t in e)if(e.hasOwnProperty(t))for(var a=e[t].az.protons,n=0;n<a.length;n++)a[n]&&(a[n].az.active&&N.push(a[n]),a[n].az.visible&&k.push(a[n]))}function o(e,t){var n=t.getElementsByTagName("LABEL")[0],o=t.getElementsByTagName("DIV")[0];if(n.innerHTML=e,f.atom.az().nuclets[e])o.innerHTML=f.atom.az().nuclets[e].az.state;else{o.innerHTML="";var r=document.createElement("input");r.setAttribute("type","button"),r.setAttribute("name","nuclet-add-"+e+"-button"),r.setAttribute("value","Add"),r.classList.add("nuclet-list-button"),r.id="nuclet-"+e,r.addEventListener("click",a),t.getElementsByTagName("DIV")[0].appendChild(r)}}function r(t){var a=t.az.id;c(f.atom.atom),j.insertAfter(x.find(".nuclet-"+a)),"hydrogen"!=t.az.conf.state&&"helium"!=t.az.conf.state&&(e("#nuclet--state--"+t.az.conf.state).attr("checked",!0),h.value=t.az.conf.attachAngle||1,z.value=t.az.conf.attachAngle||1),"N0"==a?(p.classList.add("az-hidden"),v.classList.add("az-hidden")):(p.classList.remove("az-hidden"),v.classList.remove("az-hidden")),"initial"!=t.az.conf.state&&"final"!=t.az.conf.state?(e("#nuclet--grow-label").addClass("az-hidden"),e("#edit-nuclet-grow-0").addClass("az-hidden"),e("#edit-nuclet-grow-1").addClass("az-hidden")):(e("#nuclet--grow-label").removeClass("hidden"),e("#edit-nuclet-grow-0").removeClass("az-hidden"),e("#edit-nuclet-grow-1").removeClass("az-hidden")),o(a+"0",b),o(a+"1",y),s=t}function c(t){function a(e,n){var o=t.az.nuclets[e],r=0,c=0;for(var s in o.az.protons){var i=o.az.protons[s];i.az&&i.az.visible&&("neutral"==i.az.type?c++:r++)}var l='<div class="nuclet shell-'+n+" "+o.name+'">'+e+" "+o.az.state+" - "+r;c&&(l+=" - "+c),l+="</div>\n";var d=t.az.nuclets[e+"0"],u=t.az.nuclets[e+"1"];return(d||u)&&(d&&(l+=a(e+"0",n+1)),u&&(l+=a(e+"1",n+1))),l}j.insertAfter(e("#blocks--nuclet-list")),x.html(a("N0",0)),(i=x.find(".nuclet")).click(function(e){var t=e.target.innerHTML.split(" ")[0],a=f.atom.getNuclet(t);j.hasClass("az-hidden")||a!==s?(r(a),j.removeClass("az-hidden")):j.addClass("az-hidden")})}var s,i,l,d,u,m,f=t,g="none",v=e("#nuclet--attachAngle",f.context)[0],h=e("#nuclet--attachAngle--az-slider",f.context)[0],z=e("#nuclet--attachAngle--az-value",f.context)[0],p=e("#nuclet--delete",f.context)[0],b=e("#edit-nuclet-grow-0",f.context)[0],y=e("#edit-nuclet-grow-1",f.context)[0],x=e("#nuclet--list"),j=e("#blocks--nuclet-form"),w=(e(".az-controls-form",f.context),[]),C=[],N=[],k=[];h.addEventListener("input",function(e){f.atom.changeNucletAngle(s.az.id,e.target.value),f.render()}),p.addEventListener("click",function(e){f.atom.deleteNuclet(s.az.id),delete f.atom.az().nuclets[s.az.id],c(f.atom.atom),n(),f.render(),j.addClass("az-hidden")});var I=e("#edit-nuclet-state .az-control-radios",f.context);return I.click(function(t){"INPUT"==t.target.tagName&&(s=f.atom.changeNucletState(s,t.target.value),n(),f.render(),r(s)),e(this).attr("id",e(this).attr("id")+"--"+e(this).val())}),(I=e("#blocks--mouse-mode .az-control-radios",f.context)).click(function(t){"INPUT"==t.target.tagName&&(console.log("mode: "+t.target.value),g=t.target.value,e(this).attr("id",e(this).id+"--"+e(this).val()),"checked"==e(this).attr("checked")&&(g=e(this).val()))}),{createView:function(){f.nuclet=Drupal.atomizer.nucletC(f),f.atom=Drupal.atomizer.atomC(f);var e=localStorage.getItem("atomizer_viewer_atom_nid");f.view.atom=f.atom.loadObject(e&&"undefined"!=e?e:249),f.view.ghostProton=f.nuclet.makeProton(0,{type:"ghost"},null,1,{x:300,y:50,z:0},{state:"default"})},setDefaults:function(){var t=localStorage.getItem("atomizer_viewer_atom_nid");if(t&&"undefined"!=t){var a=e("#atom--selectyml",f.context)[0];a&&(select=a.querySelector("select"),select.value=t)}},mouseUp:function(e){switch(e.which){case 1:case 3:switch(e.preventDefault(),g){case"none":break;case"protons":if((a=f.controls.findIntersects(N)).length){var t=a[0].object;t.az.optional&&(t.az.visible=!t.az.visible,t.material.visible=t.az.visible,f.atom.updateValenceRings(),n(),f.render()),f.atom.updateParticleCount()}break;case"nuclets":var a=f.controls.findIntersects(k);return 0==a.length?(j.addClass("az-hidden"),s=void 0,!1):(s=a[0].object.parent.parent,j.removeClass("az-hidden"),j.insertAfter(x.find("."+s.name)),r(s),!1);case"inner-faces":var o=f.controls.findIntersects(w);if(o.length){for(var c=o[0].object,i=o[0].face,l=0;l<c.geometry.faces.length;l++)if(c.geometry.faces[l]===i){var d=c.geometry.reactiveState.indexOf(l);d>-1?c.geometry.reactiveState.splice(d,1):c.geometry.reactiveState.push(l);break}f.objects.icosaFaces=null;var u=f.nuclet.createGeometryFaces(c.name,1,c.geometry,c.geometry.shapeConf.rotation||null,c.geometry.reactiveState),m=c.parent;f.objects[c.name]=[],f.objects[c.name].push(u),u.geometry.reactiveState=c.geometry.reactiveState,u.geometry.shapeConf=c.geometry.shapeConf,m.remove(c),m.add(u),f.render()}}}},hoverObjects:function(){switch(g){case"none":return null;case"protons":return N;case"nuclets":return k;case"inner-faces":return f.objects.icosaFaces;case"outer-faces":return C}},hovered:function(e){switch(g){case"none":return[];case"protons":if(f.theme.get("proton--opacity"),l){if(e.length&&l==e[0])return;var t=l.object,a=f.theme.get("proton-"+t.az.type+"--color");t.material.color.setHex(parseInt(a.replace(/#/,"0x")),16),t.material.visible=t.az.visible}if(e.length){if(!e[0].object.az.optional||!e[0].object.az.active)return;(l=e[0]).object.material.visible=!0,a=f.theme.get("proton-ghost--color"),l.object.material.color.setHex(parseInt(a.replace(/#/,"0x")),16)}break;case"nuclets":break;case"inner-faces":if(f.theme.get("icosaFaces--opacity"),d){if(e.length&&d==e[0])return;d.color.setHex(parseInt("0x00ff00")),u.geometry.colorsNeedUpdate=!0,d=null}e.length&&(d=e[0].face,u=e[0].object,d.color.setHex(parseInt("0x00ffff")),u.geometry.colorsNeedUpdate=!0,u.geometry.elementsNeedUpdate=!0,u.geometry.dynamic=!0,u.geometry.verticesNeedUpdate=!0);break;case"outer-faces":if(f.theme.get(" icosaOutFaces--opacity"),m){if(e.length&&m==e[0])return;m.color.setHex(parseInt("0xff00ff")),m=null}e.length&&(m=e[0].face).color.setHex(parseInt("0xffff00")),e[0].object.geometry.colorsNeedUpdate=!0}},objectLoaded:function(e){localStorage.setItem("atomizer_viewer_atom_nid",e.az.nid),n(),f.objects.icosaFaces&&(w=f.objects.icosaFaces),f.objects.icosaOutFaces&&(C=f.objects.icosaOutFaces),c(e)}}}}(jQuery);
Drupal.atomizer.producers.backbone_builderC=function(e){function t(e,t,o){for(var r in s){var a=e[t[s[r]]];o?(a.currentHex=a.material.color.getHex(),a.material.color.setHex(o)):a.material.color.setHex(a.currentHex)}}var o,r,a,n=!1,i=e,s=["a","b","c"],c=[],d=i.theme.get("proton--radius"),p=0,l=0,h=new THREE.Group;h.name="atom",h.az={protons:{},tetrahedrons:{}};var m=function(e){var t=new THREE.Group;t.name="tetrahedron",t.protons=[],t.protonRadius=d;var o=new THREE.TetrahedronGeometry(1.222*i.nuclet.protonRadius);return o.dynamic=!0,t.add(i.nuclet.createGeometryWireframe(e+"Wireframe",1,o,null,null)),t.add(i.nuclet.createGeometryFaces(e+"Faces",1,o,null,null)),t},v=function(e){var t={name:e.name,protonRadius:d,protons:{},components:{}};for(var o in h.az.protons){var r=h.az.protons[o];t.protons[o]={position:r.position,attachments:[]}}for(var a in h.az.tetrahedrons){for(var n=h.az.tetrahedrons[a],i=[],s=0;s<n.protons.length;s++){o=n.protons[s].azid;i[s]=o,t.protons[o].attachments.push(a)}t.geometries[a]={geometry:"tetrahedron",protons:i}}Drupal.atomizer.base.doAjax("/ajax-ab/saveYml",{name:e.name,source:"backbone_builder",component:"theme",filepath:e.filepath,ymlContents:t},g)},g=function(e){},u=function(e){w(e)},f=function(e,t){Drupal.atomizer.base.doAjax("/ajax-ab/loadYml",{component:"backbone",settings:{fart:"cool"},filepath:e},w)},w=function(e){p=0,l=0,h&&i.scene.remove(h),(a=e[0].ymlContents).filepath=e[0].data.filepath,localStorage.setItem("atomizer_builder_backbone",e[0].data.filepath.replace(/^.*[\\\/]/,"")),(h=new THREE.Group).add(new THREE.AxisHelper(500)),h.name="atom",h.az={protons:[],tetrahedrons:[]};for(var t=0;t<2;t++)(n||1!=t)&&function(e){var t=new THREE.Geometry;for(var o in a.protons){var r=a.protons[o],s=new THREE.Vector3(r.position.x,r.position.y,r.position.z);t.vertices.push(s)}n&&(t.applyMatrix((new THREE.Matrix4).makeRotationY(Math.PI/4)),t.applyMatrix((new THREE.Matrix4).makeTranslation(-t.vertices[8].x,-t.vertices[8].y,0)),t.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI)),t.applyMatrix((new THREE.Matrix4).makeRotationZ(-Math.PI/2.125)),t.verticesNeedUpdate=!0,i.render(),1==e&&(t.applyMatrix((new THREE.Matrix4).makeRotationZ(Math.PI)),t.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI))),t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-t.vertices[6].y,0)));var d=0;for(var o in a.protons){var r=a.protons[o],v=t.vertices[d];(f=i.nuclet.makeProton(0,"default",i.theme.get("proton--opacity"),{x:v.x,y:v.y,z:v.z})).azid="p"+l++,h.az.protons[f.azid]=f,h.add(f),d++}var g=i.sprites.createVerticeIds("proton",t);h.add(g);for(var u in a.components){var y=a.components[u];if("tetrahedron"==y.geometry){var z=m("tetra");z.azid="t"+p++,c.push(z.children[1]),h.az.tetrahedrons[z.azid]=z,z.children[1].geometry.protons=[];for(var x=0;x<4;x++){1==e?"p09"==(o="p"+(parseInt(y.protons[x].replace("p",""))+10).toString())&&(o="p9"):o=y.protons[x];var f=a.protons[o];z.children[0].geometry.vertices[x].x=h.az.protons[o].position.x,z.children[0].geometry.vertices[x].y=h.az.protons[o].position.y,z.children[0].geometry.vertices[x].z=h.az.protons[o].position.z,z.children[1].geometry.vertices[x].x=h.az.protons[o].position.x,z.children[1].geometry.vertices[x].y=h.az.protons[o].position.y,z.children[1].geometry.vertices[x].z=h.az.protons[o].position.z,z.protons[x]=h.az.protons[o]}h.add(z)}}}(t);if(n){var o;x=0,y=-80.25,z=50,(o=i.nuclet.makeProton(0,"default",i.theme.get("proton--opacity"),{x:x,y:y,z:z})).azid="p18",h.az.protons.p18=o,h.add(o),(o=i.nuclet.makeProton(0,"default",i.theme.get("proton--opacity"),{x:x,y:y,z:-z})).azid="p19",h.az.protons.p19=o,h.add(o)}i.scene.add(h),i.render()};return{setDefaults:function(){},createView:function(){i.nuclet=Drupal.atomizer.nucletC(i),i.atom=Drupal.atomizer.atomC(i),i.backbone={getYmlDirectory:function(){return"config/backbone"},saveYml:v,loadYml:u},i.view.ghostProton=i.nuclet.makeProton(0,"ghost",i.theme.get("proton--opacity"),{x:300,y:50,z:0});var e=m("ghost");e.protons=[],i.view.ghostTetrahedron=e,f(n?"config/backbone/half_backbone.yml":"config/backbone/back.yml")},intersectObjects:function(){return c},intersected:function(e){if(0==e.length)o&&(t(r.protons,o),o=null,r.children[0].remove(i.view.ghostProton),r.children[0].remove(i.view.ghostTetrahedron),i.render());else if(o!=e[0].face){o&&(t(r.protons,o),r.children[0].remove(i.view.ghostProton),r.children[0].remove(i.view.ghostTetrahedron)),o=e[0].face,e[0].faceIndex,r=e[0].object.parent,o.centroid=new THREE.Vector3(0,0,0);for(var a in s){var n=o[s[a]],c=r.protons[n];o.centroid.add(c.position),i.view.ghostTetrahedron.children[0].geometry.vertices[a].copy(c.position),i.view.ghostTetrahedron.protons[a]=c}o.centroid.divideScalar(3);var d=o.normal,p={x:1.615*d.x*r.protonRadius,y:1.615*d.y*r.protonRadius,z:1.615*d.z*r.protonRadius},l={x:o.centroid.x+p.x,y:o.centroid.y+p.y,z:o.centroid.z+p.z};i.view.ghostProton.position.copy(l),r.children[0].add(i.view.ghostProton),i.view.ghostTetrahedron.children[0].geometry.vertices[3].copy(l),i.view.ghostTetrahedron.children[0].geometry.verticesNeedUpdate=!0,i.view.ghostTetrahedron.children[0].geometry.normalsNeedUpdate=!0,i.view.ghostTetrahedron.children[0].geometry.elementsNeedUpdate=!0,i.view.ghostTetrahedron.children[0].geometry.uvsNeedUpdate=!0,i.view.ghostTetrahedron.children[0].geometry.tangentsNeedUpdate=!0,i.view.ghostTetrahedron.children[0].geometry.computeFaceNormals(),i.view.ghostTetrahedron.children[0].geometry.computeVertexNormals(),i.view.ghostTetrahedron.children[1].geometry.vertices[3].copy(l),i.view.ghostTetrahedron.children[1].geometry.verticesNeedUpdate=!0,i.view.ghostTetrahedron.children[1].geometry.normalsNeedUpdate=!0,i.view.ghostTetrahedron.children[1].geometry.elementsNeedUpdate=!0,i.view.ghostTetrahedron.children[1].geometry.uvsNeedUpdate=!0,i.view.ghostTetrahedron.children[1].geometry.tangentsNeedUpdate=!0,i.view.ghostTetrahedron.children[1].geometry.computeFaceNormals(),i.view.ghostTetrahedron.children[1].geometry.computeVertexNormals(),r.children[0].add(i.view.ghostTetrahedron),color=i.theme.get("proton-vattach--color"),t(r.protons,o,color.replace("#","0x")),i.render()}},mouseUp:function(e){if(o){t(r.protons,o);var a=i.view.ghostProton;a.material.color.setHex(parseInt(i.theme.get("proton-default--color").replace(/#/,"0x")),16);var n=i.view.ghostTetrahedron;n.children[0].material.color.setHex(parseInt(i.theme.get("tetraWireframe--color").replace(/#/,"0x")),16),n.children[0].name="tetraWireframe",n.children[1].material.color.setHex(parseInt(i.theme.get("tetraFaces--color").replace(/#/,"0x")),16),n.children[1].name="tetraFaces",c.push(n.children[1]),a.azid="p"+Object.keys(h.az.protons).length,h.az.protons[a.azid]=a,n.protons[3]=a,n.azid="t"+Object.keys(h.az.tetrahedrons).length,h.az.tetrahedrons[n.azid]=n,o=null,r=null,i.view.ghostProton=i.nuclet.makeProton(0,null,"ghost",i.theme.get("proton--opacity"),{x:300,y:50,z:0}),i.view.ghostTetrahedron=m("ghost"),i.render()}}}};
!function(e){Drupal.atomizer.producers.birkelandC=function(t){function n(){}var a,i=t,r=e("#blocks--mouse-mode",i.context);return r.length&&(a=r.find("input[name=mouse]:checked").val(),r.find("#edit-mouse--wrapper input").click(function(e){console.log("mode: "+e.target.value),a=e.target.value})),{createView:function(){i.birkeland=Drupal.atomizer.birkelandC(i),i.animation=Drupal.atomizer.animationC(i);var t=localStorage.getItem("atomizer_birkeland_nid");t=t&&"undefined"!=t?t:627,i.birkeland.loadObject(t);var n=e("#edit-scene-select .az-control-radios",i.context);n.once("az-processed").each(function(){var n="scene--select--"+e(this).val();e(this).attr("id",n),e(this).val()==t&&e(this).prop("checked",!0)}),n.click(function(e){"INPUT"==e.target.tagName&&i.birkeland.loadObject(e.target.value)}),n.siblings("label").click(function(t){var n=e(this).siblings("input")[0];e(n).prop("checked",!0),i.birkeland.loadObject(t.target.value)})},setDefaults:function(){},mouseUp:function(e,t){switch(e.preventDefault(),e.which){case 1:switch(a){case"electronsAdd_breakit":i.controls.findIntersects(visibleParticles).length,i.render()}break;case 2:return i.controls.findIntersects(visibleProtons).length,i.render(),!1}},hoverObjects:function(){switch(a){case"none":case"electronsAdd":return null;case"protonsAdd":return optionalProtons}},hovered:function(e){switch(a){case"none":return;case"electronsAdd":case"protonsAdd":i.render()}},objectLoaded:function(e){localStorage.setItem("atomizer_birkeland_nid",e.az.nid),n(),i.scene.az={title:e.az.title,name:e.az.name,objectNid:e.az.nid}}}}}(jQuery);
Drupal.atomizer.producers.ico_dodecaC=function(t){var e=t;e.controls=Drupal.atomizer.controlsC(e),e.nuclet=Drupal.atomizer.nucletC(e),e.atom=Drupal.atomizer.atomC(e);return{createView:function(){e.theme.set("rings","proton--color-style","radios");var t=e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11],state:"icosahedron"});t.position.set(350,100,-150),(t=e.atom.createObject({state:"dodecahedron"})).position.set(350,100,-150),t.scale.set(.59,.59,.59),e.theme.set("pairs","proton--color-style","radios");var o=e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11],state:"icosahedron"});o.position.set(0,100,100),(o=e.atom.createObject({state:"dodecahedron"})).position.set(0,100,100),o.scale.set(.59,.59,.59),e.theme.set("alpha3","proton--color-style","radios");var a=e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11],state:"icosahedron"});a.position.set(-350,100,-150),(a=e.atom.createObject({state:"dodecahedron"})).position.set(-350,100,-150),a.scale.set(.59,.59,.59)},setDefaults:function(){},mouseUp:function(){e.render()},hovered:function(){}}};
Drupal.atomizer.producers.molecule_builderC=function(e){var r=e;return{createView:function(){r.object.addAtoms()}}};
!function(e){Drupal.atomizer.producers.atom_builderC=function(t){function a(e){var t=e.target.id.split("-",2)[1],a=u.atom.addNuclet(t);u.atom.updateValenceRings(),o(),c(a),u.render()}function n(e,t,a){var n,o=e.az.nuclet;if(e.az.selected||t){if(e.children[0].material.color=u.theme.getColor(e.name+"-core--color-highlight"),e.children[1].material.color=u.theme.getColor(e.name+"-field--color-highlight"),a)for(var r in e.az.vertices)e.az.vertices.hasOwnProperty(r)&&((n=o.protons[e.az.vertices[r]]).az.selected=!0,u.nuclet.setProtonColor(n,null))}else if(e.children[0].material.color=u.theme.getColor(e.name+"-core--color"),e.children[1].material.color=u.theme.getColor(e.name+"-field--color"),a)for(var r in e.az.vertices)e.az.vertices.hasOwnProperty(r)&&((n=o.protons[e.az.vertices[r]]).az.selected=!1,u.nuclet.setProtonColor(n,null))}function o(){I=[],L=[],E=[];var e=u.atom.az().nuclets;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t].az.protons;if(a)for(var n in a)a.hasOwnProperty(n)&&a[n]&&(a[n].az.active&&I.push(a[n]),a[n].az.visible&&L.push(a[n]));var o=e[t].az.nelectrons;if(o)for(var r in o)o.hasOwnProperty(r)&&E.push(o[r].children[1])}_=L.concat();for(var r in E)E.hasOwnProperty(r)&&_.push(E[r])}function r(e,t){var n=t.getElementsByTagName("LABEL")[0],o=t.getElementsByTagName("DIV")[0];if(n.innerHTML=e,u.atom.az().nuclets[e])o.innerHTML=u.atom.az().nuclets[e].az.state;else{o.innerHTML="";var r=document.createElement("input");r.setAttribute("type","button"),r.setAttribute("name","nuclet-add-"+e+"-button"),r.setAttribute("value","Add"),r.classList.add("nuclet-list-button"),r.id="nuclet-"+e,r.addEventListener("click",a),t.getElementsByTagName("DIV")[0].appendChild(r)}}function c(t){var a=t.az.id;l(u.atom.atom),s&&u.nuclet.highlight(s,!1),u.nuclet.highlight(t,"darken"),u.render(),m.insertAfter(h.find(".nuclet-"+a)),"hydrogen"!=t.az.conf.state&&"helium"!=t.az.conf.state&&(e("#nuclet--state--"+t.az.conf.state,u.context)[0].checked=!0,z.value=t.az.conf.attachAngle||1,p.value=t.az.conf.attachAngle||1),"N0"==a?(b.classList.add("az-hidden"),v.classList.add("az-hidden")):(b.classList.remove("az-hidden"),v.classList.remove("az-hidden")),"initial"!=t.az.conf.state&&"final"!=t.az.conf.state?(e(".nuclet--grow-label",u.context).addClass("az-hidden"),e(".edit-nuclet-grow-0",u.context).addClass("az-hidden"),e(".edit-nuclet-grow-1",u.context).addClass("az-hidden")):(e(".nuclet--grow-label",u.context).removeClass("hidden"),e(".edit-nuclet-grow-0",u.context).removeClass("az-hidden"),e(".edit-nuclet-grow-1",u.context).removeClass("az-hidden")),r(a+"0",C),r(a+"1",y),s=t}function l(t){function a(e,n){var o=t.az.nuclets[e],r=0,c=0;for(var l in o.az.protons){var s=o.az.protons[l];s.az&&s.az.visible&&("neutral"==s.az.type?c++:r++)}var i='<div class="nuclet shell-'+n+" "+o.name+'">'+e+" "+o.az.state+" - "+r;c&&(i+=" - "+c),i+="</div>\n";var d=t.az.nuclets[e+"0"],u=t.az.nuclets[e+"1"];return(d||u)&&(d&&(i+=a(e+"0",n+1)),u&&(i+=a(e+"1",n+1))),i}m.length?(m.insertAfter(e(".blocks--nuclet-list"),u.context),h.html(a("N0",0)),(i=h.find(".nuclet")).click(function(e){var t=e.target.innerHTML.split(" ")[0],a=u.atom.getNuclet(t);m.hasClass("az-hidden")||a!==s?(c(a),m.removeClass("az-hidden")):(s&&(u.nuclet.highlight(s,!1),u.render()),m.addClass("az-hidden"))})):h.html(a("N0",0))}var s,i,d,u=t,f="electronsAdd",h=(e(".blocks--nuclet-list",u.context),e(".nuclet--list",u.context)),m=e(".blocks--nuclet-form",u.context),g=e("#edit-proton-colors--wrapper",u.context);if(m.length)var v=e(".nuclet--attachAngle",u.context)[0],z=e(".nuclet--attachAngle--az-slider",u.context)[0],p=e(".nuclet--attachAngle--az-value",u.context)[0],b=e(".nuclet--delete",u.context)[0],C=e("#edit-nuclet-grow-0",u.context)[0],y=e("#edit-nuclet-grow-1",u.context)[0];var j,x,w,k,A,N=[],P=[],I=[],L=[],O=[],S=null,E=[],_=[],H=0;if(m.length){z.addEventListener("input",function(e){u.atom.changeNucletAngle(s.az.id,e.target.value),u.render()}),b.addEventListener("click",function(e){u.atom.deleteNuclet(s.az.id),delete u.atom.az().nuclets[s.az.id],l(u.atom.atom),o(),u.render(),m.addClass("az-hidden")});var T=e("#edit-nuclet-state .az-control-radios",u.context);T.once("az-processed").each(function(){e(this).attr("id","nuclet--state--"+e(this).val())}),T.click(function(e){if("INPUT"==e.target.tagName){var t=u.atom.changeNucletState(s,e.target.value);o(),c(t),u.render()}})}var D=e("#blocks--mouse-mode",u.context);if(g.addClass("az-hidden"),D.length){D.find("#edit-mouse--wrapper input").click(function(e){console.log("mode: "+e.target.value),"protonsColor"==(f=e.target.value)?g.removeClass("az-hidden"):g.addClass("az-hidden")}),D.find("#proton-original-color").addClass("selected"),d="original";var F=D.find(".proton-color");F.each(function(){var t=e(this).attr("id").split("-")[1];if("original"!=t){var a=u.theme.getColor("proton-"+t+"--color","lighten");e(this).css("background-color",a.hex)}}),F.click(function(t){F.removeClass("selected"),e(this).addClass("selected");var a=e(this).parent().parent().find("input");a.prop("checked",!0),d=a.val()})}return{createView:function(){u.nuclet=Drupal.atomizer.nucletC(u),u.atom=Drupal.atomizer.atomC(u);var e=localStorage.getItem("atomizer_builder_atom_nid");u.atom.loadObject(e&&"undefined"!=e?e:249),u.view.ghostProton=u.nuclet.makeProton(0,{type:"ghost"},null,1,{x:300,y:50,z:0})},setDefaults:function(){var t=localStorage.getItem("atomizer_builder_atom_nid");if(t&&"undefined"!=t){var a=e(".atom--selectyml",u.context)[0];a&&(select=a.querySelector("select"),select.value=t)}},mouseUp:function(e){function t(){for(var e in O)O.hasOwnProperty(e)&&(O[e].az.selected=!1,u.nuclet.setProtonColor(O[e]));O=[]}function a(){S.az.selected=!1,n(S,!1,!0),S=null}e.preventDefault();var r;switch(e.which){case 1:switch(f){case"electronsAdd":if((j=u.controls.findIntersects(_)).length)if(j[0].object.az){if(S&&a(),!j[0].object.az.active)return;i=(r=j[0].object).az.nuclet.id+"-"+r.az.id,r.az.selected?(r.az.selected=!1,delete O[i]):(r.az.selected=!0,O[i]=r),u.nuclet.setProtonColor(r)}else{t();var l=j[0].object.parent,i=l.az.nuclet.id+"-"+l.az.id;S==l?a():(S&&a(),l.az.selected=!0,S=l,n(l,!0,!0))}else t(),S&&a();u.render();break;case"protonsAdd":if((y=u.controls.findIntersects(I)).length){switch(r=y[0].object,e.which){case 1:r.az.optional&&(r.az.visible=!r.az.visible,r.material.visible=r.az.visible,u.atom.updateValenceRings(),o()),u.atom.updateParticleCount()}u.render()}break;case"protonsColor":0!=(y=u.controls.findIntersects(L)).length&&(u.nuclet.setProtonColor(y[0].object,d),u.render());break;case"inner-faces":if((j=u.controls.findIntersects(N)).length){for(var g=j[0].object,v=j[0].face,z=0;z<g.geometry.faces.length;z++)if(g.geometry.faces[z]===v){var p=g.geometry.reactiveState.indexOf(z);p>-1?g.geometry.reactiveState.splice(p,1):g.geometry.reactiveState.push(z);break}u.objects.icosaFaces=null;var b=u.nuclet.createGeometryFaces(g.name,1,g.geometry,g.geometry.shapeConf.rotation||null,g.geometry.reactiveState),C=g.parent;u.objects[g.name]=[],u.objects[g.name].push(b),b.geometry.reactiveState=g.geometry.reactiveState,b.geometry.shapeConf=g.geometry.shapeConf,C.remove(g),C.add(b),u.render()}}break;case 2:var y=u.controls.findIntersects(L);return 0==y.length?(s&&u.nuclet.highlight(s,!1),m.addClass("az-hidden"),s=void 0,u.render(),!1):(c(y[0].object.parent.parent),m.removeClass("az-hidden"),m.insertAfter(h.find("."+s.name)),u.render(),!1);case 3:switch(f){case"electronsAdd":var j=u.controls.findIntersects(_);if(j.length){if(j[0].object.az){var x=(r=j[0].object).az.nuclet,i=r.az.nuclet.id+"-"+r.az.id,w=Object.keys(O).length;if(w>=2&&w<=6){var k=new THREE.Vector3,A=[];for(var P in O)O.hasOwnProperty(P)&&(k.add(O[P].position),A.push(O[P].az.id),O[P].az.id);k.divideScalar(w);var E=u.nuclet.createNElectron("electron1",k);E.az.vertices=A;var T="N"+H++;E.az.id=T,E.az.nuclet=x,x.nelectrons[T]=E,x.protons[1].az.nucletGroup.add(E),n(E,!1,!0),O=[]}}else(l=j[0].object.parent)==S&&(S.az.selected=!1,n(S,!1,!0),S.parent.remove(S),delete S.az.nuclet.nelectrons[S.az.id],S=null,o());o(),u.render()}}}},hoverObjects:function(){switch(f){case"none":return null;case"electronsAdd":return _;case"protonsAdd":return I;case"protonsColor":return L;case"inner-faces":return u.objects.icosaFaces;case"outer-faces":return P}},hovered:function(e){switch(f){case"none":return;case"electronsAdd":case"protonsColor":case"protonsAdd":if(j){if(e.length&&j==e[0].object)return;u.nuclet.setProtonColor(j,null),j.az.selected?j.material.color=u.theme.getColor("proton-ghost--color"):u.nuclet.setProtonColor(j,null),j.material.visible=j.az.visible,j=null}if(x){if(e.length&&x==e[0].object.parent)return;n(x,!1,!1),x=null}if(e.length)if(e[0].object.az){if(!e[0].object.az.active)return;if("protonsAdd"==f&&!e[0].object.az.optional)return;(j=e[0].object).material.visible=!0,j.material.color=u.theme.getColor("proton-ghost--color")}else n(x=e[0].object.parent,!0,!1);u.render();break;case"inner-faces":if(w){if(e.length&&w==e[0])return;w.color.setHex(parseInt("0x00ff00")),k.geometry.colorsNeedUpdate=!0,w=null}e.length&&(w=e[0].face,k=e[0].object,w.color.setHex(parseInt("0x00ffff")),k.geometry.colorsNeedUpdate=!0,k.geometry.elementsNeedUpdate=!0,k.geometry.dynamic=!0,k.geometry.verticesNeedUpdate=!0);break;case"outer-faces":if(A){if(e.length&&A==e[0])return;A.color.setHex(parseInt("0xff00ff")),A=null}e.length&&(A=e[0].face).color.setHex(parseInt("0xffff00")),e[0].object.geometry.colorsNeedUpdate=!0}},objectLoaded:function(e){localStorage.setItem("atomizer_builder_atom_nid",e.az.nid),o(),u.objects.icosaFaces&&(N=u.objects.icosaFaces),u.objects.icosaOutFaces&&(P=u.objects.icosaOutFaces),l(e)}}}}(jQuery);
Drupal.atomizer.producers.platonic_dualsC=function(t){var e=t;e.controls=Drupal.atomizer.controlsC(e),e.nuclet=Drupal.atomizer.nucletC(e),e.sprites=Drupal.atomizer.spritesC(e),e.shapes=Drupal.atomizer.shapesC(e),e.atom=Drupal.atomizer.atomC(e);return{createView:function(){var t,o=.5*Math.PI;(t=e.atom.createObject({state:"tetrahedron"})).position.set(400,0,150);a=2.7;t.scale.set(a,a,a),(t=e.atom.createObject({state:"tetrahedron"})).position.set(400,0,150),t.rotation.init_y=o,t.rotation.x=o,(t=e.atom.createObject({state:"tetrahedron"})).position.set(400,0,150);a=.45;t.scale.set(a,a,a),(t=e.atom.createObject({state:"octahedron"})).position.set(-400,0,150);a=.7;t.scale.set(a,a,a),(t=e.atom.createObject({state:"hexahedron"})).position.set(-400,0,150),(t=e.atom.createObject({state:"octahedron"})).position.set(-400,0,150);a=2;t.scale.set(a,a,a),(t=e.atom.createObject({state:"icosahedron"})).position.set(0,0,-150);a=1.15;t.scale.set(a,a,a),t.rotation.init_y=o,t.rotation.x=o,(t=e.atom.createObject({state:"dodecahedron"})).position.set(0,0,-150),(t=e.atom.createObject({state:"icosahedron"})).position.set(0,0,-150);var a=1.7;t.scale.set(a,a,a),t.rotation.init_y=o,t.rotation.x=o},setDefaults:function(){},mouseUp:function(){e.render()},hovered:function(){}}};
Drupal.atomizer.producers.platonic_solidsC=function(t){var e=t;e.controls=Drupal.atomizer.controlsC(e),e.nuclet=Drupal.atomizer.nucletC(e),e.sprites=Drupal.atomizer.spritesC(e),e.shapes=Drupal.atomizer.shapesC(e),e.atom=Drupal.atomizer.atomC(e);return{createView:function(){e.atom.createObject({protons:[0,1,2,3],state:"tetrahedron"}).position.set(400,0,-200),e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11],state:"hexahedron"}).position.set(0,0,-200),e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11],state:"octahedron"}).position.set(-400,0,-200),e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11],state:"icosahedron"}).position.set(275,0,200),e.atom.createObject({protons:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],state:"dodecahedron"}).position.set(-275,0,200)},setDefaults:function(){},mouseUp:function(){e.render()},hovered:function(){}}};
Drupal.atomizer.producers.workbenchC=function(e){var t=e,n=function(e,n){switch(e){case"tetralet":r={position:1,type:"tetralet",numProtons:4,protons:[{present:!0},{present:!0},{present:!0},{present:!0}]};break;case"decalet":r={position:1,type:"decalet",numProtons:7,protons:[{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0}]};break;case"icosalet":r={position:1,type:"icosalet",numProtons:12,protons:[{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0}]};break;case"octolet":var r={position:1,type:"octolet",numProtons:6,protons:[{present:!0},{present:!0},{present:!0},{present:!0},{present:!0},{present:!0}]}}return r.position={x:n.x,y:n.y,z:n.z},nuclet=t.nuclet.createNuclet(r)};return{createView:function(){t.nuclet=Drupal.atomizer.nucletC(t),t.atom=Drupal.atomizer.atomC(t);t.nuclet;var e=n("octolet",{x:0,y:92,z:-200});Drupal.atomizer.octolet=e,t.scene.add(e)},setDefaults:function(){},intersectObjects:function(){return[]},intersected:function(){},mouseUp:function(){}}};