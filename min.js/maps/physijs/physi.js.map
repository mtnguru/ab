{"version":3,"sources":["physijs/physi.js"],"names":["window","Physijs","SUPPORT_TRANSFERABLE","Eventable","getObjectId","convertWorldPositionToObject","addObjectChildren","_temp1","_temp2","_is_simulating","_Physijs","_temp_vector3_1","THREE","Vector3","_temp_vector3_2","_temp_matrix4_1","Matrix4","_quaternion_1","Quaternion","MESSAGE_TYPES","WORLDREPORT","COLLISIONREPORT","VEHICLEREPORT","CONSTRAINTREPORT","scripts","this","_eventListeners","prototype","addEventListener","event_name","callback","hasOwnProperty","push","removeEventListener","index","indexOf","splice","dispatchEvent","i","parameters","Array","call","arguments","length","apply","make","obj","_id","x","y","z","w","Math","atan2","asin","c1","s1","c2","s2","c3","s3","c1c2","s1s2","cos","sin","position","object","identity","makeRotationFromQuaternion","quaternion","getInverse","copy","sub","applyMatrix4","noConflict","createMaterial","material","friction","restitution","physijs_material","_physijs","id","undefined","PointConstraint","objecta","objectb","type","appliedImpulse","positiona","clone","positionb","getDefinition","HingeConstraint","axis","scene","parent","setLimits","low","high","bias_factor","relaxation_factor","execute","constraint","enableAngularMotor","velocity","acceleration","disableMotor","SliderConstraint","lin_lower","lin_upper","ang_lower","ang_upper","setRestitution","linear","angular","enableLinearMotor","disableLinearMotor","disableAngularMotor","ConeTwistConstraint","axisa","rotation","axisb","setLimit","enableMotor","setMaxMotorImpulse","max_impulse","setMotorTarget","target","setFromEuler","Euler","setFromRotationMatrix","DOFConstraint","setLinearLowerLimit","limit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","which","configureAngularMotor","low_angle","high_angle","max_force","Scene","params","self","_worker","Worker","worker","transferableMessage","webkitPostMessage","postMessage","_materials_ref_counts","_objects","_vehicles","_constraints","ab","ArrayBuffer","byteLength","onmessage","event","_temp","data","Float32Array","_updateScene","_updateCollisions","_updateVehicles","_updateConstraints","cmd","test","console","debug","dir","ammo","fixedTimeStep","rateLimit","constructor","offset","num_objects","__dirtyPosition","set","__dirtyRotation","linearVelocity","angularVelocity","buffer","vehicle","wheel","wheels","extractRotation","matrix","addVectors","j","object2","id1","id2","collisions","normal_offsets","touches","subVectors","getLinearVelocity","getAngularVelocity","normal_offset","addConstraint","show_marker","marker","Mesh","SphereGeometry","MeshNormalMaterial","add","BoxGeometry","onSimulationResume","removeConstraint","children","updateMatrix","updateMatrixWorld","setFromMatrixPosition","matrixWorld","position_offset","world","Vehicle","mesh","materialId","width","scale","height","depth","remove","pop","setFixedTimeStep","setGravity","gravity","simulate","timeStep","maxSubSteps","object_id","update","pos","quat","geometry","mass","boundingBox","computeBoundingBox","__defineGetter__","__defineSetter__","applyCentralImpulse","force","applyImpulse","impulse_x","impulse_y","impulse_z","applyTorque","torque_x","torque_y","torque_z","applyCentralForce","applyForce","force_x","force_y","force_z","setAngularVelocity","setLinearVelocity","setAngularFactor","factor","setLinearFactor","setDamping","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","PlaneMesh","max","min","normal","faces","HeightfieldMesh","xdiv","ydiv","xsize","ysize","xpts","sqrt","vertices","ypts","absMaxHeight","abs","a","b","points","round","BoxMesh","SphereMesh","boundingSphere","computeBoundingSphere","PI","pow","CylinderMesh","CapsuleMesh","ConeMesh","ConcaveMesh","face","triangles","Face3","c","Face4","d","ConvexMesh","tuning","VehicleTuning","rigidBody","suspension_stiffness","suspension_compression","suspension_damping","max_suspension_travel","friction_slip","max_suspension_force","addWheel","wheel_geometry","wheel_material","connection_point","wheel_direction","wheel_axle","suspension_rest_length","wheel_radius","is_front_wheel","castShadow","receiveShadow","multiplyScalar","setSteering","amount","steering","setBrake","brake","applyEngineForce"],"mappings":"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","file":"../../physijs/physi.js","sourcesContent":["window.Physijs = (function() {\n\t'use strict';\n\n\tvar SUPPORT_TRANSFERABLE,\n\t\t_is_simulating = false,\n\t\t_Physijs = Physijs, // used for noConflict method\n\t\tPhysijs = {}, // object assigned to window.Physijs\n\t\tEventable, // class to provide simple event methods\n\t\tgetObjectId, // returns a unique ID for a Physijs mesh object\n\t\tgetEulerXYZFromQuaternion, getQuatertionFromEuler,\n\t\tconvertWorldPositionToObject, // Converts a world-space position to object-space\n\t\taddObjectChildren,\n\n\t\t_temp1, _temp2,\n\t\t_temp_vector3_1 = new THREE.Vector3,\n\t\t_temp_vector3_2 = new THREE.Vector3,\n\t\t_temp_matrix4_1 = new THREE.Matrix4,\n\t\t_quaternion_1 = new THREE.Quaternion,\n\n\t\t// constants\n\t\tMESSAGE_TYPES = {\n\t\t\tWORLDREPORT: 0,\n\t\t\tCOLLISIONREPORT: 1,\n\t\t\tVEHICLEREPORT: 2,\n\t\t\tCONSTRAINTREPORT: 3\n\t\t},\n\t\tREPORT_ITEMSIZE = 14,\n\t\tCOLLISIONREPORT_ITEMSIZE = 5,\n\t\tVEHICLEREPORT_ITEMSIZE = 9,\n\t\tCONSTRAINTREPORT_ITEMSIZE = 6;\n\n\tPhysijs.scripts = {};\n\n\tEventable = function() {\n\t\tthis._eventListeners = {};\n\t};\n\tEventable.prototype.addEventListener = function( event_name, callback ) {\n\t\tif ( !this._eventListeners.hasOwnProperty( event_name ) ) {\n\t\t\tthis._eventListeners[event_name] = [];\n\t\t}\n\t\tthis._eventListeners[event_name].push( callback );\n\t};\n\tEventable.prototype.removeEventListener = function( event_name, callback ) {\n\t\tvar index;\n\n\t\tif ( !this._eventListeners.hasOwnProperty( event_name ) ) return false;\n\n\t\tif ( (index = this._eventListeners[event_name].indexOf( callback )) >= 0 ) {\n\t\t\tthis._eventListeners[event_name].splice( index, 1 );\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\tEventable.prototype.dispatchEvent = function( event_name ) {\n\t\tvar i,\n\t\t\tparameters = Array.prototype.splice.call( arguments, 1 );\n\n\t\tif ( this._eventListeners.hasOwnProperty( event_name ) ) {\n\t\t\tfor ( i = 0; i < this._eventListeners[event_name].length; i++ ) {\n\t\t\t\tthis._eventListeners[event_name][i].apply( this, parameters );\n\t\t\t}\n\t\t}\n\t};\n\tEventable.make = function( obj ) {\n\t\tobj.prototype.addEventListener = Eventable.prototype.addEventListener;\n\t\tobj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\n\t\tobj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\n\t};\n\n\tgetObjectId = (function() {\n\t\tvar _id = 1;\n\t\treturn function() {\n\t\t\treturn _id++;\n\t\t};\n\t})();\n\n\tgetEulerXYZFromQuaternion = function ( x, y, z, w ) {\n\t\treturn new THREE.Vector3(\n\t\t\tMath.atan2( 2 * ( x * w - y * z ), ( w * w - x * x - y * y + z * z ) ),\n\t\t\tMath.asin( 2 *  ( x * z + y * w ) ),\n\t\t\tMath.atan2( 2 * ( z * w - x * y ), ( w * w + x * x - y * y - z * z ) )\n\t\t);\n\t};\n\n\tgetQuatertionFromEuler = function( x, y, z ) {\n\t\tvar c1, s1, c2, s2, c3, s3, c1c2, s1s2;\n\t\tc1 = Math.cos( y  );\n\t\ts1 = Math.sin( y  );\n\t\tc2 = Math.cos( -z );\n\t\ts2 = Math.sin( -z );\n\t\tc3 = Math.cos( x  );\n\t\ts3 = Math.sin( x  );\n\n\t\tc1c2 = c1 * c2;\n\t\ts1s2 = s1 * s2;\n\n\t\treturn {\n\t\t\tw: c1c2 * c3  - s1s2 * s3,\n\t\t\tx: c1c2 * s3  + s1s2 * c3,\n\t\t\ty: s1 * c2 * c3 + c1 * s2 * s3,\n\t\t\tz: c1 * s2 * c3 - s1 * c2 * s3\n\t\t};\n\t};\n\n\tconvertWorldPositionToObject = function( position, object ) {\n\t\t_temp_matrix4_1.identity(); // reset temp matrix\n\n\t\t// Set the temp matrix's rotation to the object's rotation\n\t\t_temp_matrix4_1.identity().makeRotationFromQuaternion( object.quaternion );\n\n\t\t// Invert rotation matrix in order to \"unrotate\" a point back to object space\n\t\t_temp_matrix4_1.getInverse( _temp_matrix4_1 );\n\n\t\t// Yay! Temp vars!\n\t\t_temp_vector3_1.copy( position );\n\t\t_temp_vector3_2.copy( object.position );\n\n\t\t// Apply the rotation\n\n\t\treturn _temp_vector3_1.sub( _temp_vector3_2 ).applyMatrix4( _temp_matrix4_1 );\n\t};\n\n\n\n\t// Physijs.noConflict\n\tPhysijs.noConflict = function() {\n\t\twindow.Physijs = _Physijs;\n\t\treturn Physijs;\n\t};\n\n\n\t// Physijs.createMaterial\n\tPhysijs.createMaterial = function( material, friction, restitution ) {\n\t\tvar physijs_material = function(){};\n\t\tphysijs_material.prototype = material;\n\t\tphysijs_material = new physijs_material;\n\n\t\tphysijs_material._physijs = {\n\t\t\tid: material.id,\n\t\t\tfriction: friction === undefined ? .8 : friction,\n\t\t\trestitution: restitution === undefined ? .2 : restitution\n\t\t};\n\n\t\treturn physijs_material;\n\t};\n\n\n\t// Constraints\n\tPhysijs.PointConstraint = function( objecta, objectb, position ) {\n\t\tif ( position === undefined ) {\n\t\t\tposition = objectb;\n\t\t\tobjectb = undefined;\n\t\t}\n\n\t\tthis.type = 'point';\n\t\tthis.appliedImpulse = 0;\n\t\tthis.id = getObjectId();\n\t\tthis.objecta = objecta._physijs.id;\n\t\tthis.positiona = convertWorldPositionToObject( position, objecta ).clone();\n\n\t\tif ( objectb ) {\n\t\t\tthis.objectb = objectb._physijs.id;\n\t\t\tthis.positionb = convertWorldPositionToObject( position, objectb ).clone();\n\t\t}\n\t};\n\tPhysijs.PointConstraint.prototype.getDefinition = function() {\n\t\treturn {\n\t\t\ttype: this.type,\n\t\t\tid: this.id,\n\t\t\tobjecta: this.objecta,\n\t\t\tobjectb: this.objectb,\n\t\t\tpositiona: this.positiona,\n\t\t\tpositionb: this.positionb\n\t\t};\n\t};\n\n\tPhysijs.HingeConstraint = function( objecta, objectb, position, axis ) {\n\t\tif ( axis === undefined ) {\n\t\t\taxis = position;\n\t\t\tposition = objectb;\n\t\t\tobjectb = undefined;\n\t\t}\n\n\t\tthis.type = 'hinge';\n\t\tthis.appliedImpulse = 0;\n\t\tthis.id = getObjectId();\n\t\tthis.scene = objecta.parent;\n\t\tthis.objecta = objecta._physijs.id;\n\t\tthis.positiona = convertWorldPositionToObject( position, objecta ).clone();\n\t\tthis.position = position.clone();\n\t\tthis.axis = axis;\n\n\t\tif ( objectb ) {\n\t\t\tthis.objectb = objectb._physijs.id;\n\t\t\tthis.positionb = convertWorldPositionToObject( position, objectb ).clone();\n\t\t}\n\t};\n\tPhysijs.HingeConstraint.prototype.getDefinition = function() {\n\t\treturn {\n\t\t\ttype: this.type,\n\t\t\tid: this.id,\n\t\t\tobjecta: this.objecta,\n\t\t\tobjectb: this.objectb,\n\t\t\tpositiona: this.positiona,\n\t\t\tpositionb: this.positionb,\n\t\t\taxis: this.axis\n\t\t};\n\t};\n\t/*\n\t * low = minimum angle in radians\n\t * high = maximum angle in radians\n\t * bias_factor = applied as a factor to constraint error\n\t * relaxation_factor = controls bounce (0.0 == no bounce)\n\t */\n\tPhysijs.HingeConstraint.prototype.setLimits = function( low, high, bias_factor, relaxation_factor ) {\n\t\tthis.scene.execute( 'hinge_setLimits', { constraint: this.id, low: low, high: high, bias_factor: bias_factor, relaxation_factor: relaxation_factor } );\n\t};\n\tPhysijs.HingeConstraint.prototype.enableAngularMotor = function( velocity, acceleration ) {\n\t\tthis.scene.execute( 'hinge_enableAngularMotor', { constraint: this.id, velocity: velocity, acceleration: acceleration } );\n\t};\n\tPhysijs.HingeConstraint.prototype.disableMotor = function( velocity, acceleration ) {\n\t\tthis.scene.execute( 'hinge_disableMotor', { constraint: this.id } );\n\t};\n\n\tPhysijs.SliderConstraint = function( objecta, objectb, position, axis ) {\n\t\tif ( axis === undefined ) {\n\t\t\taxis = position;\n\t\t\tposition = objectb;\n\t\t\tobjectb = undefined;\n\t\t}\n\n\t\tthis.type = 'slider';\n\t\tthis.appliedImpulse = 0;\n\t\tthis.id = getObjectId();\n\t\tthis.scene = objecta.parent;\n\t\tthis.objecta = objecta._physijs.id;\n\t\tthis.positiona = convertWorldPositionToObject( position, objecta ).clone();\n\t\tthis.axis = axis;\n\n\t\tif ( objectb ) {\n\t\t\tthis.objectb = objectb._physijs.id;\n\t\t\tthis.positionb = convertWorldPositionToObject( position, objectb ).clone();\n\t\t}\n\t};\n\tPhysijs.SliderConstraint.prototype.getDefinition = function() {\n\t\treturn {\n\t\t\ttype: this.type,\n\t\t\tid: this.id,\n\t\t\tobjecta: this.objecta,\n\t\t\tobjectb: this.objectb,\n\t\t\tpositiona: this.positiona,\n\t\t\tpositionb: this.positionb,\n\t\t\taxis: this.axis\n\t\t};\n\t};\n\tPhysijs.SliderConstraint.prototype.setLimits = function( lin_lower, lin_upper, ang_lower, ang_upper ) {\n\t\tthis.scene.execute( 'slider_setLimits', { constraint: this.id, lin_lower: lin_lower, lin_upper: lin_upper, ang_lower: ang_lower, ang_upper: ang_upper } );\n\t};\n\tPhysijs.SliderConstraint.prototype.setRestitution = function( linear, angular ) {\n\t\tthis.scene.execute(\n\t\t\t'slider_setRestitution',\n\t\t\t{\n\t\t\t\tconstraint: this.id,\n\t\t\t\tlinear: linear,\n\t\t\t\tangular: angular\n\t\t\t}\n\t\t);\n\t};\n\tPhysijs.SliderConstraint.prototype.enableLinearMotor = function( velocity, acceleration) {\n\t\tthis.scene.execute( 'slider_enableLinearMotor', { constraint: this.id, velocity: velocity, acceleration: acceleration } );\n\t};\n\tPhysijs.SliderConstraint.prototype.disableLinearMotor = function() {\n\t\tthis.scene.execute( 'slider_disableLinearMotor', { constraint: this.id } );\n\t};\n\tPhysijs.SliderConstraint.prototype.enableAngularMotor = function( velocity, acceleration ) {\n\t\tthis.scene.execute( 'slider_enableAngularMotor', { constraint: this.id, velocity: velocity, acceleration: acceleration } );\n\t};\n\tPhysijs.SliderConstraint.prototype.disableAngularMotor = function() {\n\t\tthis.scene.execute( 'slider_disableAngularMotor', { constraint: this.id } );\n\t};\n\n\tPhysijs.ConeTwistConstraint = function( objecta, objectb, position ) {\n\t\tif ( position === undefined ) {\n\t\t\tthrow 'Both objects must be defined in a ConeTwistConstraint.';\n\t\t}\n\t\tthis.type = 'conetwist';\n\t\tthis.appliedImpulse = 0;\n\t\tthis.id = getObjectId();\n\t\tthis.scene = objecta.parent;\n\t\tthis.objecta = objecta._physijs.id;\n\t\tthis.positiona = convertWorldPositionToObject( position, objecta ).clone();\n\t\tthis.objectb = objectb._physijs.id;\n\t\tthis.positionb = convertWorldPositionToObject( position, objectb ).clone();\n\t\tthis.axisa = { x: objecta.rotation.x, y: objecta.rotation.y, z: objecta.rotation.z };\n\t\tthis.axisb = { x: objectb.rotation.x, y: objectb.rotation.y, z: objectb.rotation.z };\n\t};\n\tPhysijs.ConeTwistConstraint.prototype.getDefinition = function() {\n\t\treturn {\n\t\t\ttype: this.type,\n\t\t\tid: this.id,\n\t\t\tobjecta: this.objecta,\n\t\t\tobjectb: this.objectb,\n\t\t\tpositiona: this.positiona,\n\t\t\tpositionb: this.positionb,\n\t\t\taxisa: this.axisa,\n\t\t\taxisb: this.axisb\n\t\t};\n\t};\n\tPhysijs.ConeTwistConstraint.prototype.setLimit = function( x, y, z ) {\n\t\tthis.scene.execute( 'conetwist_setLimit', { constraint: this.id, x: x, y: y, z: z } );\n\t};\n\tPhysijs.ConeTwistConstraint.prototype.enableMotor = function() {\n\t\tthis.scene.execute( 'conetwist_enableMotor', { constraint: this.id } );\n\t};\n\tPhysijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function( max_impulse ) {\n\t\tthis.scene.execute( 'conetwist_setMaxMotorImpulse', { constraint: this.id, max_impulse: max_impulse } );\n\t};\n\tPhysijs.ConeTwistConstraint.prototype.setMotorTarget = function( target ) {\n\t\tif ( target instanceof THREE.Vector3 ) {\n\t\t\ttarget = new THREE.Quaternion().setFromEuler( new THREE.Euler( target.x, target.y, target.z ) );\n\t\t} else if ( target instanceof THREE.Euler ) {\n\t\t\ttarget = new THREE.Quaternion().setFromEuler( target );\n\t\t} else if ( target instanceof THREE.Matrix4 ) {\n\t\t\ttarget = new THREE.Quaternion().setFromRotationMatrix( target );\n\t\t}\n\t\tthis.scene.execute( 'conetwist_setMotorTarget', { constraint: this.id, x: target.x, y: target.y, z: target.z, w: target.w } );\n\t};\n\tPhysijs.ConeTwistConstraint.prototype.disableMotor = function() {\n\t\tthis.scene.execute( 'conetwist_disableMotor', { constraint: this.id } );\n\t};\n\n\tPhysijs.DOFConstraint = function( objecta, objectb, position ) {\n\t\tif ( position === undefined ) {\n\t\t\tposition = objectb;\n\t\t\tobjectb = undefined;\n\t\t}\n\t\tthis.type = 'dof';\n\t\tthis.appliedImpulse = 0;\n\t\tthis.id = getObjectId();\n\t\tthis.scene = objecta.parent;\n\t\tthis.objecta = objecta._physijs.id;\n\t\tthis.positiona = convertWorldPositionToObject( position, objecta ).clone();\n\t\tthis.axisa = { x: objecta.rotation.x, y: objecta.rotation.y, z: objecta.rotation.z };\n\n\t\tif ( objectb ) {\n\t\t\tthis.objectb = objectb._physijs.id;\n\t\t\tthis.positionb = convertWorldPositionToObject( position, objectb ).clone();\n\t\t\tthis.axisb = { x: objectb.rotation.x, y: objectb.rotation.y, z: objectb.rotation.z };\n\t\t}\n\t};\n\tPhysijs.DOFConstraint.prototype.getDefinition = function() {\n\t\treturn {\n\t\t\ttype: this.type,\n\t\t\tid: this.id,\n\t\t\tobjecta: this.objecta,\n\t\t\tobjectb: this.objectb,\n\t\t\tpositiona: this.positiona,\n\t\t\tpositionb: this.positionb,\n\t\t\taxisa: this.axisa,\n\t\t\taxisb: this.axisb\n\t\t};\n\t};\n\tPhysijs.DOFConstraint.prototype.setLinearLowerLimit = function( limit ) {\n\t\tthis.scene.execute( 'dof_setLinearLowerLimit', { constraint: this.id, x: limit.x, y: limit.y, z: limit.z } );\n\t};\n\tPhysijs.DOFConstraint.prototype.setLinearUpperLimit = function( limit ) {\n\t\tthis.scene.execute( 'dof_setLinearUpperLimit', { constraint: this.id, x: limit.x, y: limit.y, z: limit.z } );\n\t};\n\tPhysijs.DOFConstraint.prototype.setAngularLowerLimit = function( limit ) {\n\t\tthis.scene.execute( 'dof_setAngularLowerLimit', { constraint: this.id, x: limit.x, y: limit.y, z: limit.z } );\n\t};\n\tPhysijs.DOFConstraint.prototype.setAngularUpperLimit = function( limit ) {\n\t\tthis.scene.execute( 'dof_setAngularUpperLimit', { constraint: this.id, x: limit.x, y: limit.y, z: limit.z } );\n\t};\n\tPhysijs.DOFConstraint.prototype.enableAngularMotor = function( which ) {\n\t\tthis.scene.execute( 'dof_enableAngularMotor', { constraint: this.id, which: which } );\n\t};\n\tPhysijs.DOFConstraint.prototype.configureAngularMotor = function( which, low_angle, high_angle, velocity, max_force ) {\n\t\tthis.scene.execute( 'dof_configureAngularMotor', { constraint: this.id, which: which, low_angle: low_angle, high_angle: high_angle, velocity: velocity, max_force: max_force } );\n\t};\n\tPhysijs.DOFConstraint.prototype.disableAngularMotor = function( which ) {\n\t\tthis.scene.execute( 'dof_disableAngularMotor', { constraint: this.id, which: which } );\n\t};\n\n\t// Physijs.Scene\n\tPhysijs.Scene = function( params ) {\n\t\tvar self = this;\n\n\t\tEventable.call( this );\n\t\tTHREE.Scene.call( this );\n\n\t\tthis._worker = new Worker( Physijs.scripts.worker || 'physijs_worker.js' );\n\t\tthis._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\n\t\tthis._materials_ref_counts = {};\n\t\tthis._objects = {};\n\t\tthis._vehicles = {};\n\t\tthis._constraints = {};\n\n\t\tvar ab = new ArrayBuffer( 1 );\n\t\tthis._worker.transferableMessage( ab, [ab] );\n\t\tSUPPORT_TRANSFERABLE = ( ab.byteLength === 0 );\n\n\t\tthis._worker.onmessage = function ( event ) {\n\t\t\tvar _temp,\n\t\t\t\tdata = event.data;\n\n\t\t\tif ( data instanceof ArrayBuffer && data.byteLength !== 1 ) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\n\t\t\t\tdata = new Float32Array( data );\n\t\t\t}\n\n\t\t\tif ( data instanceof Float32Array ) {\n\n\t\t\t\t// transferable object\n\t\t\t\tswitch ( data[0] ) {\n\t\t\t\t\tcase MESSAGE_TYPES.WORLDREPORT:\n\t\t\t\t\t\tself._updateScene( data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MESSAGE_TYPES.COLLISIONREPORT:\n\t\t\t\t\t\tself._updateCollisions( data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MESSAGE_TYPES.VEHICLEREPORT:\n\t\t\t\t\t\tself._updateVehicles( data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MESSAGE_TYPES.CONSTRAINTREPORT:\n\t\t\t\t\t\tself._updateConstraints( data );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( data.cmd ) {\n\n\t\t\t\t\t// non-transferable object\n\t\t\t\t\tswitch ( data.cmd ) {\n\t\t\t\t\t\tcase 'objectReady':\n\t\t\t\t\t\t\t_temp = data.params;\n\t\t\t\t\t\t\tif ( self._objects[ _temp ] ) {\n\t\t\t\t\t\t\t\tself._objects[ _temp ].dispatchEvent( 'ready' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'worldReady':\n\t\t\t\t\t\t\tself.dispatchEvent( 'ready' );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'vehicle':\n\t\t\t\t\t\t\twindow.test = data;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// Do nothing, just show the message\n\t\t\t\t\t\t\tconsole.debug('Received: ' + data.cmd);\n\t\t\t\t\t\t\tconsole.dir(data.params);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tswitch ( data[0] ) {\n\t\t\t\t\t\tcase MESSAGE_TYPES.WORLDREPORT:\n\t\t\t\t\t\t\tself._updateScene( data );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase MESSAGE_TYPES.COLLISIONREPORT:\n\t\t\t\t\t\t\tself._updateCollisions( data );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase MESSAGE_TYPES.VEHICLEREPORT:\n\t\t\t\t\t\t\tself._updateVehicles( data );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase MESSAGE_TYPES.CONSTRAINTREPORT:\n\t\t\t\t\t\t\tself._updateConstraints( data );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t};\n\n\n\t\tparams = params || {};\n\t\tparams.ammo = Physijs.scripts.ammo || 'ammo.js';\n\t\tparams.fixedTimeStep = params.fixedTimeStep || 1 / 60;\n\t\tparams.rateLimit = params.rateLimit || true;\n\t\tthis.execute( 'init', params );\n\t};\n\tPhysijs.Scene.prototype = new THREE.Scene;\n\tPhysijs.Scene.prototype.constructor = Physijs.Scene;\n\tEventable.make( Physijs.Scene );\n\n\tPhysijs.Scene.prototype._updateScene = function( data ) {\n\t\tvar num_objects = data[1],\n\t\t\tobject,\n\t\t\ti, offset;\n\n\t\tfor ( i = 0; i < num_objects; i++ ) {\n\t\t\toffset = 2 + i * REPORT_ITEMSIZE;\n\t\t\tobject = this._objects[ data[ offset ] ];\n\n\t\t\tif ( object === undefined ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( object.__dirtyPosition === false ) {\n\t\t\t\tobject.position.set(\n\t\t\t\t\tdata[ offset + 1 ],\n\t\t\t\t\tdata[ offset + 2 ],\n\t\t\t\t\tdata[ offset + 3 ]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif ( object.__dirtyRotation === false ) {\n\t\t\t\tobject.quaternion.set(\n\t\t\t\t\tdata[ offset + 4 ],\n\t\t\t\t\tdata[ offset + 5 ],\n\t\t\t\t\tdata[ offset + 6 ],\n\t\t\t\t\tdata[ offset + 7 ]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tobject._physijs.linearVelocity.set(\n\t\t\t\tdata[ offset + 8 ],\n\t\t\t\tdata[ offset + 9 ],\n\t\t\t\tdata[ offset + 10 ]\n\t\t\t);\n\n\t\t\tobject._physijs.angularVelocity.set(\n\t\t\t\tdata[ offset + 11 ],\n\t\t\t\tdata[ offset + 12 ],\n\t\t\t\tdata[ offset + 13 ]\n\t\t\t);\n\n\t\t}\n\n\t\tif ( SUPPORT_TRANSFERABLE ) {\n\t\t\t// Give the typed array back to the worker\n\t\t\tthis._worker.transferableMessage( data.buffer, [data.buffer] );\n\t\t}\n\n\t\t_is_simulating = false;\n\t\tthis.dispatchEvent( 'update' );\n\t};\n\n\tPhysijs.Scene.prototype._updateVehicles = function( data ) {\n\t\tvar vehicle, wheel,\n\t\t\ti, offset;\n\n\t\tfor ( i = 0; i < ( data.length - 1 ) / VEHICLEREPORT_ITEMSIZE; i++ ) {\n\t\t\toffset = 1 + i * VEHICLEREPORT_ITEMSIZE;\n\t\t\tvehicle = this._vehicles[ data[ offset ] ];\n\n\t\t\tif ( vehicle === undefined ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\twheel = vehicle.wheels[ data[ offset + 1 ] ];\n\n\t\t\twheel.position.set(\n\t\t\t\tdata[ offset + 2 ],\n\t\t\t\tdata[ offset + 3 ],\n\t\t\t\tdata[ offset + 4 ]\n\t\t\t);\n\n\t\t\twheel.quaternion.set(\n\t\t\t\tdata[ offset + 5 ],\n\t\t\t\tdata[ offset + 6 ],\n\t\t\t\tdata[ offset + 7 ],\n\t\t\t\tdata[ offset + 8 ]\n\t\t\t);\n\t\t}\n\n\t\tif ( SUPPORT_TRANSFERABLE ) {\n\t\t\t// Give the typed array back to the worker\n\t\t\tthis._worker.transferableMessage( data.buffer, [data.buffer] );\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype._updateConstraints = function( data ) {\n\t\tvar constraint, object,\n\t\t\ti, offset;\n\n\t\tfor ( i = 0; i < ( data.length - 1 ) / CONSTRAINTREPORT_ITEMSIZE; i++ ) {\n\t\t\toffset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\n\t\t\tconstraint = this._constraints[ data[ offset ] ];\n\t\t\tobject = this._objects[ data[ offset + 1 ] ];\n\n\t\t\tif ( constraint === undefined || object === undefined ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t_temp_vector3_1.set(\n\t\t\t\tdata[ offset + 2 ],\n\t\t\t\tdata[ offset + 3 ],\n\t\t\t\tdata[ offset + 4 ]\n\t\t\t);\n\t\t\t_temp_matrix4_1.extractRotation( object.matrix );\n\t\t\t_temp_vector3_1.applyMatrix4( _temp_matrix4_1 );\n\n\t\t\tconstraint.positiona.addVectors( object.position, _temp_vector3_1 );\n\t\t\tconstraint.appliedImpulse = data[ offset + 5 ] ;\n\t\t}\n\n\t\tif ( SUPPORT_TRANSFERABLE ) {\n\t\t\t// Give the typed array back to the worker\n\t\t\tthis._worker.transferableMessage( data.buffer, [data.buffer] );\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype._updateCollisions = function( data ) {\n\t\t/**\n\t\t * #TODO\n\t\t * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\n\t\t * effect from the previous version's evilness which mutated when switching to transferable objects.\n\t\t *\n\t\t * If you feel inclined to make this better, please do so.\n\t\t */\n\n\t\tvar i, j, offset, object, object2, id1, id2,\n\t\t\tcollisions = {}, normal_offsets = {};\n\n\t\t// Build collision manifest\n\t\tfor ( i = 0; i < data[1]; i++ ) {\n\t\t\toffset = 2 + i * COLLISIONREPORT_ITEMSIZE;\n\t\t\tobject = data[ offset ];\n\t\t\tobject2 = data[ offset + 1 ];\n\n\t\t\tnormal_offsets[ object + '-' + object2 ] = offset + 2;\n\t\t\tnormal_offsets[ object2 + '-' + object ] = -1 * ( offset + 2 );\n\n\t\t\t// Register collisions for both the object colliding and the object being collided with\n\t\t\tif ( !collisions[ object ] ) collisions[ object ] = [];\n\t\t\tcollisions[ object ].push( object2 );\n\n\t\t\tif ( !collisions[ object2 ] ) collisions[ object2 ] = [];\n\t\t\tcollisions[ object2 ].push( object );\n\t\t}\n\n\t\t// Deal with collisions\n\t\tfor ( id1 in this._objects ) {\n\t\t\tif ( !this._objects.hasOwnProperty( id1 ) ) continue;\n\t\t\tobject = this._objects[ id1 ];\n\n\t\t\t// If object touches anything, ...\n\t\t\tif ( collisions[ id1 ] ) {\n\n\t\t\t\t// Clean up touches array\n\t\t\t\tfor ( j = 0; j < object._physijs.touches.length; j++ ) {\n\t\t\t\t\tif ( collisions[ id1 ].indexOf( object._physijs.touches[j] ) === -1 ) {\n\t\t\t\t\t\tobject._physijs.touches.splice( j--, 1 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Handle each colliding object\n\t\t\t\tfor ( j = 0; j < collisions[ id1 ].length; j++ ) {\n\t\t\t\t\tid2 = collisions[ id1 ][ j ];\n\t\t\t\t\tobject2 = this._objects[ id2 ];\n\n\t\t\t\t\tif ( object2 ) {\n\t\t\t\t\t\t// If object was not already touching object2, notify object\n\t\t\t\t\t\tif ( object._physijs.touches.indexOf( id2 ) === -1 ) {\n\t\t\t\t\t\t\tobject._physijs.touches.push( id2 );\n\n\t\t\t\t\t\t\t_temp_vector3_1.subVectors( object.getLinearVelocity(), object2.getLinearVelocity() );\n\t\t\t\t\t\t\t_temp1 = _temp_vector3_1.clone();\n\n\t\t\t\t\t\t\t_temp_vector3_1.subVectors( object.getAngularVelocity(), object2.getAngularVelocity() );\n\t\t\t\t\t\t\t_temp2 = _temp_vector3_1.clone();\n\n\t\t\t\t\t\t\tvar normal_offset = normal_offsets[ object._physijs.id + '-' + object2._physijs.id ];\n\t\t\t\t\t\t\tif ( normal_offset > 0 ) {\n\t\t\t\t\t\t\t\t_temp_vector3_1.set(\n\t\t\t\t\t\t\t\t\t-data[ normal_offset ],\n\t\t\t\t\t\t\t\t\t-data[ normal_offset + 1 ],\n\t\t\t\t\t\t\t\t\t-data[ normal_offset + 2 ]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnormal_offset *= -1;\n\t\t\t\t\t\t\t\t_temp_vector3_1.set(\n\t\t\t\t\t\t\t\t\tdata[ normal_offset ],\n\t\t\t\t\t\t\t\t\tdata[ normal_offset + 1 ],\n\t\t\t\t\t\t\t\t\tdata[ normal_offset + 2 ]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tobject.dispatchEvent( 'collision', object2, _temp1, _temp2, _temp_vector3_1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// not touching other objects\n\t\t\t\tobject._physijs.touches.length = 0;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.collisions = collisions;\n\n\t\tif ( SUPPORT_TRANSFERABLE ) {\n\t\t\t// Give the typed array back to the worker\n\t\t\tthis._worker.transferableMessage( data.buffer, [data.buffer] );\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.addConstraint = function ( constraint, show_marker ) {\n\t\tthis._constraints[ constraint.id ] = constraint;\n\t\tthis.execute( 'addConstraint', constraint.getDefinition() );\n\n\t\tif ( show_marker ) {\n\t\t\tvar marker;\n\n\t\t\tswitch ( constraint.type ) {\n\t\t\t\tcase 'point':\n\t\t\t\t\tmarker = new THREE.Mesh(\n\t\t\t\t\t\tnew THREE.SphereGeometry( 1.5 ),\n\t\t\t\t\t\tnew THREE.MeshNormalMaterial\n\t\t\t\t\t);\n\t\t\t\t\tmarker.position.copy( constraint.positiona );\n\t\t\t\t\tthis._objects[ constraint.objecta ].add( marker );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'hinge':\n\t\t\t\t\tmarker = new THREE.Mesh(\n\t\t\t\t\t\tnew THREE.SphereGeometry( 1.5 ),\n\t\t\t\t\t\tnew THREE.MeshNormalMaterial\n\t\t\t\t\t);\n\t\t\t\t\tmarker.position.copy( constraint.positiona );\n\t\t\t\t\tthis._objects[ constraint.objecta ].add( marker );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'slider':\n\t\t\t\t\tmarker = new THREE.Mesh(\n\t\t\t\t\t\tnew THREE.BoxGeometry( 10, 1, 1 ),\n\t\t\t\t\t\tnew THREE.MeshNormalMaterial\n\t\t\t\t\t);\n\t\t\t\t\tmarker.position.copy( constraint.positiona );\n\t\t\t\t\t// This rotation isn't right if all three axis are non-0 values\n\t\t\t\t\t// TODO: change marker's rotation order to ZYX\n\t\t\t\t\tmarker.rotation.set(\n\t\t\t\t\t\tconstraint.axis.y, // yes, y and\n\t\t\t\t\t\tconstraint.axis.x, // x axis are swapped\n\t\t\t\t\t\tconstraint.axis.z\n\t\t\t\t\t);\n\t\t\t\t\tthis._objects[ constraint.objecta ].add( marker );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'conetwist':\n\t\t\t\t\tmarker = new THREE.Mesh(\n\t\t\t\t\t\tnew THREE.SphereGeometry( 1.5 ),\n\t\t\t\t\t\tnew THREE.MeshNormalMaterial\n\t\t\t\t\t);\n\t\t\t\t\tmarker.position.copy( constraint.positiona );\n\t\t\t\t\tthis._objects[ constraint.objecta ].add( marker );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'dof':\n\t\t\t\t\tmarker = new THREE.Mesh(\n\t\t\t\t\t\tnew THREE.SphereGeometry( 1.5 ),\n\t\t\t\t\t\tnew THREE.MeshNormalMaterial\n\t\t\t\t\t);\n\t\t\t\t\tmarker.position.copy( constraint.positiona );\n\t\t\t\t\tthis._objects[ constraint.objecta ].add( marker );\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn constraint;\n\t};\n\n\tPhysijs.Scene.prototype.onSimulationResume = function() {\n\t\tthis.execute( 'onSimulationResume', { } );\n\t};\n\n\tPhysijs.Scene.prototype.removeConstraint = function( constraint ) {\n\t\tif ( this._constraints[constraint.id ] !== undefined ) {\n\t\t\tthis.execute( 'removeConstraint', { id: constraint.id } );\n\t\t\tdelete this._constraints[ constraint.id ];\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.execute = function( cmd, params ) {\n\t\tthis._worker.postMessage({ cmd: cmd, params: params });\n\t};\n\n\taddObjectChildren = function( parent, object ) {\n\t\tvar i;\n\n\t\tfor ( i = 0; i < object.children.length; i++ ) {\n\t\t\tif ( object.children[i]._physijs ) {\n\t\t\t\tobject.children[i].updateMatrix();\n\t\t\t\tobject.children[i].updateMatrixWorld();\n\n\t\t\t\t_temp_vector3_1.setFromMatrixPosition( object.children[i].matrixWorld );\n\t\t\t\t_quaternion_1.setFromRotationMatrix( object.children[i].matrixWorld );\n\n\t\t\t\tobject.children[i]._physijs.position_offset = {\n\t\t\t\t\tx: _temp_vector3_1.x,\n\t\t\t\t\ty: _temp_vector3_1.y,\n\t\t\t\t\tz: _temp_vector3_1.z\n\t\t\t\t};\n\n\t\t\t\tobject.children[i]._physijs.rotation = {\n\t\t\t\t\tx: _quaternion_1.x,\n\t\t\t\t\ty: _quaternion_1.y,\n\t\t\t\t\tz: _quaternion_1.z,\n\t\t\t\t\tw: _quaternion_1.w\n\t\t\t\t};\n\n\t\t\t\tparent._physijs.children.push( object.children[i]._physijs );\n\t\t\t}\n\n\t\t\taddObjectChildren( parent, object.children[i] );\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.add = function( object ) {\n\t\tTHREE.Mesh.prototype.add.call( this, object );\n\n\t\tif ( object._physijs ) {\n\n\t\t\tobject.world = this;\n\n\t\t\tif ( object instanceof Physijs.Vehicle ) {\n\n\t\t\t\tthis.add( object.mesh );\n\t\t\t\tthis._vehicles[ object._physijs.id ] = object;\n\t\t\t\tthis.execute( 'addVehicle', object._physijs );\n\n\t\t\t} else {\n\n\t\t\t\tobject.__dirtyPosition = false;\n\t\t\t\tobject.__dirtyRotation = false;\n\t\t\t\tthis._objects[object._physijs.id] = object;\n\n\t\t\t\tif ( object.children.length ) {\n\t\t\t\t\tobject._physijs.children = [];\n\t\t\t\t\taddObjectChildren( object, object );\n\t\t\t\t}\n\n\t\t\t\tif ( object.material._physijs ) {\n\t\t\t\t\tif ( !this._materials_ref_counts.hasOwnProperty( object.material._physijs.id ) ) {\n\t\t\t\t\t\tthis.execute( 'registerMaterial', object.material._physijs );\n\t\t\t\t\t\tobject._physijs.materialId = object.material._physijs.id;\n\t\t\t\t\t\tthis._materials_ref_counts[object.material._physijs.id] = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._materials_ref_counts[object.material._physijs.id]++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Object starting position + rotation\n\t\t\t\tobject._physijs.position = { x: object.position.x, y: object.position.y, z: object.position.z };\n\t\t\t\tobject._physijs.rotation = { x: object.quaternion.x, y: object.quaternion.y, z: object.quaternion.z, w: object.quaternion.w };\n\n\t\t\t\t// Check for scaling\n\t\t\t\tvar mass_scaling = new THREE.Vector3( 1, 1, 1 );\n\t\t\t\tif ( object._physijs.width ) {\n\t\t\t\t\tobject._physijs.width *= object.scale.x;\n\t\t\t\t}\n\t\t\t\tif ( object._physijs.height ) {\n\t\t\t\t\tobject._physijs.height *= object.scale.y;\n\t\t\t\t}\n\t\t\t\tif ( object._physijs.depth ) {\n\t\t\t\t\tobject._physijs.depth *= object.scale.z;\n\t\t\t\t}\n\n\t\t\t\tthis.execute( 'addObject', object._physijs );\n\n\t\t\t}\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.remove = function( object ) {\n\t\tif ( object instanceof Physijs.Vehicle ) {\n\t\t\tthis.execute( 'removeVehicle', { id: object._physijs.id } );\n\t\t\twhile( object.wheels.length ) {\n\t\t\t\tthis.remove( object.wheels.pop() );\n\t\t\t}\n\t\t\tthis.remove( object.mesh );\n\t\t\tdelete this._vehicles[ object._physijs.id ];\n\t\t} else {\n\t\t\tTHREE.Mesh.prototype.remove.call( this, object );\n\t\t\tif ( object._physijs ) {\n\t\t\t\tdelete this._objects[object._physijs.id];\n\t\t\t\tthis.execute( 'removeObject', { id: object._physijs.id } );\n\t\t\t}\n\t\t}\n\t\tif ( object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty( object.material._physijs.id ) ) {\n\t\t\tthis._materials_ref_counts[object.material._physijs.id]--;\n\t\t\tif(this._materials_ref_counts[object.material._physijs.id] == 0) {\n\t\t\t\tthis.execute( 'unRegisterMaterial', object.material._physijs );\n\t\t\t\tdelete this._materials_ref_counts[object.material._physijs.id];\n\t\t\t}\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.setFixedTimeStep = function( fixedTimeStep ) {\n\t\tif ( fixedTimeStep ) {\n\t\t\tthis.execute( 'setFixedTimeStep', fixedTimeStep );\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.setGravity = function( gravity ) {\n\t\tif ( gravity ) {\n\t\t\tthis.execute( 'setGravity', gravity );\n\t\t}\n\t};\n\n\tPhysijs.Scene.prototype.simulate = function( timeStep, maxSubSteps ) {\n\t\tvar object_id, object, update;\n\n\t\tif ( _is_simulating ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t_is_simulating = true;\n\n\t\tfor ( object_id in this._objects ) {\n\t\t\tif ( !this._objects.hasOwnProperty( object_id ) ) continue;\n\n\t\t\tobject = this._objects[object_id];\n\n\t\t\tif ( object.__dirtyPosition || object.__dirtyRotation ) {\n\t\t\t\tupdate = { id: object._physijs.id };\n\n\t\t\t\tif ( object.__dirtyPosition ) {\n\t\t\t\t\tupdate.pos = { x: object.position.x, y: object.position.y, z: object.position.z };\n\t\t\t\t\tobject.__dirtyPosition = false;\n\t\t\t\t}\n\n\t\t\t\tif ( object.__dirtyRotation ) {\n\t\t\t\t\tupdate.quat = { x: object.quaternion.x, y: object.quaternion.y, z: object.quaternion.z, w: object.quaternion.w };\n\t\t\t\t\tobject.__dirtyRotation = false;\n\t\t\t\t}\n\n\t\t\t\tthis.execute( 'updateTransform', update );\n\t\t\t}\n\t\t}\n\n\t\tthis.execute( 'simulate', { timeStep: timeStep, maxSubSteps: maxSubSteps } );\n\n\t\treturn true;\n\t};\n\n\n\t// Phsijs.Mesh\n\tPhysijs.Mesh = function ( geometry, material, mass ) {\n\t\tvar index;\n\n\t\tif ( !geometry ) {\n\t\t\treturn;\n\t\t}\n\n\t\tEventable.call( this );\n\t\tTHREE.Mesh.call( this, geometry, material );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\tthis._physijs = {\n\t\t\ttype: null,\n\t\t\tid: getObjectId(),\n\t\t\tmass: mass || 0,\n\t\t\ttouches: [],\n\t\t\tlinearVelocity: new THREE.Vector3,\n\t\t\tangularVelocity: new THREE.Vector3\n\t\t};\n\t};\n\tPhysijs.Mesh.prototype = new THREE.Mesh;\n\tPhysijs.Mesh.prototype.constructor = Physijs.Mesh;\n\tEventable.make( Physijs.Mesh );\n\n\t// Physijs.Mesh.mass\n\tPhysijs.Mesh.prototype.__defineGetter__('mass', function() {\n\t\treturn this._physijs.mass;\n\t});\n\tPhysijs.Mesh.prototype.__defineSetter__('mass', function( mass ) {\n\t\tthis._physijs.mass = mass;\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'updateMass', { id: this._physijs.id, mass: mass } );\n\t\t}\n\t});\n\n\t// Physijs.Mesh.applyCentralImpulse\n\tPhysijs.Mesh.prototype.applyCentralImpulse = function ( force ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'applyCentralImpulse', { id: this._physijs.id, x: force.x, y: force.y, z: force.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.applyImpulse\n\tPhysijs.Mesh.prototype.applyImpulse = function ( force, offset ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'applyImpulse', { id: this._physijs.id, impulse_x: force.x, impulse_y: force.y, impulse_z: force.z, x: offset.x, y: offset.y, z: offset.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.applyTorque\n\tPhysijs.Mesh.prototype.applyTorque = function ( force ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'applyTorque', { id: this._physijs.id, torque_x: force.x, torque_y: force.y, torque_z: force.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.applyCentralForce\n\tPhysijs.Mesh.prototype.applyCentralForce = function ( force ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'applyCentralForce', { id: this._physijs.id, x: force.x, y: force.y, z: force.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.applyForce\n\tPhysijs.Mesh.prototype.applyForce = function ( force, offset ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'applyForce', { id: this._physijs.id, force_x: force.x, force_y : force.y, force_z : force.z, x: offset.x, y: offset.y, z: offset.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.getAngularVelocity\n\tPhysijs.Mesh.prototype.getAngularVelocity = function () {\n\t\treturn this._physijs.angularVelocity;\n\t};\n\n\t// Physijs.Mesh.setAngularVelocity\n\tPhysijs.Mesh.prototype.setAngularVelocity = function ( velocity ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setAngularVelocity', { id: this._physijs.id, x: velocity.x, y: velocity.y, z: velocity.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.getLinearVelocity\n\tPhysijs.Mesh.prototype.getLinearVelocity = function () {\n\t\treturn this._physijs.linearVelocity;\n\t};\n\n\t// Physijs.Mesh.setLinearVelocity\n\tPhysijs.Mesh.prototype.setLinearVelocity = function ( velocity ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setLinearVelocity', { id: this._physijs.id, x: velocity.x, y: velocity.y, z: velocity.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.setAngularFactor\n\tPhysijs.Mesh.prototype.setAngularFactor = function ( factor ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setAngularFactor', { id: this._physijs.id, x: factor.x, y: factor.y, z: factor.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.setLinearFactor\n\tPhysijs.Mesh.prototype.setLinearFactor = function ( factor ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setLinearFactor', { id: this._physijs.id, x: factor.x, y: factor.y, z: factor.z } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.setDamping\n\tPhysijs.Mesh.prototype.setDamping = function ( linear, angular ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setDamping', { id: this._physijs.id, linear: linear, angular: angular } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.setCcdMotionThreshold\n\tPhysijs.Mesh.prototype.setCcdMotionThreshold = function ( threshold ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setCcdMotionThreshold', { id: this._physijs.id, threshold: threshold } );\n\t\t}\n\t};\n\n\t// Physijs.Mesh.setCcdSweptSphereRadius\n\tPhysijs.Mesh.prototype.setCcdSweptSphereRadius = function ( radius ) {\n\t\tif ( this.world ) {\n\t\t\tthis.world.execute( 'setCcdSweptSphereRadius', { id: this._physijs.id, radius: radius } );\n\t\t}\n\t};\n\n\n\t// Physijs.PlaneMesh\n\tPhysijs.PlaneMesh = function ( geometry, material, mass ) {\n\t\tvar width, height;\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n\t\tthis._physijs.type = 'plane';\n\t\tthis._physijs.normal = geometry.faces[0].normal.clone();\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n\t};\n\tPhysijs.PlaneMesh.prototype = new Physijs.Mesh;\n\tPhysijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\n\n\t// Physijs.HeightfieldMesh\n\tPhysijs.HeightfieldMesh = function ( geometry, material, mass, xdiv, ydiv) {\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tthis._physijs.type   = 'heightfield';\n\t\tthis._physijs.xsize  = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\tthis._physijs.ysize  = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\t\tthis._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\n\t\tthis._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\n\t\t// note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\n\t\tthis._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z,Math.abs(geometry.boundingBox.min.z));\n\n\t\tvar points = [];\n\n\t\tvar a, b;\n\t\tfor ( var i = 0; i < geometry.vertices.length; i++ ) {\n\n\t\t\ta = i % this._physijs.xpts;\n\t\t\tb = Math.round( ( i / this._physijs.xpts ) - ( (i % this._physijs.xpts) / this._physijs.xpts ) );\n\t\t\tpoints[i] = geometry.vertices[ a + ( ( this._physijs.ypts - b - 1 ) * this._physijs.ypts ) ].z;\n\n\t\t\t//points[i] = geometry.vertices[i];\n\t\t}\n\n\t\tthis._physijs.points = points;\n\t};\n\tPhysijs.HeightfieldMesh.prototype = new Physijs.Mesh;\n\tPhysijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\n\n\t// Physijs.BoxMesh\n\tPhysijs.BoxMesh = function( geometry, material, mass ) {\n\t\tvar width, height, depth;\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\t\tdepth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n\t\tthis._physijs.type = 'box';\n\t\tthis._physijs.width = width;\n\t\tthis._physijs.height = height;\n\t\tthis._physijs.depth = depth;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n\t};\n\tPhysijs.BoxMesh.prototype = new Physijs.Mesh;\n\tPhysijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\n\n\n\t// Physijs.SphereMesh\n\tPhysijs.SphereMesh = function( geometry, material, mass ) {\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingSphere ) {\n\t\t\tgeometry.computeBoundingSphere();\n\t\t}\n\n\t\tthis._physijs.type = 'sphere';\n\t\tthis._physijs.radius = geometry.boundingSphere.radius;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? (4/3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\n\t};\n\tPhysijs.SphereMesh.prototype = new Physijs.Mesh;\n\tPhysijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\n\n\n\t// Physijs.CylinderMesh\n\tPhysijs.CylinderMesh = function( geometry, material, mass ) {\n\t\tvar width, height, depth;\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\t\tdepth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n\t\tthis._physijs.type = 'cylinder';\n\t\tthis._physijs.width = width;\n\t\tthis._physijs.height = height;\n\t\tthis._physijs.depth = depth;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n\t};\n\tPhysijs.CylinderMesh.prototype = new Physijs.Mesh;\n\tPhysijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\n\n\n\t// Physijs.CapsuleMesh\n\tPhysijs.CapsuleMesh = function( geometry, material, mass ) {\n\t\tvar width, height, depth;\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\t\tdepth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n\t\tthis._physijs.type = 'capsule';\n\t\tthis._physijs.radius = Math.max(width / 2, depth / 2);\n\t\tthis._physijs.height = height;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n\t};\n\tPhysijs.CapsuleMesh.prototype = new Physijs.Mesh;\n\tPhysijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\n\n\n\t// Physijs.ConeMesh\n\tPhysijs.ConeMesh = function( geometry, material, mass ) {\n\t\tvar width, height, depth;\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n\t\tthis._physijs.type = 'cone';\n\t\tthis._physijs.radius = width / 2;\n\t\tthis._physijs.height = height;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n\t};\n\tPhysijs.ConeMesh.prototype = new Physijs.Mesh;\n\tPhysijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\n\n\n\t// Physijs.ConcaveMesh\n\tPhysijs.ConcaveMesh = function( geometry, material, mass ) {\n\t\tvar i,\n\t\t\twidth, height, depth,\n\t\t\tvertices, face, triangles = [];\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\tvertices = geometry.vertices;\n\n\t\tfor ( i = 0; i < geometry.faces.length; i++ ) {\n\t\t\tface = geometry.faces[i];\n\t\t\tif ( face instanceof THREE.Face3) {\n\n\t\t\t\ttriangles.push([\n\t\t\t\t\t{ x: vertices[face.a].x, y: vertices[face.a].y, z: vertices[face.a].z },\n\t\t\t\t\t{ x: vertices[face.b].x, y: vertices[face.b].y, z: vertices[face.b].z },\n\t\t\t\t\t{ x: vertices[face.c].x, y: vertices[face.c].y, z: vertices[face.c].z }\n\t\t\t\t]);\n\n\t\t\t} else if ( face instanceof THREE.Face4 ) {\n\n\t\t\t\ttriangles.push([\n\t\t\t\t\t{ x: vertices[face.a].x, y: vertices[face.a].y, z: vertices[face.a].z },\n\t\t\t\t\t{ x: vertices[face.b].x, y: vertices[face.b].y, z: vertices[face.b].z },\n\t\t\t\t\t{ x: vertices[face.d].x, y: vertices[face.d].y, z: vertices[face.d].z }\n\t\t\t\t]);\n\t\t\t\ttriangles.push([\n\t\t\t\t\t{ x: vertices[face.b].x, y: vertices[face.b].y, z: vertices[face.b].z },\n\t\t\t\t\t{ x: vertices[face.c].x, y: vertices[face.c].y, z: vertices[face.c].z },\n\t\t\t\t\t{ x: vertices[face.d].x, y: vertices[face.d].y, z: vertices[face.d].z }\n\t\t\t\t]);\n\n\t\t\t}\n\t\t}\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\t\tdepth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n\t\tthis._physijs.type = 'concave';\n\t\tthis._physijs.triangles = triangles;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n\t};\n\tPhysijs.ConcaveMesh.prototype = new Physijs.Mesh;\n\tPhysijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\n\n\n\t// Physijs.ConvexMesh\n\tPhysijs.ConvexMesh = function( geometry, material, mass ) {\n\t\tvar i,\n\t\t\twidth, height, depth,\n\t\t\tpoints = [];\n\n\t\tPhysijs.Mesh.call( this, geometry, material, mass );\n\n\t\tif ( !geometry.boundingBox ) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\n\t\tfor ( i = 0; i < geometry.vertices.length; i++ ) {\n\t\t\tpoints.push({\n\t\t\t\tx: geometry.vertices[i].x,\n\t\t\t\ty: geometry.vertices[i].y,\n\t\t\t\tz: geometry.vertices[i].z\n\t\t\t});\n\t\t}\n\n\n\t\twidth = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n\t\theight = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\t\tdepth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n\t\tthis._physijs.type = 'convex';\n\t\tthis._physijs.points = points;\n\t\tthis._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n\t};\n\tPhysijs.ConvexMesh.prototype = new Physijs.Mesh;\n\tPhysijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\n\n\n\t// Physijs.Vehicle\n\tPhysijs.Vehicle = function( mesh, tuning ) {\n\t\ttuning = tuning || new Physijs.VehicleTuning;\n\t\tthis.mesh = mesh;\n\t\tthis.wheels = [];\n\t\tthis._physijs = {\n\t\t\tid: getObjectId(),\n\t\t\trigidBody: mesh._physijs.id,\n\t\t\tsuspension_stiffness: tuning.suspension_stiffness,\n\t\t\tsuspension_compression: tuning.suspension_compression,\n\t\t\tsuspension_damping: tuning.suspension_damping,\n\t\t\tmax_suspension_travel: tuning.max_suspension_travel,\n\t\t\tfriction_slip: tuning.friction_slip,\n\t\t\tmax_suspension_force: tuning.max_suspension_force\n\t\t};\n\t};\n\tPhysijs.Vehicle.prototype.addWheel = function( wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning ) {\n\t\tvar wheel = new THREE.Mesh( wheel_geometry, wheel_material );\n\t\twheel.castShadow = wheel.receiveShadow = true;\n\t\twheel.position.copy( wheel_direction ).multiplyScalar( suspension_rest_length / 100 ).add( connection_point );\n\t\tthis.world.add( wheel );\n\t\tthis.wheels.push( wheel );\n\n\t\tthis.world.execute( 'addWheel', {\n\t\t\tid: this._physijs.id,\n\t\t\tconnection_point: { x: connection_point.x, y: connection_point.y, z: connection_point.z },\n\t\t\twheel_direction: { x: wheel_direction.x, y: wheel_direction.y, z: wheel_direction.z },\n\t\t\twheel_axle: { x: wheel_axle.x, y: wheel_axle.y, z: wheel_axle.z },\n\t\t\tsuspension_rest_length: suspension_rest_length,\n\t\t\twheel_radius: wheel_radius,\n\t\t\tis_front_wheel: is_front_wheel,\n\t\t\ttuning: tuning\n\t\t});\n\t};\n\tPhysijs.Vehicle.prototype.setSteering = function( amount, wheel ) {\n\t\tif ( wheel !== undefined && this.wheels[ wheel ] !== undefined ) {\n\t\t\tthis.world.execute( 'setSteering', { id: this._physijs.id, wheel: wheel, steering: amount } );\n\t\t} else if ( this.wheels.length > 0 ) {\n\t\t\tfor ( var i = 0; i < this.wheels.length; i++ ) {\n\t\t\t\tthis.world.execute( 'setSteering', { id: this._physijs.id, wheel: i, steering: amount } );\n\t\t\t}\n\t\t}\n\t};\n\tPhysijs.Vehicle.prototype.setBrake = function( amount, wheel ) {\n\t\tif ( wheel !== undefined && this.wheels[ wheel ] !== undefined ) {\n\t\t\tthis.world.execute( 'setBrake', { id: this._physijs.id, wheel: wheel, brake: amount } );\n\t\t} else if ( this.wheels.length > 0 ) {\n\t\t\tfor ( var i = 0; i < this.wheels.length; i++ ) {\n\t\t\t\tthis.world.execute( 'setBrake', { id: this._physijs.id, wheel: i, brake: amount } );\n\t\t\t}\n\t\t}\n\t};\n\tPhysijs.Vehicle.prototype.applyEngineForce = function( amount, wheel ) {\n\t\tif ( wheel !== undefined && this.wheels[ wheel ] !== undefined ) {\n\t\t\tthis.world.execute( 'applyEngineForce', { id: this._physijs.id, wheel: wheel, force: amount } );\n\t\t} else if ( this.wheels.length > 0 ) {\n\t\t\tfor ( var i = 0; i < this.wheels.length; i++ ) {\n\t\t\t\tthis.world.execute( 'applyEngineForce', { id: this._physijs.id, wheel: i, force: amount } );\n\t\t\t}\n\t\t}\n\t};\n\n\t// Physijs.VehicleTuning\n\tPhysijs.VehicleTuning = function( suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force ) {\n\t\tthis.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\n\t\tthis.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\n\t\tthis.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\n\t\tthis.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\n\t\tthis.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\n\t\tthis.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\n\t};\n\n\treturn Physijs;\n})();\n"]}