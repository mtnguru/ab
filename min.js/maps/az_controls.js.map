{"version":3,"sources":["az_controls.js"],"names":["$","Drupal","atomizer","controlsC","_viewer","controlSet","changeMode","newMode","mouseMode","cameraTrackballControls","dispose","viewer","canvasContainer","removeEventListener","onMouseMove","objectTrackballControls","createCameraTrackballControls","addEventListener","onMouseClick","createObjectTrackballControls","octolet","onControlChanged","event","args","this","id","split","className","indexOf","context","value","target","theme","applyControl","selectYmlChanged","base","doAjax","component","filepath","getYmlDirectory","filename","loadYml","onButtonClicked","preventDefault","overwriteYml","wrapper","name","querySelector","length","saveYml","replace","buttonClicked","popupDialog","response","$popup","$html","onPopupNode","nid","data","viewMode","popupId","setThemeDefaults","controlId","settings","control","type","set","defaultValue","sid","showThemeBlock","i","selectBlock","selected","blockName","showSelectedThemeBlock","$block","addClass","$selectedBlock","insertAfter","removeClass","initializeControls","e","element","click","hasClass","blockid","controls","THREE","OrbitControls","camera","renderer","domElement","rotateSpeed","zoomSpeed","panSpeed","enableZoom","enablePan","enableDamping","dampingFactor","keys","object","TrackballControls","noZoom","noPan","staticMoving","render","findIntersects","objects","vector","Vector3","mouse","x","y","unproject","raycaster","Raycaster","position","sub","normalize","intersectedObjects","intersectObjects","offsetX","canvasWidth","offsetY","canvasHeight","producer","hoverObjects","hovered","mouseClick","constants","Vector2","init","setDefaults","ray","direction","projector","Projector","getDefault","index","$element","attr","val","console","log","jQuery"],"mappings":"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","file":"../az_controls.js","sourcesContent":["/**\n * @file - az_controls.js\n *\n * Initialize controls.\n * Listen for events and dispense them to the appropriate modules.\n */\n\n(function ($) {\n  Drupal.atomizer.controlsC = function (_viewer, controlSet) {\n\n    var abc = ['a', 'b', 'c'];\n\n    var viewer = _viewer;\n    var constants = Drupal.atomizer.base.constants;\n    var cameraTrackballControls;\n    var objectTrackballControls;\n    var mouseMode = 'none';\n    var selectBlock = $('#theme--selectBlock', viewer.context)[0];\n    var $popup;\n\n    // Variables for detecting items mouse is hovering over.\n    var raycaster;\n    var mouse = new THREE.Vector2(-1000, -1000);\n\n    /**\n     * Change the mouse mode - builder, move camera, none, etc.\n     *\n     * @param newMode\n     */\n    function changeMode(newMode) {\n\n      switch (mouseMode) {\n        case 'atom_builder':\n          cameraTrackballControls.dispose();\n          delete cameraTrackballControls;\n          viewer.canvasContainer.removeEventListener('mousemove', onMouseMove);\n          break;\n        case 'camera':\n          cameraTrackballControls.dispose();\n          delete cameraTrackballControls;\n          break;\n        case 'atom':\n          objectTrackballControls.dispose();\n          delete objectTrackballControls;\n          break;\n        case 'attach':\n          viewer.canvasContainer.removeEventListener('mousemove', onMouseMove);\n          break;\n        case 'none':\n          break;\n      }\n\n      mouseMode = newMode;\n      switch (mouseMode) {\n        case 'atom_builder':\n          cameraTrackballControls = createCameraTrackballControls();\n          viewer.canvasContainer.addEventListener('mousemove', onMouseMove, false);\n          viewer.canvasContainer.addEventListener('mouseup', onMouseClick, false);\n          break;\n        case 'camera':\n          cameraTrackballControls = createCameraTrackballControls();\n          break;\n        case 'atom':\n          objectTrackballControls = createObjectTrackballControls(Drupal.atomizer.octolet);\n          break;\n        case 'attach':\n          viewer.canvasContainer.addEventListener('mousemove', onMouseMove, false);\n          break;\n        case 'none':\n          break;\n      }\n    }\n\n    /**\n     * One of the styling controls has changed, get the value of the control and apply control through the theme module.\n     * @param event\n     */\n    function onControlChanged(event) {\n      var args = this.id.split(\"--\");\n      if (this.className.indexOf('az-slider') > -1) {\n        $('#' + args[0] + '--' + args[1] + '--' + args[2] + '--az-value', viewer.context)[0].value = event.target.value;\n      } else if (this.className.indexOf('az-control-range') > -1) {\n        $('#' + this.id + '--az-value', viewer.context)[0].value = event.target.value;\n      }\n      viewer.theme.applyControl(this.id, event.target.value);\n    }\n\n    /**\n     * A control to select a new yml file has changed - execute the AJAX call to load a new one.\n     * @param event\n     */\n    function selectYmlChanged(event) {\n      var args = this.id.split(\"--\");\n      Drupal.atomizer.base.doAjax(\n        '/ajax-ab/loadYml',\n        { component: args[0],\n          filepath: viewer[args[0]].getYmlDirectory() + '/' + event.target.value,\n          filename: event.target.value\n        },\n        viewer[args[0]].loadYml\n      );\n    }\n\n    /**\n     * The user has pressed a button, do something with it.\n     *\n     * @param event\n     * @returns {boolean}\n     */\n    function onButtonClicked(event) {\n\n      event.preventDefault();\n      var args = this.id.split(\"--\");\n      switch (args[1]) {\n        case 'selectyml':\n          viewer[args[0]].overwriteYml();\n          break;\n        case 'saveyml':\n          var wrapper  = $('3' + args[0] + '--saveyml', viewer.context)[0];\n          var name = wrapper.querySelector('input[name=name]').value;\n          var filename = wrapper.querySelector('input[name=filename]').value;\n          // If user didn't enter a file name then generate it from the Name\n          if (name.length) {\n            if (filename.length == 0) {\n              filename = name;\n            }\n            if (filename.indexOf('.yml') == -1) {\n              filename += '.yml';\n            }\n            // Save the yml file154G\n            viewer[args[0]].saveYml({\n              name: name,\n              filepath: viewer[args[0]].getYmlDirectory() + '/' + filename.replace(/[|&;$%@\"<>()+,]/g, \"\").replace(/[ -]/g, '_')\n            });\n          }\n          break;\n        default:\n          if (args[0] === 'viewer') {\n            viewer.buttonClicked(event.target);\n          }\n          else {\n            if (viewer[args[0]] && viewer[args[0]].buttonClicked) {\n              event.preventDefault();\n              viewer[args[0]].buttonClicked(event.target);\n            }\n          }\n          break;\n      }\n      return false;\n    }\n\n    function popupDialog(response) {\n      if ($popup == null) {\n        $html = '<div class=\"' + + '\"></div>';\n        var $popup = $('#blocks--popup', viewer.context);\n        $html =\n          '<div class=\"az-popup\">' +\n          '<div class=\"az-popup-titlebar\">' +\n          '<div class=\"az-popup-title\">' +\n          'Yo Dude' +\n          '</div>' +\n          '</div>' +\n          '<div class=\"az-popup-content\">' +\n          'Hey James' +\n          '</div>' +\n          '</div>';\n\n      }\n\n      // Declare this as a block - it'll have already been rendered then.\n      // create a div,\n      // place html into it\n      // give the div a title area and close button in the upper right.\n    }\n\n    function onPopupNode(event) {\n      event.preventDefault();\n      var nid = $(event.target).data('nid');\n      var viewMode = $(event.target).data('viewmode');\n      Drupal.atomizer.base.doAjax(\n        '/ajax-ab/loadYml',\n        {\n          nid: nid,\n          viewMode: viewMode,\n          popupId: 'popupNode'\n        },\n        popupDialog\n      );\n      return;\n    }\n\n    /**\n     * Display the currently selected block - hide the rest\n     */\n    function setThemeDefaults() {\n      // Initialize all the sliders, buttons and color fields in the selectBlock blocks\n      if (!viewer.atomizer.theme) return;\n      for (var controlId in viewer.atomizer.theme.settings) {\n        var control = viewer.atomizer.theme.settings[controlId];\n        var id = controlId.replace(/_/g, \"-\");\n        var element = $('#' + id, viewer.context)[0];\n        if (element || control.type == 'rotation' || control.type == 'position') {\n          switch (control.type) {\n            case 'color':\n            case 'range':\n              viewer.theme.set(control.defaultValue, id, control.type);\n              break;\n            case 'rotation':\n            case 'position':\n              var sid;\n              sid = id + '--az-slider';\n              viewer.theme.set(control.defaultValue, sid, control.type);\n              break;\n          }\n          // Make sure that theme has default values for all controls\n        }\n      }\n    }\n\n    function showThemeBlock() {\n      for (var i=0; i < selectBlock.length; i++) {\n        if (selectBlock[i].selected) {\n          var blockName = selectBlock[i].id.split('--')[1];\n          showSelectedThemeBlock($(blockName));\n        }\n      }\n    }\n\n    function showSelectedThemeBlock($block) {\n      // Hide all .control-block's in theme block.\n      $('#blocks--theme .control-block').addClass('az-hidden');\n\n      // get value of #theme--selectBlock and move block into theme block.\n      var $selectedBlock = $('#blocks--' + selectBlock.value);\n      $selectedBlock.insertAfter($(selectBlock));\n      $selectedBlock.removeClass('az-hidden');\n    }\n\n    /**\n     * Initialize controls\n     *\n     * Set defaults as per the current theme.  Add Event listeners\n     *\n     * @returns {controls|*}\n     */\n    function initializeControls() {\n\n      // Extract default values to initialize settings\n      setThemeDefaults();\n\n      var form = $('.az-controls-form', viewer.context)[0];\n      if (!form) return;\n\n      showThemeBlock();\n      selectBlock.addEventListener(\"change\", function(e) {\n        showSelectedThemeBlock($('#blocks--' + e.value));\n      });\n\n      // Set up event listeners\n      for (var controlId in viewer.atomizer.theme.settings) {\n        var control = viewer.atomizer.theme.settings[controlId];\n        var id = controlId.replace(/_/g, \"-\");\n        var element = $('#' + id, viewer.context)[0];\n        if (element || control.type == 'rotation' || control.type == 'position') {\n          switch (control.type) {\n            case 'color':\n            case 'range':\n              element.addEventListener(\"input\", onControlChanged);\n              break;\n            case 'rotation':\n            case 'position':\n              var sid = id + '--az-slider';\n              $('#' + sid, viewer.context)[0].addEventListener(\"input\", onControlChanged);\n              viewer.theme.set(control.defaultValue, sid, control.type);\n              break;\n            case 'saveyml':\n              var elem = $('#' + id + '--button', viewer.context)[0];\n              $('#' + id + '--button', viewer.context)[0].addEventListener(\"click\", onButtonClicked);\n              break;\n            case 'selectyml':\n              element.addEventListener(\"change\", selectYmlChanged);\n              break;\n            case 'link':\n            case 'button':\n            case 'toggle':\n              element.addEventListener(\"click\", onButtonClicked);\n              break;\n            case 'popup-node':\n              element.addEventListener(\"click\", onPopupNode);\n              break;\n          }\n          // Make sure that theme has default values for all controls\n        }\n      }\n\n      // Initialize the theme block select list - move form elements into\n      // Initialize toggle-block buttons\n      $('.toggle-block').click(function(e) {\n        var $block = $('#' + $(this).data('blockid'));\n        if ($block.hasClass('az-hidden')) {\n          var blockid = $(this).data('blockid');\n          $block.removeClass('az-hidden');\n          $(this).addClass('az-selected');\n\n          // Move selected block to immediately after buttons.\n          $block.insertAfter($('#blocks--buttons'));\n\n          // If this is the theme block then move selected control block into it.\n          if (blockid === 'blocks--theme') {\n            showThemeBlock();\n          }\n        } else {\n          $block.addClass('az-hidden');\n          $(this).removeClass('az-selected');\n        }\n      });\n\n      return false;\n    }\n\n    /**\n     * Create Trackball controls.\n     *\n     * @returns {THREE.TrackballControls}\n     */\n    function createCameraTrackballControls() {\n      var controls = new THREE.OrbitControls(viewer.camera, viewer.renderer.domElement);\n      controls.rotateSpeed =   .25;\n      controls.zoomSpeed =     .5;\n      controls.panSpeed =      .5;\n      controls.enableZoom =    true;\n      controls.enablePan =     true;\n      controls.enableDamping = true;\n      controls.dampingFactor=  0.3;\n\n      controls.keys = [65, 83, 68];\n      return controls;\n    }\n\n    /**\n     * Create Trackball controls.\n     *\n     * @returns {THREE.TrackballControls}\n     */\n    function createObjectTrackballControls(object) {\n      var controls = new THREE.TrackballControls(object, viewer.renderer.domElement);\n      controls.rotateSpeed = 2.0;\n      controls.zoomSpeed = 1.0;\n      controls.panSpeed = 3.0;\n      controls.noZoom = false;\n      controls.noPan = false;\n      controls.staticMoving = true;\n      // controls.dynamicDampingFactor=0.3;\n\n      controls.keys = [65, 83, 68];\n      controls.addEventListener('change', viewer.render);\n      return controls;\n    }\n\n    /**\n     * Find intersection with mouse and the producers list of intersection objects.\n     *\n     * @returns {*}\n     */\n    function findIntersects(objects) {\n      if (objects) {\n        var vector = new THREE.Vector3(mouse.x, mouse.y, .5);\n        vector.unproject(viewer.camera);\n\n        var raycaster = new THREE.Raycaster(viewer.camera.position, vector.sub(viewer.camera.position).normalize());\n        viewer.render();\n        var intersectedObjects = raycaster.intersectObjects(objects);\n        if (intersectedObjects.length) {\n          var dude = 1;\n        }\n        return intersectedObjects;\n      }\n      else {\n        return [];\n      }\n    }\n\n    /**\n     * Save the current mouse position - X, Y\n     * When the user moves the mouse, if the producer has a intersected handler,\n     * then * build a list of intersected objects and call the producers intersected handler.\n     * @param event\n     */\n    function onMouseMove(event) {\n      mouse.x =  (event.offsetX / viewer.canvasWidth) * 2 - 1;\n      mouse.y = -(event.offsetY / viewer.canvasHeight) * 2 + 1;\n      if (viewer.producer.hoverObjects) {\n        viewer.producer.hovered(findIntersects(viewer.producer.hoverObjects()));\n      }\n      viewer.render();\n    }\n\n    /**\n     * When user clicks mouse button, call the producers mouseClick function if it exists.\n     * @param event\n     */\n    function onMouseClick(event) {\n      mouse.x =  (event.offsetX / viewer.canvasWidth) * 2 - 1;\n      mouse.y = -(event.offsetY / viewer.canvasHeight) * 2 + 1;\n      if (viewer.producer.mouseClick) {\n//    event.preventDefault();\n        return viewer.producer.mouseClick(event);\n      }\n    }\n\n    /**\n     * Get the default setting for a control.\n     *\n     * Used when the current theme does not define a valid default.\n     *\n     * @param id\n     * @param index\n     * @returns\n     */\n    var getDefault = function getDefault(id, index) {\n      var $element = $('#' + id, viewer.context);\n      if ($element.length) {\n        if ($element.hasClass('az-control-range') ||\n            $element.hasClass('az-control-rotation') ||\n            $element.hasClass('az-control-position')) {\n          if (index) {\n            return $('#' + id + '--' + index + '--az-slider', viewer.context)[0].value;\n          } else {\n            return $('#' + id + '--az-slider', viewer.context)[0].value;\n          }\n        } else if ($element.hasClass('az-control-radios')) {\n          return $('input[name=' + $element.attr('id') + ']:checked').val();\n        } else {\n          return $element.val();\n        }\n      } else {\n        console.log('atomizer_controls.js - control not found - ' + id);\n        return null;\n      }\n    };\n\n    /**\n     * Initialize all controls.\n     */\n    var init = function init() {\n//  cameraTrackballControls = createCameraTrackballControls();\n      initializeControls();\n\n      // Set the current mouse mode.\n//  changeMode(viewer.theme.get('mouse--mode'));\n      changeMode('atom_builder');\n\n      // Set any default values the producer may have.\n      if (viewer.producer.setDefaults) viewer.producer.setDefaults();\n\n      // Set up raycaster and projector for selecting objects with mouse.\n      raycaster = new THREE.Raycaster();\n      raycaster.ray.direction.set(0,-1,0);\n      viewer.controls.projector = new THREE.Projector();\n    };\n\n    /**\n     * Interface to this module.\n     */\n    return {\n      init: init,\n      getDefault: getDefault,\n      findIntersects: findIntersects,\n      cameraTrackballControls: cameraTrackballControls\n    }\n  };\n})(jQuery);\n"]}