THREE.TimelinerController=function(t,e,i){this._scene=t,this._trackInfo=e,this._onUpdate=i,this._mixer=new THREE.AnimationMixer(t),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]},THREE.TimelinerController.prototype={constructor:THREE.TimelinerController,init:function(t){for(var e=[],i=this._trackInfo,r=0,a=i.length;r!==a;++r){var n=i[r];e.push(this._addTrack(n.type,n.propertyPath,n.initialValue,n.interpolation))}this._clip=new THREE.AnimationClip("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(t){this._action.time=t,this._mixer.update(0),this._onUpdate()},setDuration:function(t){this._clip.duration=t},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(t){return this._tracks[t].times},setKeyframe:function(t,e){var i=this._tracks[t],r=i.times,a=Timeliner.binarySearch(r,e),n=i.values,s=i.getValueSize(),l=a*s;if(a<0){l=(a=~a)*s;for(var h=r.length+1,o=n.length+s,c=h-1;c!==a;--c)r[c]=r[c-1];for(var c=o-1,u=l+s-1;c!==u;--c)n[c]=n[c-s]}r[a]=e,this._propRefs[t].getValue(n,l)},delKeyframe:function(t,e){var i=this._tracks[t],r=i.times,a=Timeliner.binarySearch(r,e);if(r.length>1&&a>=0){for(var n=r.length-1,s=i.values,l=i.getValueSize(),h=s.length-l,o=a;o!==n;++o)r[o]=r[o+1];r.pop();for(var c=a*l;c!==h;++c)s[c]=s[c+l];s.length=h}},moveKeyframe:function(t,e,i,r){var a=this._tracks[t],n=a.times,s=Timeliner.binarySearch(n,e);if(s>=0){for(var l=r?n.length:s+1,h=n[s-1]<=e||!r&&e>=n[s+1];s!==l;)n[s++]+=i;h&&this._sort(a)}},serialize:function(){for(var t={duration:this._clip.duration,channels:{}},e=this._channelNames,i=this._tracks,r=t.channels,a=0,n=e.length;a!==n;++a){var s=e[a],l=i[s];r[s]={times:l.times,values:l.values}}return t},deserialize:function(t){var e=this._channelNames,i=this._tracks,r=t.channels;this.setDuration(t.duration);for(var a=0,n=e.length;a!==n;++a){var s=e[a],l=i[s];data=r[s],this._setArray(l.times,data.times),this._setArray(l.values,data.values)}this.setDisplayTime(this._mixer.time)},_sort:function(t){var e=t.times,i=THREE.AnimationUtils.getKeyframeOrder(e);this._setArray(e,THREE.AnimationUtils.sortedArray(e,1,i));var r=t.values,a=t.getValueSize();this._setArray(r,THREE.AnimationUtils.sortedArray(r,a,i))},_setArray:function(t,e){t.length=0,t.push.apply(t,e)},_addTrack:function(t,e,i,r){var a=new t(e,[0],i,r);return a.times=Array.prototype.slice.call(a.times),a.values=Array.prototype.slice.call(a.values),this._channelNames.push(e),this._tracks[e]=a,this._propRefs[e]=new THREE.PropertyBinding(this._scene,e),a}};
//# sourceMappingURL=../maps/threejs/TimelinerController.js.map
