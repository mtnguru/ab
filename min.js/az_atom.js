!function(t){Drupal.atomizer.atomC=function(a){function e(t,a,e,n){for(var r="0"==t?[12,13,14,15,20]:[16,17,18,19,21],o=0;o<r.length;o++)a.az.protons[r[o]].material.visible=n,a.az.protons[r[o]].az.visible=n,a.az.protons[r[o]].az.active=e}function n(t,a,r){var o=m.nuclet.createNuclet(t,a),l=o.children[0],i=o.children[0].children[0];if(i.az.attachAngle=a.attachAngle,r.add(o),"N0"!=i.az.id){var c=i.az.id.substr(i.az.id.length-1),u=i.az.id.slice(0,-1);e(c,s.az.nuclets[u],!1,!1);var z,v;0==c?(z=0,v=10,l.initial_rotation_y=-18):(z=2,v=10,l.initial_rotation_y=-198);var f=s.az.nuclets[u].az.protons[z].position.clone(),d=new THREE.Vector3(0,31,0),h=new THREE.Vector3(0,13,0);f.y=f.y+11;var p=i.az.protonGeometry.vertices[v].clone().normalize(),g=new THREE.Vector3(0,1,0),b=d.clone().sub(f),A=b.length();b.normalize(),Drupal.atomizer.base.alignObjectToAxis(i,p,g,!1),Drupal.atomizer.base.alignObjectToAxis(o,g,b,!1);var y=h.clone().add(b.multiplyScalar(2.28*-A));o.position.set(y.x,y.y,y.z),l.rotation.y=(l.initial_rotation_y+72*((a.attachAngle||1)-1))/180*Math.PI}if(s.az.nuclets[i.az.id]=i,a.nuclets)for(var t in a.nuclets)n(t,a.nuclets[t],i),e(t.charAt(t.length-1),i,!1,!1);return o}function r(){var t=m.theme.get("valence-active--color"),a=m.theme.get("valence-inactive--color");for(var e in s.az.nuclets){var n=s.az.nuclets[e];if("initial"===n.az.state||"final"===n.az.state)for(var r in n.az.rings)if(n.az.rings.hasOwnProperty(r)){var o=n.az.rings[r],l=(n.az.id,o.az.grow,t);s.az.nuclets[n.az.id+o.az.grow]||n.az.protons[o.az.lock[0]].az.visible&&n.az.protons[o.az.lock[1]].az.visible?l=a:0,o.material.color.setHex(parseInt(l.replace(/#/,"0x")),16)}}}function o(){var a=0;for(var e in s.az.nuclets){0;var n=s.az.nuclets[e];for(var r in n.az.protons){var o=n.az.protons[r];o.az?o.az.visible&&a++:0}}t("#atom--num-protons .text-value").html(a)}function l(t){var a=t.target.id.split("-")[1];f(a,null),t.preventDefault()}function i(){function t(a,e){var n=s.az.nuclets[a],r=e+a+":\n";r+=(e+="  ")+"state: "+n.az.state+"\n","N0"!==a&&(r+=e+"attachAngle: "+n.az.conf.attachAngle+"\n"),r+=e+"protons: [";for(var o=0,l=0;l<n.az.protons.length;l++)if(n.az.protons[l]){var i=n.az.protons[l];i.az.active&&i.az.visible&&(o++&&(r+=", "),r+=l)}r+="]\n";var c=s.az.nuclets[a+"0"],u=s.az.nuclets[a+"1"];return(c||u)&&(r+=e+"nuclets:\n",c&&(r+=t(a+"0",e+"  ")),u&&(r+=t(a+"1",e+"  "))),r}return t("N0","")}function c(){var a=t(".select-atom",t(m.context).parents("article"));if(a)for(var e=0;e<a.length;e++)a[e].addEventListener("click",l,!1)}var s,u,m=a,z=t("#atom--information",m.context)[0],v=t("#view-select-atom"),f=function(t,a){u=a,Drupal.atomizer.base.doAjax("/ajax-ab/loadAtom",{nid:t},d)},d=function(t){for(var a=0;a<t.length;a++){var e=t[a];"loadAtomCommand"==e.command&&(z&&(z.innerHTML=e.data.teaser),jQuery("#atom--save a").replaceWith(e.data.link),Drupal.attachBehaviors&&Drupal.attachBehaviors("#atom--save a"),s?(m.scene.remove(s),s.az):{nuclets:{}},h(e.data.atomConf.N0),s.az.nid=e.data.nid,m.producer.atomLoaded(s),u&&u())}},h=function(t){return s=new THREE.Group,s.name="atom",s.az={nuclets:{}},m.atom.atom=s,n("N0",t,s),r(),o(),m.scene.add(s),m.render(),s},p=function(a){t("#theme--selectyml")[0].querySelector("select")};return t("#atom--select-close").click(function(){v.toggleClass("enabled")}),Drupal.behaviors.atomizer_atom={attach:function(a,e){c();var n=t(".node-atom-form, .node-atom-edit-form")[0];n&&(n.getElementsByClassName("field--name-field-atomic-structure")[0].getElementsByTagName("textarea")[0].value=i())}},c(),{addNuclet:function(t){conf={state:"lithium",attachAngle:3,protons:[10,1,4,5,3,11,9],electrons:[0,1,2]};var a=s.az.nuclets[t.slice(0,-1)];e(t.charAt(t.length-1),a,!1,!1);var l=n(t,conf,a);return r(),o(),l.children[0].children[0]},addProton:function(t,a){},az:function(){return s.az},buttonClicked:function(t){"atom--select"==t.id&&v.toggleClass("enabled")},changeNucletState:function(t,a){var e=t.az.id,o=t.az.attachAngle,l=t.parent.parent.parent;return m.nuclet.deleteNuclet(t),t=n(e,{state:a,attachAngle:o},l).children[0].children[0],r(),t},changeNucletAngle:function(t,a){var e=s.az.nuclets[t];e.parent.rotation.y=(e.parent.initial_rotation_y+72*(a-1))/180*Math.PI,e.az.conf.attachAngle=a},createAtom:h,deleteNuclet:function(t){var a=s.az.nuclets[t],n=s.az.nuclets[t.slice(0,-1)];m.nuclet.deleteNuclet(a),e(t.charAt(t.length-1),n,!0,!1),r(),o()},getNuclet:function(t){return s.az.nuclets[t]?s.az.nuclets[t]:null},getYmlDirectory:function(){return"config/atom"},loadAtom:f,overwriteYml:function(t){Drupal.atomizer.base.doAjax("/ajax-ab/saveYml",{name:currentSet.name,component:"theme",filename:currentSet.filename,ymlContents:currentSet},null)},saveYml:function(t){currentSet.name=t.name,currentSet.filename=t.filename,Drupal.atomizer.base.doAjax("/ajax-ab/saveYml",{name:t.name,component:"theme",filename:t.filename,ymlContents:currentSet},p)},setValenceRings:r,showStats:o}}}(jQuery);
//# sourceMappingURL=maps/az_atom.js.map
